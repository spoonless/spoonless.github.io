

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  <meta content="David Gayerie" name="author" />
<meta content="Jakarta EE - JPA" name="description" />
<meta content="Java, Jakarta EE, JPA, Hibernate, JDBC" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  

  <title>Les relations avec JPA &mdash; Java EE</title>



  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://gayerie.dev/docs/jakartaee/javaee_orm/jpa_relations.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="L’héritage avec JPA" href="jpa_inheritance.html" />
    <link rel="prev" title="Les requêtes JPA" href="jpa_queries.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Java EE
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Java EE pour le Web</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/environnement_developpement.html">L’environnement de développement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/environnement_developpement.html#telechargement-des-outils">Téléchargement des outils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/environnement_developpement.html#installation-des-outils">Installation des outils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/environnement_developpement.html#configuration-de-java-dans-eclipse">Configuration de Java dans Eclipse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/environnement_developpement.html#integration-de-tomcat-dans-eclipse">Intégration de Tomcat dans Eclipse</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/premiere_application.html">Une première application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/premiere_application.html#qu-est-ce-qu-une-application-java-ee">Qu’est-ce qu’une application Java EE ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/premiere_application.html#creation-d-un-projet-dans-eclipse">Création d’un projet dans Eclipse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/premiere_application.html#deploiement-depuis-eclipse-et-test-de-l-application">Déploiement depuis Eclipse et test de l’application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/premiere_application.html#le-contexte-racine-de-deploiement-root-context">Le contexte racine de déploiement (root context)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/premiere_application.html#packaging-de-l-application">Packaging de l’application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/maven.html">Introduction à Maven</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#pourquoi-utiliser-maven">Pourquoi utiliser Maven ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#caracteristiques-principales-de-maven">Caractéristiques principales de Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#installation-de-maven">Installation de Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#un-premier-projet-avec-maven">Un premier projet avec Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#le-fichier-pom-xml">Le fichier pom.xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#import-du-projet-maven-dans-eclipse">Import du projet Maven dans Eclipse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#test-de-l-application-dans-tomcat">Test de l’application dans Tomcat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#gerer-le-projet-avec-maven">Gérer le projet avec Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/maven.html#execution-de-maven-dans-eclipse">Exécution de Maven dans Eclipse</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/servlet.html">Les Servlets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/servlet.html#structure-d-une-servlet-http">Structure d’une servlet HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/servlet.html#configuration-du-deploiement-d-une-servlet">Configuration du déploiement d’une servlet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/servlet.html#chemin-absolu-d-url-dans-une-application-web">Chemin absolu d’URL dans une application Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/servlet.html#motif-d-url-d-une-servlet">Motif d’URL d’une Servlet</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/servlet.html#utilisation-du-fichier-de-deploiement-web-xml">Utilisation du fichier de déploiement web.xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/servlet.html#exercice">Exercice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/conteneur_web.html">Le conteneur Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/conteneur_web.html#cycle-de-vie-des-servlets">Cycle de vie des servlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/conteneur_web.html#exercice">Exercice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/conteneur_web.html#servlet-et-programmation-concurrente">Servlet et programmation concurrente</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/conteneur_web.html#id1">Exercice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/attributs_web.html">Les attributs d’une application Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/attributs_web.html#attribut-de-portee-requete">Attribut de portée requête</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/attributs_web.html#attribut-de-portee-session">Attribut de portée session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/attributs_web.html#session-http-comment-cela-marche-t-il">Session HTTP : comment cela marche-t-il ?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/attributs_web.html#les-attributs-de-portee-application">Les attributs de portée application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/attributs_web.html#exercices">Exercices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/jsp.html">JSP : Java Server Pages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#exercice">Exercice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#el-expression-language">EL : Expression Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#les-operateurs-dans-l-expression-language">Les opérateurs dans l’expression language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#les-objets-implicites-dans-une-jsp">Les objets implicites dans une JSP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#la-resolution-de-portee-des-attributs-dans-une-jsp">La résolution de portée des attributs dans une JSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#expression-language-et-gestion-des-exceptions">Expression Language et gestion des exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#les-directives-de-jsp">Les directives de JSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#la-directive-page">La directive page</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#la-directive-include">La directive include</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#les-balises-d-action-jsp">Les balises d’action JSP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#les-taglibs-et-la-jstl">Les Taglibs et la JSTL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#jstl-core">JSTL core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#jstl-formater">JSTL formater</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#jstl-functions">JSTL functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#jstl-sql">JSTL SQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jsp.html#jstl-xml">JSTL XML</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jsp.html#exercices">Exercices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/mvc_request_dispatcher.html">MVC et RequestDispatcher</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/mvc_request_dispatcher.html#le-modele-mvc">Le modèle MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/mvc_request_dispatcher.html#le-request-dispatcher">Le request dispatcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/mvc_request_dispatcher.html#exemple-de-mvc-sans-validation">Exemple de MVC (sans validation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/mvc_request_dispatcher.html#exemple-de-mvc-avec-validation">Exemple de MVC (avec validation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/mvc_request_dispatcher.html#exercice">Exercice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/web_listeners_filters.html">Web listeners et filtres</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#les-listeners-web">Les listeners Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#declaration-des-listeners-web">Déclaration des listeners Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#exemple-d-utilisation-d-un-listener">Exemple d’utilisation d’un listener</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#les-filtres-de-servlet">Les filtres de Servlet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#declaration-des-filtres">Déclaration des filtres</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#implementation-d-un-filtre">Implémentation d’un filtre</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#cas-d-utilisation-de-filtres">Cas d’utilisation de filtres</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#gestion-de-l-utf-8">Gestion de l’UTF-8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/web_listeners_filters.html#generation-de-log">Génération de log</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/jaxrs.html">Les API Web avec JAX-RS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jaxrs.html#la-notion-de-ressource">La notion de ressource</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jaxrs.html#configurer-une-application-web-pour-jax-rs">Configurer une application Web pour JAX-RS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jaxrs.html#implementer-des-ressources-avec-jax-rs">Implémenter des ressources avec JAX-RS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jaxrs.html#les-annotations-de-methodes">Les annotations de méthodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javaee_web/jaxrs.html#parametre-dans-le-chemin-d-uri">Paramètre dans le chemin d’URI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jaxrs.html#data-binding">Data binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jaxrs.html#generer-une-reponse">Générer une réponse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jaxrs.html#gerer-des-exceptions">Gérer des exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/jaxrs.html#implementer-un-client-http">Implémenter un client HTTP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../javaee_web/securite.html">Sécurisation d’une application Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/securite.html#declarer-des-contraintes-de-securite">Déclarer des contraintes de sécurité</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/securite.html#configuration-de-l-authentification-dans-tomcat">Configuration de l’authentification dans Tomcat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/securite.html#configuration-https-dans-tomcat">Configuration https dans Tomcat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/securite.html#exercice">Exercice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../javaee_web/securite.html#login-a-partir-d-un-formulaire-web">Login à partir d’un formulaire Web</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Java EE ORM</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="jdbc.html">Accès aux bases de données : JDBC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#preambule-try-with-resources">Préambule : try-with-resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-pilote-de-base-de-donnees">Le pilote de base de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#creation-d-une-connexion">Création d’une connexion</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#l-url-de-connexion-et-la-classe-des-pilotes">L’URL de connexion et la classe des pilotes</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#les-requetes-sql-statement">Les requêtes SQL (Statement)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-statement">Le Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-resultset">Le ResultSet</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-preparedstatement">Le PreparedStatement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jdbc.html#l-injection-sql">L’injection SQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#recuperation-des-cles-generees">Récupération des clés générées</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-callablestatement">Le CallableStatement</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#la-transaction">La transaction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jdbc_webapp.html">JDBC dans une application Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jdbc_webapp.html#acces-a-une-datasource">Accès à une DataSource</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc_webapp.html#injection-d-une-datasource">Injection d’une DataSource</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc_webapp.html#declaration-de-la-datasource-dans-le-fichier-web-xml">Déclaration de la DataSource dans le fichier web.xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc_webapp.html#declaration-d-une-datasource-dans-tomcat">Déclaration d’une DataSource dans Tomcat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_entites.html">Les entités JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#les-orm-object-relational-mapping">Les ORM (Object-Relational Mapping)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#id1">Les entités JPA</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#l-entitymanager">L’EntityManager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#obtenir-un-entitymanager">Obtenir un EntityManager</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#creer-une-fabrique-d-entitymanager">Créer une fabrique d’EntityManager</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#manipuler-des-entites-a-partir-d-un-entitymanager">Manipuler des entités à partir d’un EntityManager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-persist">La méthode persist</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-find">La méthode find</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-refresh">La méthode refresh</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-merge">La méthode merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-detach">La méthode detach</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-remove">La méthode remove</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_queries.html">Les requêtes JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_queries.html#les-requetes-natives">Les requêtes Natives</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_queries.html#les-requetes-jpql">Les requêtes JPQL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_queries.html#les-requetes-par-programmation">Les requêtes par programmation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_queries.html#utilisation-de-requetes-nommees">Utilisation de requêtes nommées</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Les relations avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#la-relation-1-1-one-to-one">La relation 1:1 (one to one)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-relation-n-1-many-to-one">La relation n:1 (many to one)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-relation-1-n-one-to-many">La relation 1:n (one to many)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-relation-n-n-many-to-many">La relation n:n (many to many)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#les-relations-bi-directionnelles">Les relations bi-directionnelles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-propagation-en-cascade">La propagation en cascade</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requetes-jpql-et-jointure">Requêtes JPQL et jointure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fetch-lazy-ou-fetch-eager">Fetch lazy ou fetch eager</a></li>
<li class="toctree-l2"><a class="reference internal" href="#relation-avec-des-attributs">Relation avec des attributs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#solution-1-referencer-la-cle-composee-avec-idclass">Solution 1 : Référencer la clé composée avec &#64;IdClass</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solution-2-referencer-la-cle-composee-avec-embeddedid">Solution 2 : Référencer la clé composée avec &#64;EmbeddedId</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solution-3-utiliser-une-cle-technique-simple">Solution 3 : Utiliser une clé technique simple</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_inheritance.html">L’héritage avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#l-annotation-inheritance">L’annotation &#64;Inheritance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_inheritance.html#heritage-avec-une-seule-table">Héritage avec une seule table</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#heritage-avec-jointure-de-tables">Héritage avec jointure de tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#heritage-avec-une-table-par-classe">Héritage avec une table par classe</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#l-heritage-et-les-requetes-jpql-polymorphiques">L’héritage et les requêtes JPQL polymorphiques</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#un-cas-a-part-fusion-de-la-super-classe">Un cas à part : fusion de la super classe</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Web et service Web</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../http/introduction.html">Introduction : Service Web et API Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http/api_web.html">HTTP, REST et les API Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../http/http.html">Le protocole HTTP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html#structure-des-messages">Structure des messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html#exercice">Exercice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html#les-codes-de-statut">Les codes de statut</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html#les-methodes-http">Les méthodes HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html#proprietes-des-methodes-http">Propriétés des méthodes HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html#les-en-tetes-http">Les en-têtes HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http.html#id2">Exercice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http/http_cas_utilisation.html">HTTP : les cas d’utilisation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#obtenir-la-representation-d-une-ressource">Obtenir la représentation d’une ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#obtenir-uniquement-les-meta-informations-d-une-ressource">Obtenir uniquement les meta-informations d’une ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#creer-une-ressource-dont-on-connait-l-uri">Créer une ressource dont on connait l’URI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#creer-une-ressource-dont-on-ne-connait-pas-l-uri">Créer une ressource dont on ne connait pas l’URI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#supprimer-l-acces-a-une-ressource">Supprimer l’accès à une ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#mettre-a-jour-une-ressource">Mettre à jour une ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#mettre-a-jour-partiellement-une-ressource">Mettre à jour partiellement une ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#executer-un-processus-de-traitement">Exécuter un processus de traitement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#connaitre-les-methodes-autorisees">Connaître les méthodes autorisées</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#traitement-asynchrone-d-une-requete">Traitement asynchrone d’une requête</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_cas_utilisation.html#les-redirections">Les redirections</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../http/http_cas_utilisation.html#evolution-du-service">Évolution du service</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/http_cas_utilisation.html#uri-volatile-et-canonicalisation-d-uri">URI volatile et canonicalisation d’URI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/http_cas_utilisation.html#separer-le-traitement-de-la-requete-de-son-resultat">Séparer le traitement de la requête de son résultat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http/http_negociation_contenu.html">HTTP : la négociation de contenu</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/http_negociation_contenu.html#la-negociation-de-type-de-contenu">La négociation de type de contenu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_negociation_contenu.html#la-negociation-de-jeu-de-caracteres">La négociation de jeu de caractères</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_negociation_contenu.html#la-negociation-de-langue">La négociation de langue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_negociation_contenu.html#l-en-tete-vary">L’en-tête Vary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http/http_requetes_conditionnelles.html">HTTP : les requêtes conditionnelles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/http_requetes_conditionnelles.html#demander-une-representation-a-jour">Demander une représentation à jour</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_requetes_conditionnelles.html#creer-une-ressource-si-elle-n-existe-pas-deja">Créer une ressource si elle n’existe pas déjà</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_requetes_conditionnelles.html#alterer-une-ressource-sous-condition">Altérer une ressource sous condition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_requetes_conditionnelles.html#alterer-une-ressource-si-elle-existe">Altérer une ressource si elle existe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http/http_gestion_cache.html">HTTP : la gestion du cache</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/http_gestion_cache.html#serveur-d-origine-et-intermediaires">Serveur d’origine et intermédiaires</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_gestion_cache.html#principe-generale-de-la-gestion-du-cache">Principe générale de la gestion du cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_gestion_cache.html#la-fraicheur-d-une-reponse">La fraîcheur d’une réponse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_gestion_cache.html#la-revalidation">La revalidation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_gestion_cache.html#les-directives-de-strategie-de-cache">Les directives de stratégie de cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_gestion_cache.html#l-invalidation-de-cache">L’invalidation de cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_gestion_cache.html#enrichissement-des-en-tetes-par-les-intermediaires">Enrichissement des en-têtes par les intermédiaires</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http/http_liens.html">HTTP : les liens</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/http_liens.html#l-en-tete-link">L’en-tête Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_liens.html#les-types-de-relation">Les types de relation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/http_liens.html#les-attributs-optionnels-d-un-lien">Les attributs optionnels d’un lien</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http/rest.html">REST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#la-ressource">La ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#uri-informative-ou-uri-opaque">URI informative ou URI opaque ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#ressource-contre-rpc">Ressource contre RPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#la-representation">La représentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#les-contraintes-rest">Les contraintes REST</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#client-serveur">Client/Serveur</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#interface-uniforme">Interface uniforme</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#sans-etat-stateless">Sans état (stateless)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#mise-en-cache-caching">Mise en cache (caching)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#layered-system">Layered system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#code-on-demand">Code on demand</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#hypermedia">Hypermédia</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#les-formats-hypermedias">Les formats hypermédias</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#l-en-tete-link">L’en-tête Link</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#les-apports-de-l-hypermedia">Les apports de l’hypermédia</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#rest-ca-veut-dire-quoi">REST : ça veut dire quoi ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#les-api-web">Les API Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#references">Références</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#sites-web-articles">Sites Web &amp; articles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#livres">Livres</a></li>
<li class="toctree-l4"><a class="reference internal" href="../http/rest.html#applications-de-demo">Applications de démo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../http/rest.html#exercices">Exercices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../http/web_services.html">Les services Web SOAP / WSDL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../http/java_ws.html">Les services Web avec Java</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#la-quete-de-l-interoperabilite">La quête de l’interopérabilité</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#soap-structure-des-messages">SOAP : structure des messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#web-service-description-language-wsdl">Web Service Description Language (WSDL)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#developper-un-service-web-soap">Développer un service Web SOAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#exercice">Exercice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#les-outils-java-de-generation">Les outils Java de génération</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../http/java_ws.html#wsdl-java-contract-first">WSDL → Java (Contract first)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#consommer-un-service-web-avec-jax-ws">Consommer un service Web avec JAX-WS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#id1">Exercice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#implementer-des-services-web-avec-jax-ws">Implémenter des services Web avec JAX-WS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#deployer-un-service-web-dans-un-serveur-tomcat">Déployer un service Web dans un serveur Tomcat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#id2">Exercice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/java_ws.html#pour-aller-plus-loin">Pour aller plus loin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http/annexe_xml.html">Annexe : XML</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../http/annexe_xml.html#structure-du-langage">Structure du langage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/annexe_xml.html#structure-du-document">Structure du document</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/annexe_xml.html#exercice">Exercice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/annexe_xml.html#espaces-de-noms-xml">Espaces de noms XML</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/annexe_xml.html#schemas-xml">Schémas XML</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http/annexe_xml.html#pour-aller-plus-loin">Pour aller plus loin…</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Java EE</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="banner">D'autres formations sont sur <a href="https://gayerie.dev">https://gayerie.dev</a></div>

        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Les relations avec JPA</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="jpa_inheritance.html" class="btn btn-neutral float-right" title="L’héritage avec JPA" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jpa_queries.html" class="btn btn-neutral float-left" title="Les requêtes JPA" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="les-relations-avec-jpa">
<h1>Les relations avec JPA<a class="headerlink" href="#les-relations-avec-jpa" title="Lien permanent vers ce titre">¶</a></h1>
<p>Une des fonctionnalités majeures des ORM est de gérer les relations
entre objets comme des relations entre tables dans un modèle de base de
données relationnelle. JPA définit des modèles de relation qui peuvent
être déclarés par annotation.</p>
<p>Les relations sont spécifiées par les annotations : <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a>, <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a>,
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a>, <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>.</p>
<p>Pour une présentation approfondie des relations dans JPA, reportez-vous
au <a class="reference external" href="https://en.wikibooks.org/wiki/Java_Persistence/Relationships">Wikibook</a>.</p>
<div class="section" id="la-relation-1-1-one-to-one">
<h2>La relation 1:1 (one to one)<a class="headerlink" href="#la-relation-1-1-one-to-one" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a> définit une relation 1:1 entre deux entités.
Si cette relation n’est pas forcément très courante dans un modèle relationnel
de base de données, elle se rencontre très souvent dans une modèle objet.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Exemple de relation OneToOne</span><a class="headerlink" href="#id1" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@OneToOne</span>
  <span class="kd">private</span> <span class="n">Abonnement</span> <span class="n">abonnement</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">La classe associée dans la relation OneToOne</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Abonnement</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a> implique que la table <code class="docutils literal notranslate"><span class="pre">Individu</span></code> contient
une colonne qui est une clé étrangère contenant la clé d’un abonnement.
Par défaut, JPA s’attend à ce que cette colonne se nomme <code class="docutils literal notranslate"><span class="pre">ABONNEMENT_ID</span></code>,
mais il est possible de changer ce nom grâce à l’annotation
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinColumn.html">&#64;JoinColumn</a> :</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Déclaration de la clé étrangère</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@OneToOne</span>
  <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;abonnement_fk&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Abonnement</span> <span class="n">abonnement</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>La déclaration de <em>mapping</em> ci-dessus correspond au modèle de base de données
suivant :</p>
<div class="figure align-default" id="id4">
<img alt="../_images/relation_one2one.png" src="../_images/relation_one2one.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données correspondant à la relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a></span><a class="headerlink" href="#id4" title="Lien permanent vers cette image">¶</a></p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Dans une requête JPQL, une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a> est navigable directement.
Si on désire exprimer un requête de la forme</p>
<blockquote>
<div><div class="line-block">
<div class="line">Sélectionner l’individu avec l’abonnement dont l’id est 1.</div>
</div>
</div></blockquote>
<p>alors il suffit d’écrire en JPQL :</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>select i from Individu i where i.abonnement.id = 1</strong></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="la-relation-n-1-many-to-one">
<h2>La relation n:1 (many to one)<a class="headerlink" href="#la-relation-n-1-many-to-one" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> définit une relation n:1 entre deux entités.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Exemple de relation ManyToOne</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">La classe associée dans la relation ManyToOne</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Societe</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> implique que la table <code class="docutils literal notranslate"><span class="pre">Individu</span></code> contient
une colonne qui est une clé étrangère contenant la clé d’une société.
Par défaut, JPA s’attend à ce que cette colonne se nomme <code class="docutils literal notranslate"><span class="pre">SOCIETE_ID</span></code>,
mais il est possible de changer ce nom grâce à l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinColumn.html">&#64;JoinColumn</a>.</p>
<div class="figure align-default" id="id7">
<img alt="../_images/relation_many2one.png" src="../_images/relation_many2one.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données correspondant à la relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a></span><a class="headerlink" href="#id7" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Plutôt que par une colonne, il est également possible d’indiquer à JPA
qu’il doit passer par une table d’association pour établir la relation
entre les deux entités avec l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinTable.html">&#64;JoinTable</a> :</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Déclaration d’une table d’association</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinTable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="c1">// déclaration d&#39;une table d&#39;association</span>
  <span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;societe_individu&quot;</span><span class="p">,</span>
             <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">),</span>
             <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;societe_id&quot;</span><span class="p">))</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="figure align-default" id="id9">
<img alt="../_images/relation_many2one_jointable.png" src="../_images/relation_many2one_jointable.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données correspondant à la relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> avec une table de jointure</span><a class="headerlink" href="#id9" title="Lien permanent vers cette image">¶</a></p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Dans une requête JPQL, une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> est navigable directement.
Si on désire exprimer un requête de la forme</p>
<blockquote>
<div><div class="line-block">
<div class="line">Sélectionner les individus appartenant à la société avec l’id 1.</div>
</div>
</div></blockquote>
<p>alors il suffit d’écrire en JPQL :</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>select i from Individu i where i.societe.id = 1</strong></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="la-relation-1-n-one-to-many">
<h2>La relation 1:n (one to many)<a class="headerlink" href="#la-relation-1-n-one-to-many" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> définit une relation 1:n entre deux entités.
Cette annotation ne peut être utilisée qu’avec une collection d’éléments
puisqu’elle implique qu’il peut y avoir plusieurs entités associées.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Exemple de relation OneToMany</span><a class="headerlink" href="#id10" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Societe</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@OneToMany</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">employes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">La classe associée dans la relation OneToMany</span><a class="headerlink" href="#id11" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> implique que la table <code class="docutils literal notranslate"><span class="pre">Individu</span></code> contient
une colonne qui est une clé étrangère contenant la clé d’une société.
Par défaut, JPA s’attend à ce que cette colonne se nomme <code class="docutils literal notranslate"><span class="pre">SOCIETE_ID</span></code>,
mais il est possible de changer ce nom grâce à l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinColumn.html">&#64;JoinColumn</a>.</p>
<div class="figure align-default" id="id12">
<img alt="../_images/relation_many2one.png" src="../_images/relation_many2one.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données correspondant à la relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a></span><a class="headerlink" href="#id12" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Il est également possible d’indiquer à JPA qu’il doit passer par une
table d’association pour établir la relation entre les deux entités avec
l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinTable.html">&#64;JoinTable</a>.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Exemple de relation OneToMany avec une table de jointure</span><a class="headerlink" href="#id13" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinTable</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Societe</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@OneToMany</span>
  <span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;societe_individu&quot;</span><span class="p">,</span>
             <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;societe_id&quot;</span><span class="p">),</span>
             <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">))</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">employes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="figure align-default" id="id14">
<img alt="../_images/relation_many2one_jointable.png" src="../_images/relation_many2one_jointable.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données correspondant à la relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> avec une table de jointure</span><a class="headerlink" href="#id14" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>La relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> est la relation miroir de la relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a>.
Le modèle relationnel de base de données est le même. Par contre, du point de
vue du modèle objet, cela dépend du <em>côté</em> de la relation que l’on veut représenter.
On parle de <em>navigabilité</em> de la relation. Dans l’exemple ci-dessus, le modèle
objet est navigable d’une société vers ses individus.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Dans une requête JPQL, une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> <strong>n’est pas navigable
directement</strong>. Si on désire exprimer un requête de la forme</p>
<blockquote>
<div><div class="line-block">
<div class="line">Sélectionner la société dont un des employés a l’id 1.</div>
</div>
</div></blockquote>
<p>alors il faut utiliser en JPQL la <a class="reference external" href="https://en.wikibooks.org/wiki/Java_Persistence/JPQL#JOIN">syntaxe du fetch</a> pour faire apparaître
une variable intermédiaire dans la requête :</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>select s from Societe s join s.employes e where e.id = 1</strong></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="la-relation-n-n-many-to-many">
<h2>La relation n:n (many to many)<a class="headerlink" href="#la-relation-n-n-many-to-many" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>
définit une relation n:n entre deux entités. Cette annotation ne peut
être utilisée qu’avec une collection d’éléments puisqu’elle implique
qu’il peut y avoir plusieurs entités associées.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">Exemple de relation ManyToMany</span><a class="headerlink" href="#id15" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToMany</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinTable</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@ManyToMany</span>
  <span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_competence&quot;</span><span class="p">,</span>
             <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">),</span>
             <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;competence_id&quot;</span><span class="p">))</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Competence</span><span class="o">&gt;</span> <span class="n">competences</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">La classe associée dans la relation ManyToMany</span><a class="headerlink" href="#id16" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Competence</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a> implique qu’il existe une table d’association. On
utilise l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinTable.html">&#64;JoinTable</a> pour préciser le nom de la table d’association
et le nom des colonnes contenant la clé pour l’individu et la clé pour la compétence.</p>
<div class="figure align-default" id="id17">
<img alt="../_images/relation_many2many.png" src="../_images/relation_many2many.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données correspondant à la relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a></span><a class="headerlink" href="#id17" title="Lien permanent vers cette image">¶</a></p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Dans une requête JPQL, une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a> <strong>n’est pas navigable
directement</strong>. Si on désire exprimer un requête de la forme</p>
<blockquote>
<div><div class="line-block">
<div class="line">Sélectionner les individus dont une des competences à l’id 1.</div>
</div>
</div></blockquote>
<p>alors il faut utiliser en JPQL la <a class="reference external" href="https://en.wikibooks.org/wiki/Java_Persistence/JPQL#JOIN">syntaxe du fetch</a> pour faire apparaître
une variable intermédiaire dans la requête :</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>select i from Individu i join i.competences c where c.id = 1</strong></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="les-relations-bi-directionnelles">
<h2>Les relations bi-directionnelles<a class="headerlink" href="#les-relations-bi-directionnelles" title="Lien permanent vers ce titre">¶</a></h2>
<p>Parfois, il est nécessaire de construire un lien entre deux objets qui
soit navigables dans les deux sens. D’un point de vue objet, cela
signifie que chaque objet dispose d’un attribut pointant sur l’autre
instance. Mais d’un point de vue du schéma de base de données
relationnelle, il s’agit du même lien. Avec JPA, il est possible de
qualifier une relation entre deux objets comme étant une relation
inverse grâce à l’attribut <code class="docutils literal notranslate"><span class="pre">mappedBy</span></code> de l’annotation indiquant le
type de relation.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">Exemple de relation ManyToMany</span><a class="headerlink" href="#id18" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToMany</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinTable</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@ManyToMany</span>
  <span class="nd">@JoinTable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_competence&quot;</span><span class="p">,</span>
             <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">),</span>
             <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;competence_id&quot;</span><span class="p">))</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Competence</span><span class="o">&gt;</span> <span class="n">competences</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">Exemple d’une relation bi-directionnelle avec <code class="docutils literal notranslate"><span class="pre">mappedBy</span></code></span><a class="headerlink" href="#id19" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToMany</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Competence</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

<span class="hll">  <span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;competences&quot;</span><span class="p">)</span>
</span>  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">individus</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple précédent, l’attribut <code class="docutils literal notranslate"><span class="pre">individus</span></code> dans la classe <code class="docutils literal notranslate"><span class="pre">Competence</span></code>
correspond à la même relation que celle décrite par l’attribut <code class="docutils literal notranslate"><span class="pre">competences</span></code>
dans la classe <code class="docutils literal notranslate"><span class="pre">Individu</span></code>. Ces deux attributs traduisent la même relation dans
le modèle relationnel de base de données. Il faut donc indiquer à JPA qu’il
existe un lien logique entre ces deux attributs. L’attribut <code class="docutils literal notranslate"><span class="pre">mappedBy</span></code> de
l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a> permet d’indiquer le nom de l’attribut qui décrit
la même relation dans l’autre entité. Dans notre exemple, on déclare dans la
classe <code class="docutils literal notranslate"><span class="pre">Competence</span></code> que l’attribut <code class="docutils literal notranslate"><span class="pre">individus</span></code> correspond à l’attribut
<code class="docutils literal notranslate"><span class="pre">competences</span></code> de la classe <code class="docutils literal notranslate"><span class="pre">Individu</span></code>.</p>
<p>Vous n’avez aucune obligation à déclarer une relation bi-directionnelle et, si
vous le faites, il n’existe pas de règle pour décider lequel des deux attributs
doit être déclaré <code class="docutils literal notranslate"><span class="pre">mappedBy</span></code>.</p>
<p>Par contre, vous <strong>ne devez pas</strong> utiliser <code class="docutils literal notranslate"><span class="pre">mappedBy</span></code> dans la déclaration
des deux attributs mais uniquement pour celui qui est en quelque sorte le sens
secondaire de la relation. L’attribut <code class="docutils literal notranslate"><span class="pre">mappedBy</span></code> est une façon de dire à JPA
que l’attribut ne représente pas le sens privilégié de la relation et que, s’il
désire obtenir des informations sur cette relation, il doit regarder la déclaration
de l’autre attribut. Il s’agit d’un moyen d’éviter de la duplication d’informations.
En effet, les annotations comme <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinTable.html">&#64;JoinTable</a> et <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinColumn.html">&#64;JoinColumn</a> ne doivent être
ajoutées qu’à l’attribut qui n’a pas la déclaration <code class="docutils literal notranslate"><span class="pre">mappedBy</span></code>.</p>
<p>Les relations bi-directionnelles ne sont pas limitées aux relations <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>.
À une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> peut correspondre une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> et à
une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a> peut correspondre une relation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a>.</p>
</div>
<div class="section" id="la-propagation-en-cascade">
<h2>La propagation en cascade<a class="headerlink" href="#la-propagation-en-cascade" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avec JPA, il est possible de propager des modifications à tout ou partie
des entités liées. Les annotations permettant de spécifier une relation
possèdent un attribut <code class="docutils literal notranslate"><span class="pre">cascade</span></code> permettant de spécifier les opérations
concernées : <code class="docutils literal notranslate"><span class="pre">ALL</span></code>, <code class="docutils literal notranslate"><span class="pre">DETACH</span></code>, <code class="docutils literal notranslate"><span class="pre">MERGE</span></code>, <code class="docutils literal notranslate"><span class="pre">PERSIST</span></code>, <code class="docutils literal notranslate"><span class="pre">REFRESH</span></code> ou
<code class="docutils literal notranslate"><span class="pre">REMOVE</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">Exemple d’opérations en cascade</span><a class="headerlink" href="#id20" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.CascadeType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="p">{</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">PERSIST</span><span class="p">,</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">MERGE</span> <span class="p">})</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple précédent, on précise que l’instance de société doit être
enregistrée en base si nécessaire au moment où l’instance d’Individu
sera elle-même enregistrée. De plus, lors d’un appel à merge pour une
instance d’Individu, un merge sera automatiquement realisé sur
l’instance de l’attribut société.</p>
</div>
<div class="section" id="requetes-jpql-et-jointure">
<h2>Requêtes JPQL et jointure<a class="headerlink" href="#requetes-jpql-et-jointure" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dès que l’on introduit des relations entre entités, on complexifie également
le langage de requêtage. Comment par exemple demander la liste des individus
travaillant pour une société dont on passe le nom en paramètre ? On peut
utiliser une jointure avec une condition :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>select i from Individu i join i.societe s where s.nom = :nom
</pre></div>
</div>
<p>Il est également possible d’utiliser le mot-clé <code class="docutils literal notranslate"><span class="pre">on</span></code> pour filtrer les entités
à sélectionner dans la jointure :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>select i from Individu i join i.societe s on s.nom = :nom
</pre></div>
</div>
<p>Comme en SQL, JPQL fait la différence entre une jointure et une jointure
externe (<em>left outer join</em>). Avec une jointure simple, on élimine toutes les
entités pour lesquelles la jointure n’existe pas. Alors qu’avec une jointure
externe, nous préservons les entités pour lesquelles il n’existe pas de jointure.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>select i from Individu i left join i.societe s on s.nom = :nom
</pre></div>
</div>
<p>Attention avec l’exemple de requête ci-dessus : elle retourne l’union des individus qui
n’ont aucune relation avec l’entité société et ceux qui ont une relation avec
une société dont le nom est donné par le paramètre <code class="docutils literal notranslate"><span class="pre">:nom</span></code>.</p>
</div>
<div class="section" id="fetch-lazy-ou-fetch-eager">
<h2>Fetch lazy ou fetch eager<a class="headerlink" href="#fetch-lazy-ou-fetch-eager" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lorsque JPA doit charger une entité depuis la base de données (qu’il
s’agisse d’un appel à <code class="docutils literal notranslate"><span class="pre">EntityManager.find(...)</span></code> ou d’une requête), la
question est de savoir quelles informations doivent être chargées.
Doit-il charger tous les attributs d’une entité ? Parmi ces attributs,
doit-il charger les entités qui sont en relation avec l’entité chargée ?
Ces questions sont importantes, car la façon d’y répondre peut avoir un
impact sur les performances de l’application.</p>
<p>Dans JPA, l’opération de chargement d’une entité depuis la base de
données est appelée <strong>fetch</strong>. Un fetch peut avoir deux stratégies :
<strong>eager</strong> ou <strong>lazy</strong> (que l’on peut traduire respectivement et
approximativement par <em>chargement immédiat</em> et <em>chargement différé</em>). On
peut décider de la stratégie pour chaque membre de la classe grâce à
l’attribut <code class="docutils literal notranslate"><span class="pre">fetch</span></code> présent sur les annotations <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Basic.html">&#64;Basic</a>, <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a>,
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a>, <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> et <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>.</p>
<ul class="simple">
<li><p><strong>eager</strong> signifie que l’information doit être chargée
systématiquement lorsque l’entité est chargée. Cette stratégie est
appliquée par défaut pour <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Basic.html">&#64;Basic</a>, <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToOne.html">&#64;OneToOne</a> et <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a>.</p></li>
<li><p><strong>lazy</strong> signifie que l’information ne sera chargée qu’à la demande
(par exemple lorsque la méthode <code class="docutils literal notranslate"><span class="pre">get</span></code> de l’attribut sera appelée).
Cette stratégie est appliquée par défaut pour <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/OneToMany.html">&#64;OneToMany</a> et
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">Exemple d’utilisation de fetch lazy</span><a class="headerlink" href="#id21" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Basic</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.FetchType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">   * Stocke la photo d&#39;identité sous une forme binaire. Comme l&#39;information peut être</span>
<span class="cm">   * volumineuse, on déclare un fetch lazy pour ne déclencher le chargement qu&#39;à l&#39;appel</span>
<span class="cm">   * de getPhoto(), c&#39;est-à-dire quand l&#39;application en a vraiment besoin.</span>
<span class="cm">   */</span>
  <span class="nd">@Lob</span>
  <span class="nd">@Basic</span><span class="p">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">photo</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Exécute une requête de la forme : SELECT i.id FROM Individu i WHERE i.id = ?</span>
<span class="c1">// Un appel à la méthode find ne charge pas les attributs marqués avec un fetch lazy.</span>
<span class="n">Individu</span> <span class="n">persistedIndividu</span> <span class="o">=</span> <span class="n">entityManager</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">Individu</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">individuId</span><span class="p">);</span>

<span class="c1">// Exécute une requête de la forme : SELECT i.photo FROM Individu i WHERE i.id = ?</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">photo</span> <span class="o">=</span> <span class="n">persistedIndividu</span><span class="p">.</span><span class="na">getPhoto</span><span class="p">();</span>

<span class="c1">// Exécute une requête de la forme :  SELECT * FROM Societe WHERE id = ?</span>
<span class="n">Societe</span> <span class="n">societe</span> <span class="o">=</span> <span class="n">persistedIndividu</span><span class="p">.</span><span class="na">getSociete</span><span class="p">();</span>
</pre></div>
</div>
<p>Il est possible d’utiliser une requête JPQL pour forcer la récupération d’informations
en mode <em>lazy</em> si on sait qu’elle seront nécessaires plus tard dans le programme.
Cela limite le nombre de requêtes à exécuter et peut se révéler nécessaire si
la consultation des attributs <em>lazy</em> doit se faire à un moment où un <em>entity manager</em>
n’est plus disponible. On utilise dans la requête l’option
<a class="reference external" href="https://en.wikibooks.org/wiki/Java_Persistence/JPQL#JOIN_FETCH">JOIN FETCH</a> :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Exécute une requête de type JOIN FETCH</span>
<span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;select i from Individu i left join fetch i.societe where i.id = :id&quot;</span><span class="p">;</span>
<span class="n">Individu</span> <span class="n">persistedIndividu</span> <span class="o">=</span> <span class="n">entityManager</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Individu</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
                                          <span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">individuId</span><span class="p">)</span>
                                          <span class="p">.</span><span class="na">getSingleResult</span><span class="p">();</span>

<span class="c1">// N&#39;exécute aucune requête car la société a déjà été récupérée par le left join fetch</span>
<span class="n">Societe</span> <span class="n">societe</span> <span class="o">=</span> <span class="n">persistedIndividu</span><span class="p">.</span><span class="na">getSociete</span><span class="p">();</span>
</pre></div>
</div>
<p>La définition des stratégies de fetch est une partie importante du
tuning dans le développement d’une application utilisant JPA.</p>
</div>
<div class="section" id="relation-avec-des-attributs">
<h2>Relation avec des attributs<a class="headerlink" href="#relation-avec-des-attributs" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans un modèle relationnel, il est courant que des tables d’association contiennent
des colonnes pour caractériser une relation. Reprenons et complétons l’exemple de
relation n:n présenté plus haut : un individu peut être associé à une ou plusieurs
compétences et, pour chacune de ces compétences, il dispose d’un niveau de maîtrise
(disons entre 0 et 5). Nous pouvons très facilement représenter cette relation
avec le schéma suivant :</p>
<div class="figure align-default" id="id22">
<img alt="../_images/relation_many2many_with_attribute.png" src="../_images/relation_many2many_with_attribute.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données avec un attribut sur la relation entre Individu et Competence</span><a class="headerlink" href="#id22" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Cependant, dans le modèle objet, une relation entre deux objets ne peut pas avoir
d’attribut. Pour ce type de <em>mapping</em>, nous avons une différence importante
entre le modèle relationnel et le modèle objet. Si nous voulons traduire la colonne
<code class="docutils literal notranslate"><span class="pre">niveau_maitrise</span></code> en Java, nous devons créer une entité pour représenter la table
<code class="docutils literal notranslate"><span class="pre">individu_competence</span></code>. Ainsi, ce modèle ne peut pas être traduit comme une
relation n:n entre deux entités <code class="docutils literal notranslate"><span class="pre">Individu</span></code> et <code class="docutils literal notranslate"><span class="pre">Competence</span></code> mais comme deux
relations 1:n :</p>
<ul class="simple">
<li><p>une relation 1:N entre <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> et <code class="docutils literal notranslate"><span class="pre">Individu</span></code></p></li>
<li><p>une relation 1:N entre <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> et <code class="docutils literal notranslate"><span class="pre">Competence</span></code></p></li>
</ul>
<p>La classe <code class="docutils literal notranslate"><span class="pre">Competence</span></code> reste identique à l’exemple vu précédemment :</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">La classe Competence</span><a class="headerlink" href="#id23" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Competence</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Pour réaliser le reste du <em>mapping</em>, nous avons le choix entre trois solutions.
En effet, il existe plusieurs <em>mappings</em> pour représenter la clé composée de la
table <code class="docutils literal notranslate"><span class="pre">individu_competence</span></code>.</p>
<div class="section" id="solution-1-referencer-la-cle-composee-avec-idclass">
<h3>Solution 1 : Référencer la clé composée avec &#64;IdClass<a class="headerlink" href="#solution-1-referencer-la-cle-composee-avec-idclass" title="Lien permanent vers ce titre">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">La classe IndividuCompetence</span><a class="headerlink" href="#id24" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.IdClass</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_competence&quot;</span><span class="p">)</span>
<span class="nd">@IdClass</span><span class="p">(</span><span class="n">IndividuCompetencePK</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndividuCompetence</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">individuId</span><span class="p">;</span>

  <span class="nd">@Id</span>
  <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;competence_id&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">competenceId</span><span class="p">;</span>

  <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;niveau_maitrise&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">niveauMaitrise</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">,</span> <span class="n">insertable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Individu</span> <span class="n">individu</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;competence_id&quot;</span><span class="p">,</span> <span class="n">insertable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Competence</span> <span class="n">competence</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNiveauMaitrise</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">niveauMaitrise</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNiveauMaitrise</span><span class="p">(</span><span class="kt">int</span> <span class="n">niveauMaitrise</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">niveauMaitrise</span> <span class="o">=</span> <span class="n">niveauMaitrise</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">Individu</span> <span class="nf">getIndividu</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">individu</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndividu</span><span class="p">(</span><span class="n">Individu</span> <span class="n">individu</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">individu</span> <span class="o">=</span> <span class="n">individu</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">individuId</span> <span class="o">=</span> <span class="n">individu</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">Competence</span> <span class="nf">getCompetence</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">competence</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCompetence</span><span class="p">(</span><span class="n">Competence</span> <span class="n">competence</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">competence</span> <span class="o">=</span> <span class="n">competence</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">competenceId</span> <span class="o">=</span> <span class="n">competence</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La classe <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> est l’entité qui représente la table
<code class="docutils literal notranslate"><span class="pre">individu_competence</span></code>, elle déclare deux relations <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> : à la ligne
25 pour la relation avec l’entité <code class="docutils literal notranslate"><span class="pre">Individu</span></code> et à la ligne 29 pour la relation
avec l’entité <code class="docutils literal notranslate"><span class="pre">Competence</span></code>. Elle dispose d’un attribut <code class="docutils literal notranslate"><span class="pre">niveauMaitrise</span></code> afin
de fournir l’information sur la relation.</p>
<p>L’inconvénient est que cette entité dispose d’une clé primaire composée des deux
clés étrangères de l’association (<code class="docutils literal notranslate"><span class="pre">individu_id</span></code> et <code class="docutils literal notranslate"><span class="pre">competence_id</span></code>).
Nous sommes donc obligés de déclarer deux attributs avec l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Id.html">&#64;Id</a> pour
identifier les deux attributs qui forment la clé composée (lignes 14 et 18).
Remarquez que nous n’utilisons pas l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/GeneratedValue.html">&#64;GeneratedValue</a> pour ces
attributs. En effet, la clé ne doit pas être générée puisqu’elle est la composition
de deux autres clés déjà existantes : celle de <code class="docutils literal notranslate"><span class="pre">Individu</span></code> et celle de <code class="docutils literal notranslate"><span class="pre">Competence</span></code>.</p>
<p>Notre <em>mapping</em> associe deux fois les colonnes <code class="docutils literal notranslate"><span class="pre">individu_id</span></code> et <code class="docutils literal notranslate"><span class="pre">competence_id</span></code>
à des attributs de la classe puisque ces deux colonnes sont à la fois des composantes
de la clé primaire et des clés étrangères. Nous sommes donc obligés d’indiquer à JPA
qu’il ne doit pas tenir compte de ces colonnes lorsqu’il doit faire des insertions
et des mises à jour pour les colonnes de jointure. C’est la signification
des attributs <code class="docutils literal notranslate"><span class="pre">insertable</span> <span class="pre">=</span> <span class="pre">false</span></code> et <code class="docutils literal notranslate"><span class="pre">updatable</span> <span class="pre">=</span> <span class="pre">false</span></code> pour les annotations
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/JoinColumn.html">&#64;JoinColumn</a> aux lignes 26 et 30.</p>
<p>Plutôt que de fournir des getters/setters aux attributs <code class="docutils literal notranslate"><span class="pre">individuId</span></code> et
<code class="docutils literal notranslate"><span class="pre">competenceId</span></code>, nous préférons les mettre à jour lorsqu’on invoque les
méthodes <code class="docutils literal notranslate"><span class="pre">setIndividu</span></code> (ligne 47) et <code class="docutils literal notranslate"><span class="pre">setCompetence</span></code> (ligne 56). En effet,
ces identifiants sont en fait dupliqués puisqu’ils doivent être identiques à
la valeur des identifiants des objets de type <code class="docutils literal notranslate"><span class="pre">Individu</span></code> et <code class="docutils literal notranslate"><span class="pre">Competence</span></code>.</p>
<p>Une entité JPA doit forcément disposer d’une classe qui représente sa clé. Jusqu’à
présent, nous avons toujours déclaré des clés de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Long.html">Long</a>, une classe déjà
fournie par la bibliothèque standard Java. Dans le cas de l’entité
<code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code>, nous avons déclaré deux clés dans la classe. Il faut
donc fournir une classe supplémentaire pour représenter la composition de ces
deux clés. Grâce à l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/IdClass.html">&#64;IdClass</a>, nous indiquons à la ligne 11 le type
de la classe Java qui représente la clé composée pour cette entité.</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">La classe IndividuCompetencePK</span><a class="headerlink" href="#id25" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndividuCompetencePK</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="n">Long</span> <span class="n">individuId</span><span class="p">;</span>

  <span class="kd">private</span> <span class="n">Long</span> <span class="n">competenceId</span><span class="p">;</span>

  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getIndividuId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">individuId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndividuId</span><span class="p">(</span><span class="n">Long</span> <span class="n">individuId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">individuId</span> <span class="o">=</span> <span class="n">individuId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getCompetenceId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">competenceId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCompetenceId</span><span class="p">(</span><span class="n">Long</span> <span class="n">competenceId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">competenceId</span> <span class="o">=</span> <span class="n">competenceId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">IndividuCompetencePK</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">IndividuCompetencePK</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">(</span><span class="n">IndividuCompetencePK</span><span class="p">)</span> <span class="n">other</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">individuId</span><span class="p">,</span> <span class="n">pk</span><span class="p">.</span><span class="na">individuId</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
             <span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">competenceId</span><span class="p">,</span> <span class="n">pk</span><span class="p">.</span><span class="na">competenceId</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="na">hash</span><span class="p">(</span><span class="n">individuId</span><span class="p">,</span> <span class="n">competenceId</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La classe <code class="docutils literal notranslate"><span class="pre">IndividuCompetencePK</span></code> représente la clé de la classe
<code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code>. Son implémentation doit respecter les contraintes suivantes :</p>
<ul class="simple">
<li><p>elle doit implémenter l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/Serializable.html">Serializable</a> (ligne 4),</p></li>
<li><p>elle doit déclarer tous les attributs qui composent la clé primaire (lignes 6 et 8),</p></li>
<li><p>elle doit fournir une implémentation pour les méthodes <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)">equals</a> (ligne 26) et
<a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#hashCode()">hashCode</a> (ligne 35).</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">La classe Individu</span><a class="headerlink" href="#id26" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.CascadeType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span>  <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@OneToMany</span><span class="p">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">&quot;individu&quot;</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">IndividuCompetence</span><span class="o">&gt;</span> <span class="n">individuCompetences</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Pour notre exemple, il paraît utile qu’un objet de type <code class="docutils literal notranslate"><span class="pre">Individu</span></code> possède une
liste de <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> pour permettre au programme de connaître le niveau
de compétence d’un individu donné. La relation entre <code class="docutils literal notranslate"><span class="pre">Individu</span></code> et <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code>
est donc bi-directionnelle (ligne 18).</p>
<p>Notez que la relation avec la liste <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> indique une propagation
en cascade pour toutes les opérations. En effet, d’un point de vue objet, cette
relation est très certainement une relation de composition (aussi appelée
agrégation composite en UML) et dénote un lien très fort entre ces entités.</p>
</div>
<div class="section" id="solution-2-referencer-la-cle-composee-avec-embeddedid">
<h3>Solution 2 : Référencer la clé composée avec &#64;EmbeddedId<a class="headerlink" href="#solution-2-referencer-la-cle-composee-avec-embeddedid" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’implémentation précédente a un inconvénient : elle oblige à dupliquer les
attributs représentant la clé composée de l’entité <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> dans
la classe <code class="docutils literal notranslate"><span class="pre">IndividuCompetencePK</span></code> qui représente la clé. Il est possible
d’utiliser la notion de clé embarquée pour éviter cette duplication. Le code Java
devient alors :</p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">La classe IndividuCompetencePK</span><a class="headerlink" href="#id27" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Embeddable</span><span class="p">;</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndividuCompetencePK</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="p">{</span>

  <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">individuId</span><span class="p">;</span>

  <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;competence_id&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">competenceId</span><span class="p">;</span>

  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getIndividuId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">individuId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndividuId</span><span class="p">(</span><span class="n">Long</span> <span class="n">individuId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">individuId</span> <span class="o">=</span> <span class="n">individuId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getCompetenceId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">competenceId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCompetenceId</span><span class="p">(</span><span class="n">Long</span> <span class="n">competenceId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">competenceId</span> <span class="o">=</span> <span class="n">competenceId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">IndividuCompetencePK</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">IndividuCompetencePK</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">(</span><span class="n">IndividuCompetencePK</span><span class="p">)</span> <span class="n">other</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">individuId</span><span class="p">,</span> <span class="n">pk</span><span class="p">.</span><span class="na">individuId</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">competenceId</span><span class="p">,</span> <span class="n">pk</span><span class="p">.</span><span class="na">competenceId</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="na">hash</span><span class="p">(</span><span class="n">individuId</span><span class="p">,</span> <span class="n">competenceId</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La classe <code class="docutils literal notranslate"><span class="pre">IndividuCompetencePK</span></code> utilise l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Embeddable.html">&#64;Embeddable</a> (ligne 9)
pour indiquer qu’elle peut être utilisée dans une entité pour fournir une partie
du <em>mapping</em>. Ainsi, elle déclare le <em>mapping</em> pour les attributs <code class="docutils literal notranslate"><span class="pre">individuId</span></code> et
<code class="docutils literal notranslate"><span class="pre">competenceId</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">La classe IndividuCompetence</span><a class="headerlink" href="#id28" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EmbeddedId</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_competence&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndividuCompetence</span> <span class="p">{</span>

  <span class="nd">@EmbeddedId</span>
  <span class="kd">private</span> <span class="n">IndividuCompetencePK</span> <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndividuCompetencePK</span><span class="p">();</span>

  <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;niveau_maitrise&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">niveauMaitrise</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">,</span> <span class="n">insertable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Individu</span> <span class="n">individu</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;competence_id&quot;</span><span class="p">,</span> <span class="n">insertable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Competence</span> <span class="n">competence</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNiveauMaitrise</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">niveauMaitrise</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNiveauMaitrise</span><span class="p">(</span><span class="kt">int</span> <span class="n">niveauMaitrise</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">niveauMaitrise</span> <span class="o">=</span> <span class="n">niveauMaitrise</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">Individu</span> <span class="nf">getIndividu</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">individu</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndividu</span><span class="p">(</span><span class="n">Individu</span> <span class="n">individu</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">individu</span> <span class="o">=</span> <span class="n">individu</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">setIndividuId</span><span class="p">(</span><span class="n">individu</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">Competence</span> <span class="nf">getCompetence</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">competence</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCompetence</span><span class="p">(</span><span class="n">Competence</span> <span class="n">competence</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">competence</span> <span class="o">=</span> <span class="n">competence</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">setCompetenceId</span><span class="p">(</span><span class="n">competence</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La classe <code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> n’utilise plus l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/IdClass.html">&#64;IdClass</a> et ne
déclare plus les différents attributs composant la clé. À la place, elle déclare
un attribut de type <code class="docutils literal notranslate"><span class="pre">IndividuCompetencePK</span></code> avec l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/EmbeddedId.html">&#64;EmbeddedId</a>
(ligne 12) pour signaler à JPA que cet attribut fournit le <em>mapping</em> de la clé
composée. Le reste du code de la classe est adapté en fonction.</p>
</div>
<div class="section" id="solution-3-utiliser-une-cle-technique-simple">
<h3>Solution 3 : Utiliser une clé technique simple<a class="headerlink" href="#solution-3-utiliser-une-cle-technique-simple" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il est important de comprendre que la complexité du <em>mapping</em> d’une table
d’association en Java vient du fait qu’un modèle relationnel et un modèle objet
ne se recoupent qu’imparfaitement. Dans les deux solutions vues précédemment, nous
adaptons le modèle objet pour qu’il corresponde au modèle relationnel. Mais nous
pouvons tout aussi bien adapter le modèle relationnel pour correspondre au modèle
objet. Pour cela, il suffit de dénormaliser le modèle relationnel en ajoutant
une colonne pour la clé primaire dans la table <code class="docutils literal notranslate"><span class="pre">individu_competence</span></code>.</p>
<div class="figure align-default" id="id29">
<img alt="../_images/relation_many2many_with_attribute_denormalized.png" src="../_images/relation_many2many_with_attribute_denormalized.png" />
<p class="caption"><span class="caption-text">Le modèle de base de données dénormalisé</span><a class="headerlink" href="#id29" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Dans ce cas, nous n’avons plus besoin d’une classe spécifique pour représenter
la clé et nous pouvons nous contenter de l’implémentation suivante pour la classe
<code class="docutils literal notranslate"><span class="pre">IndividuCompetence</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text">La classe IndividuCompetence</span><a class="headerlink" href="#id30" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="p">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_competence&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndividuCompetence</span> <span class="p">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

  <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;niveau_maitrise&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">niveauMaitrise</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Individu</span> <span class="n">individu</span><span class="p">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;competence_id&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Competence</span> <span class="n">competence</span><span class="p">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="jpa_inheritance.html" class="btn btn-neutral float-right" title="L’héritage avec JPA" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jpa_queries.html" class="btn btn-neutral float-left" title="Les requêtes JPA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  <div  role="contentinfo">
    <p>
    Par David Gayerie
    - <script>!function(){function e(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})}!function(e){document.write("<a href='mailto:"+e+"'>"+e+"</a>")}(e("qnivq@tnlrevr.qri"))}();</script>
    - <a class="reference external" href="https://gayerie.dev">https://gayerie.dev</a>
    </p>
    <p class="copyright">
      <a class="reference external image-reference" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" src="https://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a>
      Cette œuvre est mise à disposition selon les termes de la <a class="reference external" href="https://creativecommons.org/licenses/by-sa/3.0/fr/">Licence Creative Commons Attribution</a> -  Partage dans les Mêmes Conditions 3.0 France
    </p>
  </div>


</footer>

        </div>

      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99071053-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>