

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  <meta content="David Gayerie" name="author" />
<meta content="Développement d'application Android" name="description" />
<meta content="android, android studio, java, programmation objet" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Les activités &mdash; Documentation Développement Android </title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://gayerie.dev/docs/java-android/android/activity.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Gestion des activités d’une application" href="activity_stack.html" />
    <link rel="prev" title="Conception d’interfaces graphiques" href="ui_layout.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Développement Android
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Développement d'applications pour Android</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="premiere_app.html">Une première application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#creation-d-une-application-simple">Création d’une application simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#organisation-du-projet">Organisation du projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#lancement-de-l-application">Lancement de l’application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#l-emulateur-android">L’émulateur Android</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#notion-d-activite">Notion d’activité</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#notion-de-ressources">Notion de ressources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#acceder-a-un-identifiant-de-ressource-depuis-le-code-java">Accéder à un identifiant de ressource depuis le code Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#acceder-a-une-ressource-depuis-une-autre-ressource">Accéder à une ressource depuis une autre ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#identifier-une-ressource-dans-un-layout">Identifier une ressource dans un layout</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#exercices">Exercices</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#le-fichier-androidmanifest-xml">Le fichier AndroidManifest.xml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ui_layout.html">Conception d’interfaces graphiques</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#view-et-layout">View et Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#layout-xml">Layout XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#layout-lineaire-et-positionnement">Layout linéaire et positionnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#techniques-avancees-de-positionnement-dans-un-layout">Techniques avancées de positionnement dans un layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#layout-margin-et-padding">layout_margin et padding</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#layout-gravity-et-gravity">layout_gravity et gravity</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#layout-weight">layout_weight</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#layout-par-contraintes">Layout par contraintes</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#ajouter-une-image">Ajouter une image</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#exemple-de-formulaire">Exemple de formulaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#la-barre-d-action">La barre d’action</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#creer-un-menu-dans-la-barre-d-action">Créer un menu dans la barre d’action</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#associer-un-menu-a-une-activite">Associer un menu à une activité</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#implementer-les-actions-associees-aux-items-de-menu">Implémenter les actions associées aux items de menu</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#les-boites-de-dialogue">Les boites de dialogue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#boite-de-dialogue-avec-boutons">Boite de dialogue avec boutons</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#boite-de-dialogue-avec-choix">Boite de dialogue avec choix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#message-a-l-utilisateur">Message à l’utilisateur</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#toast">Toast</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#snackbar">Snackbar</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Les activités</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#le-cycle-de-vie">Le cycle de vie</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminer-une-activite">Terminer une activité</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gestion-de-l-etat-d-une-activite">Gestion de l’état d’une activité</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notion-d-intent">Notion d’intent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#associer-une-activite-a-un-intent">Associer une activité à un intent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#emettre-un-intent-implicite">Émettre un intent implicite</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="activity_stack.html">Gestion des activités d’une application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#l-application-de-demo">L’application de démo</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#structure-de-l-application">Structure de l’application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="activity_stack.html#l-activite-principale-et-recyclerview">L’activité principale et RecyclerView</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#detail-d-une-occupation-et-pile-des-activites">Détail d’une occupation et pile des activités</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#ouverture-d-une-activite-intent-explicite">Ouverture d’une activité (intent explicite)</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#strategie-de-gestion-de-la-pile-des-activites">Stratégie de gestion de la pile des activités</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#terminer-une-activite">Terminer une activité</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="broadcast.html">Gestion des messages broadcast</a><ul>
<li class="toctree-l2"><a class="reference internal" href="broadcast.html#le-broadcastreceiver">Le BroadcastReceiver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="broadcast.html#suivre-le-branchement-sur-secteur">Suivre le branchement sur secteur</a></li>
<li class="toctree-l3"><a class="reference internal" href="broadcast.html#suivre-l-etat-de-la-connexion-wifi">Suivre l’état de la connexion Wifi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="broadcast.html#recevoir-des-broadcasts-depuis-une-activite">Recevoir des broadcasts depuis une activité</a></li>
<li class="toctree-l2"><a class="reference internal" href="broadcast.html#emettre-un-message-broadcast">Émettre un message broadcast</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="acces_web.html">Accès Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="acces_web.html#permission-pour-l-acces-internet">Permission pour l’accès Internet</a></li>
<li class="toctree-l2"><a class="reference internal" href="acces_web.html#utilisation-de-la-classe-url">Utilisation de la classe URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="acces_web.html#utilisation-de-la-bibliotheque-volley">Utilisation de la bibliothèque Volley</a><ul>
<li class="toctree-l3"><a class="reference internal" href="acces_web.html#ajout-de-la-dependance">Ajout de la dépendance</a></li>
<li class="toctree-l3"><a class="reference internal" href="acces_web.html#emission-d-une-requete">Émission d’une requête</a></li>
<li class="toctree-l3"><a class="reference internal" href="acces_web.html#emission-d-une-requete-pour-une-reponse-json">Émission d’une requête pour une réponse JSON</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="service.html">Les services Android</a><ul>
<li class="toctree-l2"><a class="reference internal" href="service.html#service-en-tache-de-fond">Service en tâche de fond</a><ul>
<li class="toctree-l3"><a class="reference internal" href="service.html#implementation-et-declaration-du-service">Implémentation et déclaration du service</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#le-cycle-de-vie">Le cycle de vie</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#execution-en-tache-de-fond">Exécution en tâche de fond</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#interaction-avec-l-utilisateur">Interaction avec l’utilisateur</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#lancement-du-service">Lancement du service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="service.html#service-lie">Service lié</a><ul>
<li class="toctree-l3"><a class="reference internal" href="service.html#declaration-du-service">Déclaration du service</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#id1">Le cycle de vie</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#implementation-de-la-methode-onbind">Implémentation de la méthode onBind</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#lier-le-service-a-une-activite">Lier le service à une activité</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Développement Android</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Les activités</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="activity_stack.html" class="btn btn-neutral float-right" title="Gestion des activités d’une application" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ui_layout.html" class="btn btn-neutral float-left" title="Conception d’interfaces graphiques" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="les-activites">
<span id="activity"></span><h1>Les activités<a class="headerlink" href="#les-activites" title="Lien permanent vers ce titre">¶</a></h1>
<div class="exercice admonition">
<p class="admonition-title">Le projet d’exemple pour ce chapitre</p>
<p>Vous pouvez télécharger le projet servant d’exemple pour ce chapitre :
<a class="reference download internal" download="" href="../_downloads/2378c4764c6415f2a4d614f1f9a2cb2e/android-demo-activite.zip"><code class="xref download docutils literal notranslate"><span class="pre">android-demo-activite.zip</span></code></a></p>
</div>
<p>Une activité (<em>activity</em>) représente un écran dans une application Android. Nous
avons vu au chapitre précédent que l’emploi des <em>layouts</em> permet de garantir
un rendu adapté selon le type d’appareil et les dimensions de l’écran.</p>
<p>Pour développer des activités, il est aussi nécessaire de comprendre que
l’environnement Android se distingue du développement d’applications de bureau
ou d’applications Web. En effet, l’environnement Android est généralement plus
limité en ressources qu’un ordinateur classique. Il est donc important de limiter
au mieux l’usage de ces ressources (batterie, mémoire…). Pour cela, le
système Android gère un cycle de vie des activités en privilégiant l’économie
de ressources. Même si l’utilisateur peut avoir l’impression que l’écran
qui lui est présenté existe aussi longtemps que l’application s’exécute, dans
la réalité, l’activité associée peut être détruite et recréée plusieurs fois
durant la vie de l’application. Par exemple, si l’utilisateur répond au téléphone
alors qu’une activité s’exécute, cette dernière est suspendue par le système et,
si nécessaire, le système peut décider de la supprimer pour économiser des
ressources. Lorsque l’utilisateur voudra reprendre l’utilisation de
l’application, l’activité sera intégralement recréée.</p>
<p>Le développement d’activités suppose de s’astreindre à tenir compte de ce cycle
de vie assez particulier afin que les applications se comportent comme attendues
quelle que soit la situation.</p>
<div class="section" id="le-cycle-de-vie">
<h2>Le cycle de vie<a class="headerlink" href="#le-cycle-de-vie" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reportez-vous à la documentation officielle :</p>
<blockquote>
<div><p><a class="reference external" href="https://developer.android.com/guide/components/activities/activity-lifecycle">https://developer.android.com/guide/components/activities/activity-lifecycle</a></p>
</div></blockquote>
</div>
<p>Les activités sont des composants, c’est-à-dire qu’il n’est pas possible d’instancier
directement une activité dans le code d’une application (avec le mot-clè <code class="docutils literal notranslate"><span class="pre">new</span></code>
par exemple). Une activité est créée et gérée par le système. Un développeur doit
donc être soucieux de respecter la façon dont le système va gérer les activités
de l’application. Le système Android définit un cycle de vie d’une activité :
cette dernière passe par des états différents. Une activité peut être prévenue
du passage dans un des états suivants :</p>
<ul class="simple">
<li><p>initialisée (<em>initialized</em>)</p></li>
<li><p>créée (<em>created</em>)</p></li>
<li><p>démarrée (<em>started</em>)</p></li>
<li><p>relancée (<em>resumed</em>)</p></li>
<li><p>mise en pause (<em>paused</em>)</p></li>
<li><p>arrêtée (<em>stopped</em>)</p></li>
<li><p>détruite (<em>destroyed</em>)</p></li>
</ul>
<p>Chaque passage vers un nouvel état (hormis initialisée) est signalé par un appel
à une méthode de <em>callback</em> : <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onCreate(android.os.Bundle)">onCreate</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStart()">onStart</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStop()">onStop</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onDestroy()">onDestroy</a>
plus la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onRestart()">onRestart</a> pour indiquer qu’une activité qui a été arrêtée
est à nouveau démarrée. Pour intervenir à un moment du cycle de vie de l’activité,
il suffit de redéfinir la méthode voulue. Attention, il faut penser à <strong>appeler
la super implémentation de la méthode</strong>.</p>
<p>Pour les méthodes <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onCreate(android.os.Bundle)">onCreate</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStart()">onStart</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a>, il vaut mieux appeler la super
implémentation avant son propre code :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>

    <span class="c1">// mon code ici</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pour les méthodes <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStop()">onStop</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onDestroy()">onDestroy</a>, il vaut mieux appeler
la super implémentation après son propre code :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// mon code ici</span>

    <span class="kd">super</span><span class="p">.</span><span class="na">onDestroy</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Le schéma ci-dessous détaille les transitions possibles entre chaque état avec
l’appel des méthodes de <em>callback</em>.</p>
<div class="figure align-default" id="id2">
<img alt="../_images/activity_lifecycle.png" src="../_images/activity_lifecycle.png" />
<p class="caption"><span class="caption-text">Le cycle de vie d’une activité (extrait de la
<a class="reference external" href="https://developer.android.com/guide/components/activities/activity-lifecycle">documentation officielle</a>)</span><a class="headerlink" href="#id2" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Pour mieux comprendre ce schéma, prenons un exemple. Un utilisateur lance une
application de consultation de mail qui doit afficher une activité pour présenter
la liste des mails. Cette activité est créée par le système et ses méthodes
<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onCreate(android.os.Bundle)">onCreate</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStart()">onStart</a> et <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a> sont appelées à la suite.
Après cela, l’activité est affichée à l’écran. L’utilisateur clique sur un mail
pour en consulter le détail. Cette action crée et affiche une nouvelle activité.
L’activité de liste des mails est arrêtée (<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a> puis <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStop()">onStop</a> sont appelées) car elle n’est plus
au premier plan. Puis l’utilisateur appuie sur le bouton <span class="guilabel">Back</span> qui
a pour objectif de le ramener sur la liste des mails. L’activité doit être à
nouveau affichée et ses méthodes <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onRestart()">onRestart</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStart()">onStart</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a> sont appelées
avant cela. Puis, l’utilisateur reçoit un coup de téléphone et répond. Cela amène
l’application de téléphonie en premier plan. Du coup, l’activité de liste des
mails est à nouveau arrêtée (<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStop()">onStop</a>). Comme la communication téléphonique
dure un certain temps, le système décide de libérer des ressources.
Lorsque l’utilisateur raccroche et revient à l’application de mails, l’activité
est entièrement recréée (<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onCreate(android.os.Bundle)">onCreate</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStart()">onStart</a>, <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a>). Enfin,
l’utilisateur consulte la liste des applications sur son téléphone. Cela amène
l’application en arrière-plan et suspend l’activité (<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a> et <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStop()">onStop</a>).
L’utilisateur décide d’arrêter l’application de mail. L’activité est alors
complètement détruite (<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onDestroy()">onDestroy</a>).</p>
<p>On voit avec l’exemple précédent que le cycle de vie d’une activité peut être
très complexe à décrire. Cette complexité permet au développeur de gérer
au mieux les ressources lorsqu’il implémente une activité. Pour chaque
méthode de <em>callback</em> nous allons fournir quelques bonnes pratiques.</p>
<dl class="simple">
<dt><a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onCreate(android.os.Bundle)">onCreate</a></dt><dd><p>La redéfinition de cette méthode permet de réaliser les tâches d’initialisation
les plus coûteuse (comme par exemple, créer le <em>layout</em> d’affichage de l’activité).
C’est dans cette méthode que doivent être réalisés les traitements à exécuter
une seule fois pour toute la vie de l’activité.</p>
</dd>
<dt><a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStart()">onStart</a></dt><dd><p>La redéfinition de cette méthode permet de savoir quand une activité va
être rendue visible à l’utilisateur. Vous pouvez, par exemple, faire des mises
à jour de l’interface graphique avant affichage. Si votre activité joue une
animation, cette méthode est une bonne candidate pour lancer automatiquement
l’animation, soit parce que l’utilisateur démarre l’activité pour la première
fois soit parce que l’activité a été arrêtée et que l’animation doit
être continuée.</p>
</dd>
<dt><a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a></dt><dd><p>La redéfinition de cette méthode permet de savoir quand une activité va être
accessible (y compris quand elle sort d’une pause). C’est le bon moment
pour votre activité pour déclencher des opérations consommatrices de ressources
(activation de la caméra, ouverture de connexions réseau…)</p>
</dd>
<dt><a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a></dt><dd><p>La redéfinition de cette méthode permet de savoir quand une activité n’est
plus active pour l’utilisateur. C’est le moment de suspendre les
opérations consommatrices de ressources (désactivation de la caméra,
fermeture des connexions réseau…). Attention, une activité en pause peut
toujours être visible de l’utilisateur. Vous ne devriez donc pas utiliser
cette méthode pour modifier l’interface graphique ou stopper des animations.</p>
</dd>
<dt><a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStop()">onStop</a></dt><dd><p>La redéfinition de cette méthode permet de savoir que l’activité va être
stoppée et ne sera plus visible de l’utilisateur. Si votre activité a besoin de
sauvegarder des informations (notamment sur disque) pour pouvoir redémarrer
convenablement, vous pouvez effectuer ces traitements à ce moment-là. Vous
pouvez utiliser cette redéfinition pour stopper les opérations graphiques
(animations, lecteur de vidéo…).</p>
</dd>
<dt><a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onDestroy()">onDestroy</a></dt><dd><p>La redéfinition de cette méthode permet de savoir que l’activité va être
détruite. Il s’agit de l’ultime étape et vous pouvez effectuer ici
des traitements avant la suppression totale de l’activité. Attention, une
activité peut être détruite par le système pour libérer temporairement
des ressources. Cela ne signifie donc pas que l’activité a été simplement
fermée par l’utilisateur.</p>
</dd>
</dl>
<p>Il existe une méthode de <em>callback</em> particulière :</p>
<dl class="simple">
<dt><a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onRestart()">onRestart</a></dt><dd><p>La redéfinition de cette méthode permet de savoir qu’une activité va être
à nouveau démarrée après avoir été stoppée. L’appel à cette méthode se
situe entre <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStop()">onStop</a> et <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onStart()">onStart</a>. Cela permet plus facilement de faire
la différence entre le démarrage normal de l’activité et son redémarrage.</p>
</dd>
</dl>
<div class="section" id="terminer-une-activite">
<h3>Terminer une activité<a class="headerlink" href="#terminer-une-activite" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez terminer une activité en appelant sa méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#finish()">finish</a>. L’activité
est alors détruite en passant par tous les états nécessaires. Si vous voulez
savoir si l’activité est détruite suite à un appel à <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#finish()">finish</a>, vous pouvez
tester le retour de la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#isFinishing()">isFinishing</a>. Cette dernière méthode retourne
<code class="docutils literal notranslate"><span class="pre">false</span></code> si l’activité est détruite à la demande du système pour libérer des
ressources.</p>
</div>
</div>
<div class="section" id="gestion-de-l-etat-d-une-activite">
<h2>Gestion de l’état d’une activité<a class="headerlink" href="#gestion-de-l-etat-d-une-activite" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reportez-vous à la documentation officielle :</p>
<blockquote>
<div><p><a class="reference external" href="https://developer.android.com/topic/libraries/architecture/saving-states">https://developer.android.com/topic/libraries/architecture/saving-states</a></p>
</div></blockquote>
</div>
<p>Une des grandes difficultés lorsqu’on débute le développement d’activités est
la gestion de leur état. En effet, comme nous l’avons vu à la section précédente,
un objet activité peut être détruit et recréé plusieurs fois alors que l’utilisateur
à l’impression à chaque fois de voir le même écran. Si une activité possède un
état interne alors cet état doit être sauvé et restauré pour garantir une
expérience utilisateur cohérente. Pour illustrer cette situation, prenons un exemple
simple. Voici un exemple d’activité avec son <em>layout</em> :</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Une activité avec un état</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.premiereapplication</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.view.View</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">message</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">nbClics</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
        <span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_main</span><span class="p">);</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">textMessage</span><span class="p">);</span>
        <span class="n">updateMessage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBoutonClic</span><span class="p">(</span><span class="n">View</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">nbClics</span><span class="o">++</span><span class="p">;</span>
        <span class="n">updateMessage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">updateMessage</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">message</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Vous avez cliqué %d fois&quot;</span><span class="p">,</span> <span class="n">nbClics</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Le <em>layout</em> de l’activité</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;androidx.appcompat.widget.LinearLayoutCompat</span>
    <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/textMessage&quot;</span>
        <span class="na">android:padding=</span><span class="s">&quot;15dp&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:layout_gravity=</span><span class="s">&quot;center&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/button&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:text=</span><span class="s">&quot;Clic&quot;</span>
        <span class="na">android:onClick=</span><span class="s">&quot;onBoutonClic&quot;</span>
        <span class="na">android:layout_gravity=</span><span class="s">&quot;center&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/androidx.appcompat.widget.LinearLayoutCompat&gt;</span>
</pre></div>
</div>
</div>
<p>Cette application affiche un bouton et un message. À chaque fois que l’utilisateur
clique sur le bouton, l’attribut <code class="docutils literal notranslate"><span class="pre">nbClics</span></code> est incrémenté et le message est
mis à jour.</p>
<div class="figure align-default" id="id5">
<img alt="../_images/application_clic_avec_etat.png" src="../_images/application_clic_avec_etat.png" />
<p class="caption"><span class="caption-text">L’application au démarrage</span><a class="headerlink" href="#id5" title="Lien permanent vers cette image">¶</a></p>
</div>
<div class="figure align-default" id="id6">
<img alt="../_images/application_clic_avec_etat_2.png" src="../_images/application_clic_avec_etat_2.png" />
<p class="caption"><span class="caption-text">L’application après quelques clics</span><a class="headerlink" href="#id6" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Essayez cet exemple. Si vous cliquez plusieurs fois sur le bouton, le libellé est mis
à jour. Mais si vous changez l’orientation de votre téléphone, vous aurez la surprise
de voir à nouveau le message de départ : « Vous avez cliqué 0 fois ». Il se produira la
même chose si vous changez d’application et que vous revenez ensuite sur celle-ci.
Que se passe-t-il ? Le système gère votre activité comme décrit plus haut.
Lorsque vous changez l’orientation de votre téléphone ou que vous revenez à
l’application après l’avoir mise en tâche de fond, l’activité est entièrement
recréée : il s’agit d’un nouvel objet Java. Donc l’attribut <code class="docutils literal notranslate"><span class="pre">nbClics</span></code> vaut
à nouveau 0. Cet attribut constitue l’état de votre activité. Et à chaque fois
que le système décide de supprimer votre activité, cet état est perdu. Ce
comportement est rarement celui attendu par l’utilisateur. En tant que développeur,
vous devez donc gérer la sauvegarde et la restauration de l’état de votre
activité.</p>
<p>Pour cela, vous pouvez redéfinir les méthodes <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState</a> et
<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState</a>. La méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState</a> est appelée lorsque
le système va détruire l’activité pour récupérer des ressources afin que celle-ci
ait l’opportunité de sauver son contexte. Elle prend en paramètre un objet de
type <a class="reference external" href="https://developer.android.com/reference/android/os/Bundle">Bundle</a>. Un <a class="reference external" href="https://developer.android.com/reference/android/os/Bundle">bundle</a> permet de sauvegarder des types simples (valeur booléenne,
entier, chaîne de caractères…). Nous pouvons surcharger cette méthode pour
placer la valeur de l’attribut <code class="docutils literal notranslate"><span class="pre">nbClics</span></code> dans le <a class="reference external" href="https://developer.android.com/reference/android/os/Bundle">bundle</a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSaveInstanceState</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">savedInstanceState</span><span class="p">.</span><span class="na">putInt</span><span class="p">(</span><span class="s">&quot;nbClics&quot;</span><span class="p">,</span> <span class="n">nbClics</span><span class="p">);</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">onSaveInstanceState</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lorsque vous redéfinissez la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState</a>, <strong>vous devez
impérativement appeler sa super implémentation</strong> car l’activité a besoin de
sauvegarder d’autres informations d’état.</p>
<p>Pour récupérer les informations à la recréation, nous pouvons redéfinir la
méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState</a> pour, cette fois, lire les informations depuis
le <a class="reference external" href="https://developer.android.com/reference/android/os/Bundle">bundle</a> reçu en paramètre et mettre à jour le message :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onRestoreInstanceState</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">onRestoreInstanceState</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
    <span class="n">nbClics</span> <span class="o">=</span> <span class="n">savedInstanceState</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;nbClics&quot;</span><span class="p">);</span>
    <span class="n">updateMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lorsque vous redéfinissez la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState</a>, <strong>vous devez
impérativement appeler sa super implémentation</strong> car l’activité a besoin de
restaurer d’autres informations d’état.</p>
<p>Après l’ajout de ces deux méthodes, vous pouvez relancer l’application et constater
qu’elle fonctionne comme attendu même lorsqu’on modifie l’orientation du téléphone
ou que l’application est passée temporairement en arrière-plan.</p>
<p>Plutôt que de redéfinir la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onRestoreInstanceState(android.os.Bundle)">onRestoreInstanceState</a>, nous pouvons utiliser
directement la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onCreate(android.os.Bundle)">onCreate</a> qui prend en paramètre le <a class="reference external" href="https://developer.android.com/reference/android/os/Bundle">bundle</a>. Ce paramètre
vaut <code class="docutils literal notranslate"><span class="pre">null</span></code> lorque l’activité est créée la première fois.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
    <span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_main</span><span class="p">);</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">textMessage</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">savedInstanceState</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">nbClics</span> <span class="o">=</span> <span class="n">savedInstanceState</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;nbClics&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">updateMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>La gestion de l’état est parfois une partie complexe à gérer pour le développeur.
Pour nous aider, l’implémentation par défaut sauvegarde automatiquement les informations
d’état de chaque vue. Si votre activité affiche un formulaire avec des champs
de saisie, la valeur de ces champs est automatiquement sauvegardée et restaurée
<strong>si ces champs possèdent un id</strong> donné par l’attribut <code class="docutils literal notranslate"><span class="pre">android:id</span></code>.</p>
</div>
<p>Il existe d’autres manières de conserver l’état d’une activité. L’utilisation
d’un <a class="reference external" href="https://developer.android.com/reference/android/os/Bundle">bundle</a> est adaptée pour conserver des états simples et uniquement pour
gérer les cas de recréation de votre activité pour des raisons d’économie
de ressources. Si vous souhaitez disposer d’un état persistant lorsque l’utilisateur
relance l’application, vous devez opter pour une solution basée sur des fichiers
ou même une base de données. Le modèle par composant défini par Android <a class="reference external" href="https://developer.android.com/jetpack/">JetPack</a>
propose également une approche <a class="reference external" href="https://developer.android.com/topic/libraries/architecture/viewmodel">Model/View</a> pour gérer la sauvegarde d’état
lorsqu’une application est stoppée par le système.</p>
</div>
<div class="section" id="notion-d-intent">
<h2>Notion d’intent<a class="headerlink" href="#notion-d-intent" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reportez-vous à la documentation officielle :</p>
<blockquote>
<div><p><a class="reference external" href="https://developer.android.com/guide/components/intents-filters">https://developer.android.com/guide/components/intents-filters</a></p>
</div></blockquote>
</div>
<p>Un <em>intent</em> est un message qui est envoyé pour activer un composant Android
(comme une activité). Un <em>intent</em> peut être émis par un composant de l’application
vers un autre composant de l’application. Par exemple, une activité peut ainsi
démarrer une nouvelle activité (comme nous le verrons au chapitre suivant). Mais
un <em>intent</em> peut également servir à déclencher un composant d’une autre application.
Le système Android gère ainsi une système de messagerie inter-applicative. Certains
composants émettent des <em>intents</em> et d’autres demandent au système à être sollicités
lors de l’envoi de ces <em>intents</em>. Cela permet un système à couplage faible et
permet à une application de s’insérer facilement dans l’écosystème des applications.</p>
<p>Un <em>intent</em> peut contenir les informations suivantes :</p>
<dl class="simple">
<dt>Nom du composant</dt><dd><p>Un <em>intent</em> peut désigner une application spécifiquement avec son nom de package
ou même un composant précis de l’application (comme une activité). Dans ce
cas, on dit que l’intent est <strong>explicite</strong>. Mais il est également possible
d’utiliser un intent <strong>implicite</strong>, c’est-à-dire qu’il ne fournit pas
de nom de composant. Dans ce cas, le système est responsable de trouver
l’application la plus appropriée pour répondre. Par exemple, on peut émettre
un intent pour envoyer un mail. Le système doit ouvrir l’application la plus
adaptée pour cela. Si plusieurs applications sont éligibles, le système
demande à l’utilisateur celle qu’il préfère utiliser.</p>
</dd>
<dt>Action</dt><dd><p>L’action est un identifiant sous la forme d’une chaîne de caractères. Il
existe des identifiants d’action prédéfinis par le système mais vous pouvez
très bien créer les vôtres si nécessaire.</p>
</dd>
<dt>Data</dt><dd><p>La data se présente sous la forme d’une URI ou d’un type <a class="reference external" href="https://fr.wikipedia.org/wiki/Type_de_m%C3%A9dias">MIME</a> pour désigner
l’objet de l’intent.</p>
</dd>
<dt>Catégorie</dt><dd><p>La catégorie est un identifiant sous la forme d’une chaîne  de caractères.
Elle permet de préciser l’action.</p>
</dd>
<dt>Extras</dt><dd><p>Les extras sont en fait des paramètres sous la forme clé/valeur. Par exemple
pour un intent destiné à envoyer un mail, on peut ajouter une extrait précisant
le sujet du mail.</p>
</dd>
<dt>Flags</dt><dd><p>Les <em>flags</em> sont des méta-informations que l’on peut ajouter à l’intent pour
des utilisations avancées.</p>
</dd>
</dl>
<div class="section" id="associer-une-activite-a-un-intent">
<h3>Associer une activité à un intent<a class="headerlink" href="#associer-une-activite-a-un-intent" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lorsque l’on déclare une activité dans le fichier <code class="file docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code>,
il est possible de lui associer un filtre d’intent (<em>intent-filter</em>) pour
indiquer au système dans quels cas cette activité doit être déclenchée. Si
vous consultez le fichier <code class="file docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> pour un projet créé
par Android Studio, vous verrez un fichier ressemblant à celui-ci :</p>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span>
    <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">package=</span><span class="s">&quot;dev.gayerie.premiereapplication&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
        <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
        <span class="na">android:roundIcon=</span><span class="s">&quot;@mipmap/ic_launcher_round&quot;</span>
        <span class="na">android:supportsRtl=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;.MainActivity&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</td></tr></table></div>
<p>À partir de la ligne 13, ce ficher manifeste déclare une activité en l’associant
au filtre d’intent avec l’action <code class="docutils literal notranslate"><span class="pre">android.intent.action.MAIN</span></code> de la catégorie
<code class="docutils literal notranslate"><span class="pre">android.intent.category.LAUNCHER</span></code>. Il s’agit de l’intent qui est envoyé à
l’application lorsque l’utilisateur lance l’application. Donc ce filtre permet
au système de savoir quelle activité créer au lancement de l’application.</p>
<p>Une (et une seule) activité devrait être associée à ce type d’intent pour permettre
à l’application de pouvoir être exécutée directement par l’utilisateur en cliquant
sur son icône. Mais il est également possible d’envisager que la même activité
(ou une autre) puisse être lancée à partir d’une autre action.</p>
<p>Un exemple assez courant est la possibilité de lancer une activité lorsque
le système reçoit la directive d’afficher le contenu d’une URI. Prenons le
cas du QR Code suivant :</p>
<div class="figure align-default" id="id7">
<img alt="../_images/qrcode.png" src="../_images/qrcode.png" />
<p class="caption"><span class="caption-text">Un QR Code pour l’URI demo://test</span><a class="headerlink" href="#id7" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Le QR Code ci-dessus est la représentation graphique de l’URI <code class="docutils literal notranslate"><span class="pre">demo://test</span></code>.
Si vous utilisez une application de lecture de QR Code sur un système Android,
cette dernière va décoder le QR Code et va demander au système d’afficher l’URI
décodée <code class="docutils literal notranslate"><span class="pre">demo://test</span></code>. Pour cela, elle va émettre un <em>intent</em>. Le système va
alors chercher une application capable de prendre en charge le schéma
<code class="docutils literal notranslate"><span class="pre">demo</span></code>. Les schémas les plus courants comme <code class="docutils literal notranslate"><span class="pre">http</span></code>, <code class="docutils literal notranslate"><span class="pre">https</span></code> ou <code class="docutils literal notranslate"><span class="pre">tel</span></code>
sont déjà pris en charge par des applications installées par défaut. Mais nous
pouvons fournir une activité prenant spécifiquement en charge une URI de la forme
<code class="docutils literal notranslate"><span class="pre">demo://</span></code> grâce à l’utilisation d’un filtre d’intent.</p>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span>
    <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">package=</span><span class="s">&quot;dev.gayerie.premiereapplication&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
        <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
        <span class="na">android:roundIcon=</span><span class="s">&quot;@mipmap/ic_launcher_round&quot;</span>
        <span class="na">android:supportsRtl=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;.MainActivity&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
<span class="hll">        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;.DemoActivity&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;intent-filter&gt;</span>
</span><span class="hll">                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&quot;demo&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/activity&gt;</span>
</span>    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</td></tr></table></div>
<p>L’activité déclarée dans le manifeste à partir de la ligne 19 est associée
à un filtre d’intent pour l’action <code class="docutils literal notranslate"><span class="pre">android.intent.action.VIEW</span></code> et dont
les données correspondent au schéma <code class="docutils literal notranslate"><span class="pre">demo</span></code> (ligne 24). Dit autrement, si
on demande au système d’afficher une URI commençant par <code class="docutils literal notranslate"><span class="pre">demo://</span></code>, il
démarrera notre application pour lancer l’activité <code class="docutils literal notranslate"><span class="pre">DemoActivity</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">L’activité DemoActivity</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.premiereapplication</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>

        <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="n">Uri</span> <span class="n">intentData</span> <span class="o">=</span> <span class="n">getIntent</span><span class="p">().</span><span class="na">getData</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Vous avez ouvert l&#39;activité à partir de l&#39;adresse %s&quot;</span><span class="p">,</span> <span class="n">intentData</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
        <span class="n">textView</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

        <span class="n">setContentView</span><span class="p">(</span><span class="n">textView</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Notez à la ligne 16 que l’activité peut accéder à l’intent qui a déclenché sa
création grâce à la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#getIntent()">getIntent</a>. On peut ainsi facilement récupérer
l’URI grâce à la propriété <code class="docutils literal notranslate"><span class="pre">data</span></code>. Dans notre exemple, on se contente
de l’afficher à l’écran.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>De la même manière, vous pouvez associer une activité à l’hôte ou même
au chemin d’une ressource dans l’URI. Cela permet, par exemple, de déclencher
le lancement de votre application quand l’utilisateur clique sur un lien
dans une page Web :</p>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;.OtherDemoActivity&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&quot;https&quot;</span>
              <span class="na">android:host=</span><span class="s">&quot;api.mondomaine.com&quot;</span>
              <span class="na">android:path=</span><span class="s">&quot;/launch&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</pre></div>
</td></tr></table></div>
<p>L’activité déclarée ci-dessus est ouverte quand le système reçoit un message
lui demandant d’ouvrir l’URI <code class="docutils literal notranslate"><span class="pre">https://api.mondomaine.com/launch</span></code>. Vous
pouvez vous contenter de placer un lien sur une page Web de votre site.</p>
</div>
</div>
<div class="section" id="emettre-un-intent-implicite">
<h3>Émettre un intent implicite<a class="headerlink" href="#emettre-un-intent-implicite" title="Lien permanent vers ce titre">¶</a></h3>
<p>Nous pouvons très facilement demander le lancement d’une activité en utilisant
un <em>intent</em>. Android distingue les intents <strong>implicites</strong> et les intents
<strong>explicites</strong>. Un intent implicite doit être résolu par le système, c’est-à-dire
qu’il doit sélectionner l’application la plus appropriée pour réaliser l’action
(si plusieurs applications sont éligibles, alors le système affiche
une boite de dialogue à l’utilisateur pour qu’il choisisse l’application qu’il
préfère lancer). <em>A contrario</em>, un intent <em>explicite</em> permet de désigner
explicitement l’application, voire l’activité, que l’on souhaite exécuter. Un
intent implicite permet très facilement à une application d’interagir avec
les autres applications. En effet, le programme se contente de déclarer le type
d’action qu’il souhaite voir réaliser et le système doit choisir l’application
appropriée. Un intent explicite est généralement utilisé pour ouvrir des activités
au sein de la même application et gérer les enchaînements entre les activités
(comme nous le verrons au chapitre suivant).</p>
<p>L’émission d’un intent implicite se fait en trois étapes :</p>
<ol class="arabic simple">
<li><p>On crée l’intent pour déclarer l’action et les données</p></li>
<li><p>On vérifie qu’il existe au moins une application pour prendre en charge ce
type d’intent</p></li>
<li><p>On demande au système de lancer l’activité capable de prendre en compte notre
intent.</p></li>
</ol>
<p>Ci-dessous un exemple d’émission d’un intent implicite pour déclencher un appel
téléphonique :</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Uri</span> <span class="n">numero</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;tel:0601020304&quot;</span><span class="p">);</span>
<span class="n">Intent</span> <span class="n">intentAppel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_DIAL</span><span class="p">,</span> <span class="n">numero</span><span class="p">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="n">infos</span> <span class="o">=</span> <span class="n">getPackageManager</span><span class="p">().</span><span class="na">queryIntentActivities</span><span class="p">(</span><span class="n">intentAppel</span><span class="p">,</span>
                                                                    <span class="n">PackageManager</span><span class="p">.</span><span class="na">MATCH_DEFAULT_ONLY</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">infos</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">startActivity</span><span class="p">(</span><span class="n">intentAppel</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&quot;Impossible d&#39;appeler&quot;</span><span class="p">,</span>  <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_LONG</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Aux lignes 1 et 2, on crée une URI représentant le numéro de téléphone à appeler
avec le schéma <code class="docutils literal notranslate"><span class="pre">tel:</span></code> et on crée l’intent pour une action <code class="docutils literal notranslate"><span class="pre">DIAL</span></code>. La ligne
4 permet d’effectuer une requête pour savoir s’il existe une ou plusieurs
activités capables de prendre en charge l’intent. Pour notre code, il suffit
de nous assurer que cette liste n’est pas vide pour être sûr que l’intent
sera pris en charge. Puis, ligne 7, on émet l’intent grâce à la méthode
<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#startActivity(android.content.Intent)">startActivity</a> et le système se charge des opérations nécessaires.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="activity_stack.html" class="btn btn-neutral float-right" title="Gestion des activités d’une application" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ui_layout.html" class="btn btn-neutral float-left" title="Conception d’interfaces graphiques" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright David Gayerie - david@gayerie.dev - CC-BY-SA

    </p>
  </div>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99071053-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>