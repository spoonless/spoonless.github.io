

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  <meta content="David Gayerie" name="author" />
<meta content="Développement d'application Android" name="description" />
<meta content="android, android studio, java, programmation objet" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Gestion des messages broadcast &mdash; Documentation Développement Android </title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://gayerie.dev/docs/java-android/android/broadcast.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Accès Web" href="acces_web.html" />
    <link rel="prev" title="Gestion des activités d’une application" href="activity_stack.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Développement Android
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Développement d'applications pour Android</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="premiere_app.html">Une première application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#creation-d-une-application-simple">Création d’une application simple</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#organisation-du-projet">Organisation du projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#lancement-de-l-application">Lancement de l’application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#l-emulateur-android">L’émulateur Android</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#notion-d-activite">Notion d’activité</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#notion-de-ressources">Notion de ressources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#acceder-a-un-identifiant-de-ressource-depuis-le-code-java">Accéder à un identifiant de ressource depuis le code Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#acceder-a-une-ressource-depuis-une-autre-ressource">Accéder à une ressource depuis une autre ressource</a></li>
<li class="toctree-l3"><a class="reference internal" href="premiere_app.html#identifier-une-ressource-dans-un-layout">Identifier une ressource dans un layout</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#exercices">Exercices</a></li>
<li class="toctree-l2"><a class="reference internal" href="premiere_app.html#le-fichier-androidmanifest-xml">Le fichier AndroidManifest.xml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ui_layout.html">Conception d’interfaces graphiques</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#view-et-layout">View et Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#layout-xml">Layout XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#layout-lineaire-et-positionnement">Layout linéaire et positionnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#techniques-avancees-de-positionnement-dans-un-layout">Techniques avancées de positionnement dans un layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#layout-margin-et-padding">layout_margin et padding</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#layout-gravity-et-gravity">layout_gravity et gravity</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#layout-weight">layout_weight</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#layout-par-contraintes">Layout par contraintes</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#ajouter-une-image">Ajouter une image</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#exemple-de-formulaire">Exemple de formulaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#la-barre-d-action">La barre d’action</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#creer-un-menu-dans-la-barre-d-action">Créer un menu dans la barre d’action</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#associer-un-menu-a-une-activite">Associer un menu à une activité</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#implementer-les-actions-associees-aux-items-de-menu">Implémenter les actions associées aux items de menu</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#les-boites-de-dialogue">Les boites de dialogue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#boite-de-dialogue-avec-boutons">Boite de dialogue avec boutons</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#boite-de-dialogue-avec-choix">Boite de dialogue avec choix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui_layout.html#message-a-l-utilisateur">Message à l’utilisateur</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#toast">Toast</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui_layout.html#snackbar">Snackbar</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="activity.html">Les activités</a><ul>
<li class="toctree-l2"><a class="reference internal" href="activity.html#le-cycle-de-vie">Le cycle de vie</a><ul>
<li class="toctree-l3"><a class="reference internal" href="activity.html#terminer-une-activite">Terminer une activité</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="activity.html#gestion-de-l-etat-d-une-activite">Gestion de l’état d’une activité</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity.html#notion-d-intent">Notion d’intent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="activity.html#associer-une-activite-a-un-intent">Associer une activité à un intent</a></li>
<li class="toctree-l3"><a class="reference internal" href="activity.html#emettre-un-intent-implicite">Émettre un intent implicite</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="activity_stack.html">Gestion des activités d’une application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#l-application-de-demo">L’application de démo</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#structure-de-l-application">Structure de l’application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="activity_stack.html#l-activite-principale-et-recyclerview">L’activité principale et RecyclerView</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#detail-d-une-occupation-et-pile-des-activites">Détail d’une occupation et pile des activités</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#ouverture-d-une-activite-intent-explicite">Ouverture d’une activité (intent explicite)</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#strategie-de-gestion-de-la-pile-des-activites">Stratégie de gestion de la pile des activités</a></li>
<li class="toctree-l2"><a class="reference internal" href="activity_stack.html#terminer-une-activite">Terminer une activité</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Gestion des messages broadcast</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#le-broadcastreceiver">Le BroadcastReceiver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#suivre-le-branchement-sur-secteur">Suivre le branchement sur secteur</a></li>
<li class="toctree-l3"><a class="reference internal" href="#suivre-l-etat-de-la-connexion-wifi">Suivre l’état de la connexion Wifi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#recevoir-des-broadcasts-depuis-une-activite">Recevoir des broadcasts depuis une activité</a></li>
<li class="toctree-l2"><a class="reference internal" href="#emettre-un-message-broadcast">Émettre un message broadcast</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="acces_web.html">Accès Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="acces_web.html#permission-pour-l-acces-internet">Permission pour l’accès Internet</a></li>
<li class="toctree-l2"><a class="reference internal" href="acces_web.html#utilisation-de-la-classe-url">Utilisation de la classe URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="acces_web.html#utilisation-de-la-bibliotheque-volley">Utilisation de la bibliothèque Volley</a><ul>
<li class="toctree-l3"><a class="reference internal" href="acces_web.html#ajout-de-la-dependance">Ajout de la dépendance</a></li>
<li class="toctree-l3"><a class="reference internal" href="acces_web.html#emission-d-une-requete">Émission d’une requête</a></li>
<li class="toctree-l3"><a class="reference internal" href="acces_web.html#emission-d-une-requete-pour-une-reponse-json">Émission d’une requête pour une réponse JSON</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="service.html">Les services Android</a><ul>
<li class="toctree-l2"><a class="reference internal" href="service.html#service-en-tache-de-fond">Service en tâche de fond</a><ul>
<li class="toctree-l3"><a class="reference internal" href="service.html#implementation-et-declaration-du-service">Implémentation et déclaration du service</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#le-cycle-de-vie">Le cycle de vie</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#execution-en-tache-de-fond">Exécution en tâche de fond</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#interaction-avec-l-utilisateur">Interaction avec l’utilisateur</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#lancement-du-service">Lancement du service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="service.html#service-lie">Service lié</a><ul>
<li class="toctree-l3"><a class="reference internal" href="service.html#declaration-du-service">Déclaration du service</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#id1">Le cycle de vie</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#implementation-de-la-methode-onbind">Implémentation de la méthode onBind</a></li>
<li class="toctree-l3"><a class="reference internal" href="service.html#lier-le-service-a-une-activite">Lier le service à une activité</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Développement Android</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Gestion des messages broadcast</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="acces_web.html" class="btn btn-neutral float-right" title="Accès Web" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="activity_stack.html" class="btn btn-neutral float-left" title="Gestion des activités d’une application" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gestion-des-messages-broadcast">
<h1>Gestion des messages broadcast<a class="headerlink" href="#gestion-des-messages-broadcast" title="Lien permanent vers ce titre">¶</a></h1>
<div class="exercice admonition">
<p class="admonition-title">Le projet d’exemple pour ce chapitre</p>
<p>Vous pouvez télécharger le projet contenant les exemples de ce chapitre :
<a class="reference download internal" download="" href="../_downloads/30e98d5ae390fe06de467ce9c37fb392/android-demo-app.zip"><code class="xref download docutils literal notranslate"><span class="pre">android-demo-app.zip</span></code></a></p>
</div>
<p>Nous avons vu que les activités sont lancées à partir de l’émission d’un <em>intent</em>.
Un système Android généralise ce principe avec les messages de type
<em>broadcast</em>. En informatique, la notion de <em>broadcast</em> désigne la télédiffusion
d’une information sans connaissance <em>a priori</em> ni du nombre ni du type de
composants qui peuvent traiter cette information.</p>
<p>Un système Android fournit un modèle de publication/souscription pour l’émission
et la réception des messages de type <em>broadcast</em>. Un composant peut émettre
un message tandis qu’un autre peut s’inscrire pour recevoir ce type de message.
Cela permet de créer une système de communication à couplage faible : les émetteurs
n’ont pas besoin de connaître les récepteurs (et réciproquement).</p>
<p>Le système Android lui-même émet de nombreux messages en <em>broadcast</em>. Par exemple,
si votre application à besoin de se connecter à Internet, elle peut adapter son
comportement lorsque le système perd la connexion réseau (mais également
lorsque la connexion réseau est rétablie). Pour cela, vos activités peuvent
souscrire à la réception de <em>broadcast</em> de type <a class="reference external" href="https://developer.android.com/reference/android/net/wifi/WifiManager#NETWORK_STATE_CHANGED_ACTION">NETWORK_STATE_CHANGED_ACTION</a> pour
être prévenue de l’évolution de la connexion Wifi. On trouve de nombreuses
utilisations pour la prise en charge de <em>broadcast</em> système : connaître les
changements d’état du réseau, être prévenu lorsque la batterie est déchargée, savoir
que le téléphone est mis en veille ou sort de veille, être prévenu du démarrage
du système ou de son arrêt…</p>
<div class="section" id="le-broadcastreceiver">
<h2>Le BroadcastReceiver<a class="headerlink" href="#le-broadcastreceiver" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> est une classe abstraite qui permet de créer un composant
en charge de recevoir des <em>broadcasts</em>. Une classe héritant de <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a>
doit fournir une implémentation de la méthode abstraite <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver#onReceive(android.content.Context,%20android.content.Intent)">onReceive</a> pour traiter
le message.</p>
<p>On peut ensuite déclarer le <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> dans le manifeste de l’application
pour l’associer à un filtre d’intent, c’est-à-dire pour définir les messages
auxquels le récepteur s’inscrit.</p>
<div class="section" id="suivre-le-branchement-sur-secteur">
<h3>Suivre le branchement sur secteur<a class="headerlink" href="#suivre-le-branchement-sur-secteur" title="Lien permanent vers ce titre">¶</a></h3>
<p>Prenons l’exemple d’une application qui souhaite être prévenue lorsque le téléphone
est branché sur secteur ou bien lorsqu’il passe en mode batterie. Ces changements
d’états correspondent à deux <em>broadcasts</em> différents :</p>
<ul class="simple">
<li><p>Pour le branchement sur secteur, l’action est <code class="docutils literal notranslate"><span class="pre">android.intent.action.ACTION_POWER_CONNECTED</span></code>
qui est donnée par la constante <a class="reference external" href="https://developer.android.com/reference/android/content/Intent#ACTION_POWER_CONNECTED">ACTION_POWER_CONNECTED</a></p></li>
<li><p>Pour le passage sur batterie, l’action est <code class="docutils literal notranslate"><span class="pre">android.intent.action.ACTION_POWER_DISCONNECTED</span></code>
qui est donnée par la constante <a class="reference external" href="https://developer.android.com/reference/android/content/Intent#ACTION_POWER_DISCONNECTED">ACTION_POWER_DISCONNECTED</a></p></li>
</ul>
<p>On peut créer un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> pour traiter ces deux actions :</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Un exemple de BroadcastReceiver</span><a class="headerlink" href="#id1" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.monappli</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">android.content.BroadcastReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Toast</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PowerReceiver</span> <span class="kd">extends</span> <span class="n">BroadcastReceiver</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="na">getAction</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_POWER_CONNECTED</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&quot;Connecté sur secteur&quot;</span><span class="p">,</span> <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_LONG</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="na">getAction</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_POWER_DISCONNECTED</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&quot;En mode batterie&quot;</span><span class="p">,</span> <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_LONG</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans cet exemple simple, l’implementation de <code class="docutils literal notranslate"><span class="pre">PowerReceiver</span></code> se contente de
vérifier l’action correspondant à l’intent reçu en paramètre de la méthode
<a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver#onReceive(android.content.Context,%20android.content.Intent)">onReceive</a> pour afficher une information à l’utilisateur.</p>
<p>Enfin, pour que le <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> reçoive les messages, il faut le déclarer
dans le manifeste de l’application dans la balise <code class="docutils literal notranslate"><span class="pre">&lt;application&gt;</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Déclaration du BroadcastReceiver dans AndroidManifest.xml</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">&quot;dev.gayerie.monappli.PowerReceiver&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;intent-filter&gt;</span>
    <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.ACTION_POWER_CONNECTED&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.ACTION_POWER_DISCONNECTED&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/receiver&gt;</span>
</pre></div>
</div>
</div>
<p>En déclarant le <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> dans le manifeste de l’application, il n’est
pas nécessaire que l’application soit démarrée pour que le message soit reçu.
Dans ce cas, le système démarre l’application sans aucune activité et se contente
d’instancier un objet de la classe <code class="docutils literal notranslate"><span class="pre">PowerReceiver</span></code> pour appeler sa méthode
<a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver#onReceive(android.content.Context,%20android.content.Intent)">onReceive</a>. Le premier paramètre de cette méthode correspond au contexte d’exécution
du <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a>. Il est possible de s’en servir pour appeler la méthode
<a class="reference external" href="https://developer.android.com/reference/android/app/Activity#startActivity(android.content.Intent)">startActivity</a>. Un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> peut donc effectuer des actions complexes
en réponse à un message.</p>
</div>
<div class="section" id="suivre-l-etat-de-la-connexion-wifi">
<h3>Suivre l’état de la connexion Wifi<a class="headerlink" href="#suivre-l-etat-de-la-connexion-wifi" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour une application dépendante de la connexion Internet, il peut être
intéressant de réagir au changement d’état de cette connexion. On peut déclarer
une <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> pour l’action <code class="docutils literal notranslate"><span class="pre">android.net.wifi.STATE_CHANGE</span></code> qui est
également fournie par la constante <a class="reference external" href="https://developer.android.com/reference/android/net/wifi/WifiManager#NETWORK_STATE_CHANGED_ACTION">NETWORK_STATE_CHANGED_ACTION</a>.</p>
<p>Ci-dessous un exemple d’implémentation d’un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> :</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Un BroadcastReceiver pour suivre les changement d’états de la connexion Wifi</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.monappli</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">android.content.BroadcastReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.net.NetworkInfo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.net.wifi.WifiManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Toast</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WifiReceiver</span> <span class="kd">extends</span> <span class="n">BroadcastReceiver</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="na">getAction</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">WifiManager</span><span class="p">.</span><span class="na">NETWORK_STATE_CHANGED_ACTION</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">NetworkInfo</span> <span class="n">networkInfo</span> <span class="o">=</span> <span class="n">intent</span><span class="p">.</span><span class="na">getParcelableExtra</span><span class="p">(</span><span class="n">WifiManager</span><span class="p">.</span><span class="na">EXTRA_NETWORK_INFO</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">networkInfo</span><span class="p">.</span><span class="na">isAvailable</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&quot;Connecté au réseau&quot;</span><span class="p">,</span> <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_LONG</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&quot;Déconnecté du réseau&quot;</span><span class="p">,</span> <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_LONG</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>À la ligne 15, on récupère un objet de type <a class="reference external" href="https://developer.android.com/reference/android/net/NetworkInfo">NetworkInfo</a> en appelant la méthode
<a class="reference external" href="https://developer.android.com/reference/android/content/Intent#getParcelableExtra(java.lang.String)">getParcelableExtra</a>. En effet, un intent peut contenir comme extra des informations
complexes (pas uniquement des primitives ou des chaînes de caractères). Pour
Android, on parle d’objets <em>parcelables</em>. Il s’agit d’objets qui peuvent être
sérialisés de manière à pouvoir être transmis d’une application à l’autre.</p>
</div>
<p>On déclare le <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> dans le manifeste de l’application dans la balise
<code class="docutils literal notranslate"><span class="pre">&lt;application&gt;</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Déclaration du BroadcastReceiver dans AndroidManifest.xml</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">&quot;dev.gayerie.monappli.WifiReceiver&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;intent-filter&gt;</span>
    <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.net.wifi.STATE_CHANGE&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/receiver&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recevoir-des-broadcasts-depuis-une-activite">
<h2>Recevoir des broadcasts depuis une activité<a class="headerlink" href="#recevoir-des-broadcasts-depuis-une-activite" title="Lien permanent vers ce titre">¶</a></h2>
<p>La déclaration d’un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> dans le manifeste de l’application implique
que, si nécessaire, l’application sera démarrée (sans activité) et un
<a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> sera instancié pour traiter le message. Ce n’est pas toujours
ce que l’on désire. Imaginons qu’une activité a besoin d’adapter son comportement
lorsque le système est ou non en mode hors-connexion (le mode avion). Elle peut
consulter cet état mais elle a aussi besoin de savoir si cet état change. Dans
ce cas, l’activité a besoin d’un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> mais uniquement quand elle
est affichée. On utilise la méthode <a class="reference external" href="https://developer.android.com/reference/android/content/Context#registerReceiver(android.content.BroadcastReceiver,%20android.content.IntentFilter)">registerReceiver</a> pour associer une activité
à un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a>. Attention, il ne faut surtout pas oublier d’appeler
la méthode <a class="reference external" href="https://developer.android.com/reference/android/content/Context#unregisterReceiver(android.content.BroadcastReceiver)">unregisterReceiver</a> quand l’activité n’a plus besoin du
<a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a>.</p>
<p>Pour illustrer notre exemple, voici le code source de l’activité.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Un exemple d’activité utilisant un BroadcastReceiver</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.monappli</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">android.content.BroadcastReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.IntentFilter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.provider.Settings</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AirplaneActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="n">TextView</span> <span class="n">airplaneModeView</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">AirplaneModeReceiver</span> <span class="n">airplaneModeReceiver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AirplaneModeReceiver</span><span class="p">();</span>

  <span class="kd">private</span> <span class="kd">class</span> <span class="nc">AirplaneModeReceiver</span> <span class="kd">extends</span> <span class="n">BroadcastReceiver</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">setAirplaneModeMessage</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="na">getApplication</span><span class="p">().</span><span class="na">getApplicationContext</span><span class="p">();</span>
    <span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">activity_airplane</span><span class="p">);</span>
    <span class="n">airplaneModeView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">airplaneMode</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">onResume</span><span class="p">();</span>
    <span class="n">IntentFilter</span> <span class="n">intentFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="p">(</span><span class="n">Intent</span><span class="p">.</span><span class="na">ACTION_AIRPLANE_MODE_CHANGED</span><span class="p">);</span>
    <span class="n">registerReceiver</span><span class="p">(</span><span class="n">airplaneModeReceiver</span><span class="p">,</span> <span class="n">intentFilter</span><span class="p">);</span>
    <span class="n">setAirplaneModeMessage</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">onPause</span><span class="p">();</span>
    <span class="n">unregisterReceiver</span><span class="p">(</span><span class="n">airplaneModeReceiver</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setAirplaneModeMessage</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">airplaneModeView</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">airplaneModeView</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">isAirplaneMode</span><span class="p">()</span> <span class="o">?</span> <span class="s">&quot;Mode avion&quot;</span><span class="p">:</span> <span class="s">&quot;Pas mode avion&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isAirplaneMode</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Settings</span><span class="p">.</span><span class="na">System</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getContentResolver</span><span class="p">(),</span>
                                  <span class="n">Settings</span><span class="p">.</span><span class="na">System</span><span class="p">.</span><span class="na">AIRPLANE_MODE_ON</span><span class="p">,</span>
                                  <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Dans la classe <code class="docutils literal notranslate"><span class="pre">AirplaneActivity</span></code>, on déclare une classe interne
<code class="docutils literal notranslate"><span class="pre">AirplaneModeReceiver</span></code> qui est un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> (lignes 18 à 23). On
dispose de la méthode <code class="docutils literal notranslate"><span class="pre">setAirplaneModeMessage</span></code> (ligne 47 à 51) qui permet de
mettre à jour l’interface graphique avec un message selon l’état du mode avion.
Dans l’activité, on redéfinit la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a> pour mettre à jour l’interface
graphique mais également pour enregistrer le <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> (lignes 36-37)
en l’associant à un <a class="reference external" href="https://developer.android.com/reference/android/content/IntentFilter">IntentFilter</a>. On redéfinit également la méthode <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a>
pour être sûr de désenregistrer le <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> (ligne 44) lorsqu’il n’est
plus utile à l’activité.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Les méthodes <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onResume()">onResume</a> et <a class="reference external" href="https://developer.android.com/reference/android/app/Activity#onPause()">onPause</a> sont très utiles dans une activité pour
activer/désactiver des ressources systèmes comme un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a>.</p>
</div>
</div>
<div class="section" id="emettre-un-message-broadcast">
<h2>Émettre un message broadcast<a class="headerlink" href="#emettre-un-message-broadcast" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une application peut elle-même émettre un message <em>broadcast</em> en utilisant
la méthode de contexte <a class="reference external" href="https://developer.android.com/reference/android/content/Context#sendBroadcast(android.content.Intent)">sendBroadcast</a>. Le message est représenté sous la forme
d’un <a class="reference external" href="https://developer.android.com/reference/android/content/Intent">Intent</a>. Il est donc possible de concevoir une application dans laquelle
les différents composants peuvent s’échanger des informations sur le modèle
de la publication/souscription.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Emission d’un message depuis une activité</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="p">();</span>
<span class="n">intent</span><span class="p">.</span><span class="na">setAction</span><span class="p">(</span><span class="s">&quot;dev.gayerie.monappli.MON_MESSAGE&quot;</span><span class="p">);</span>
<span class="c1">// on ajoute éventuellement des extras</span>
<span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;Ceci est une info accompagnant le message&quot;</span><span class="p">);</span>
<span class="c1">// émission du message</span>
<span class="k">this</span><span class="p">.</span><span class="na">sendBroadcast</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Lorsque les messages émis sont à destination uniquement de composants de notre
application, il est possible d’utiliser le <a class="reference external" href="https://developer.android.com/reference/androidx/localbroadcastmanager/content/LocalBroadcastManager">LocalBroadcastManager</a> qui permet de
limiter la diffusion de messages à l’application elle-même.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Emission d’un message local à l’application depuis une activité</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="p">();</span>
<span class="n">intent</span><span class="p">.</span><span class="na">setAction</span><span class="p">(</span><span class="s">&quot;dev.gayerie.monappli.MON_MESSAGE&quot;</span><span class="p">);</span>
<span class="c1">// on ajoute éventuellement des extras</span>
<span class="n">intent</span><span class="p">.</span><span class="na">putExtra</span><span class="p">(</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&quot;Ceci est une info accompagnant le message&quot;</span><span class="p">);</span>
<span class="c1">// émission locale à l&#39;application</span>
<span class="n">LocalBroadcastManager</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="na">sendBroadcast</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dans le manifeste de l’application, pour limiter un <a class="reference external" href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a> à la
réception de messages locaux, on utilise l’attribut <code class="docutils literal notranslate"><span class="pre">android:exported</span></code> avec
la valeur <code class="docutils literal notranslate"><span class="pre">false</span></code> dans la déclaration.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Déclaration d’un BroadcastReceiver local</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">&quot;dev.gayerie.monappli.MyLocalReceiver&quot;</span>
<span class="hll">          <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
</span>  <span class="nt">&lt;intent-filter&gt;</span>
    <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;dev.gayerie.monappli.MON_MESSAGE&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/receiver&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="acces_web.html" class="btn btn-neutral float-right" title="Accès Web" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="activity_stack.html" class="btn btn-neutral float-left" title="Gestion des activités d’une application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright David Gayerie - david@gayerie.dev - CC-BY-SA

    </p>
  </div>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99071053-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>