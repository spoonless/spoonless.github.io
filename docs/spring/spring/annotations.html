

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  <meta content="David Gayerie" name="author" />
<meta content="Spring Framework - Les annotations" name="description" />
<meta content="Java, Spring Framework, framework, Jakarta EE, Java EE, IoC, injection de dépendances" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  

  <title>Déclaration par annotations &mdash; Spring Framework / Spring Boot</title>



  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://gayerie.dev/docs/spring/spring/annotations.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Configuration d’une application" href="application_context_conf.html" />
    <link rel="prev" title="Le contexte d’application" href="application_context.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Spring Framework / Spring Boot
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Spring Framework et Spring Boot</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#le-spring-framework-vs-j2ee">Le Spring Framework vs. J2EE</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-modules-spring-framework">Les modules Spring Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-projets-spring">Les projets Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="principe_ioc.html">L’inversion de contrôle</a><ul>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#l-injection-de-dependance">L’injection de dépendance</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#id2">L’inversion de contrôle</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#notion-de-conteneur-ioc">Notion de conteneur IoC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_context.html">Le contexte d’application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#mise-en-place-du-projet">Mise en place du projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#une-premiere-application-avec-spring">Une première application avec Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#notion-de-portee-scope">Notion de portée (scope)</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#l-injection-de-bean">L’injection de bean</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#les-methodes-d-initialisation-et-de-destruction">Les méthodes d’initialisation et de destruction</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Déclaration par annotations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#l-annotation-autowired">L’annotation &#64;Autowired</a></li>
<li class="toctree-l2"><a class="reference internal" href="#desambiguisation-avec-primary-et-qualifier">Désambiguïsation avec &#64;Primary et &#64;Qualifier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#l-annotation-primary">L’annotation &#64;Primary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l-annotation-qualifier">L’annotation &#64;Qualifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#l-annotation-value">L’annotation &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="#les-annotations-jsr-250">Les annotations JSR-250</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detection-automatique-des-composants-component-scan">Détection automatique des composants (<em>component scan</em>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notion-de-composant">Notion de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stereotype-de-composant">Stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#le-stereotype-configuration">Le stéréotype &#64;Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creation-de-stereotype-de-composant">Création de stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notions-avancees-pour-la-gestion-des-dependances">Notions avancées pour la gestion des dépendances</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#l-annotation-order">L’annotation &#64;Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="#l-annotation-dependson">L’annotation &#64;DependsOn</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#support-des-annotations-standard-jsr-330">Support des annotations standard JSR-330</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_context_conf.html">Configuration d’une application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#lancer-une-application-spring-boot">Lancer une application Spring Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#spring-boot-et-le-fichier-application-properties">Spring Boot et le fichier application.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#injection-des-proprietes-avec-value">Injection des propriétés avec &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#ajout-de-fichiers-de-proprietes-avec-propertysource">Ajout de fichiers de propriétés avec &#64;PropertySource</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#les-variables-d-environnement">Les variables d’environnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#la-classe-environment">La classe Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#beans-de-proprietes-avec-configurationproperties-spring-boot">Beans de propriétés avec &#64;ConfigurationProperties (Spring Boot)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="application_context_conf.html#introduction-a-bean-validation">Introduction à Bean Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#pour-en-savoir-plus">Pour en savoir plus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spel.html">Le langage d’expression SpEL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spel.html#un-exemple-d-utilisation-de-spel">Un exemple d’utilisation de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#principe-de-spel">Principe de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-ternaire">L’opérateur ternaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-elvis">L’opérateur Elvis</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-de-surete">L’opérateur de sûreté</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#la-projection">La projection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aop.html">Spring AOP : programmation orientée aspect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aop.html#principe-de-la-programmation-orientee-aspect">Principe de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#terminologie-de-la-programmation-orientee-aspect">Terminologie de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#integration-du-module-spring-aop">Intégration du module Spring AOP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aop.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="aop.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#exemple-de-programmation-orientee-aspect-avec-spring-aop">Exemple de programmation orientée aspect avec Spring AOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#la-programmation-orientee-aspect-pour-gerer-les-annotations">La programmation orientée Aspect pour gérer les annotations</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring Web MVC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_intro.html">Introduction à Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#le-modele-mvc">Le modèle MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#integration-de-spring-web-mvc">Intégration de Spring Web MVC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-avec-spring-boot">Intégration dans une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#l-encodage-des-parametres-de-requetes">L’encodage des paramètres de requêtes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc.html">Les applications Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-controleurs">Les contrôleurs</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-vues-jsp">Les vues JSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-vues-jsp">Utilisation des vues JSP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-vues-thymeleaf">Les vues Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id1">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id2">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-vues-thymeleaf">Utilisation des vues Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#le-modele">Le modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#une-application-multi-couches-n-tiers">Une application multi-couches (N-Tiers)</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#la-signature-des-methodes-de-controleur">La signature des méthodes de contrôleur</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#les-parametres">Les paramètres</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#la-valeur-de-retour">La valeur de retour</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#taglib-jsp-et-gestion-des-formulaires">Taglib JSP et gestion des formulaires</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#spring-s-jsp-taglib">Spring’s JSP taglib</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#form-taglib">Form taglib</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#gestion-des-formulaires-avec-thymeleaf">Gestion des formulaires avec Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#externalisation-des-messages">Externalisation des messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id4">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id5">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-messages-dans-une-jsp">Utilisation des messages dans une JSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-messages-avec-thymeleaf">Utilisation des messages avec Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#validation-des-parametres-d-une-requete">Validation des paramètres d’une requête</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#la-notion-de-binding-et-le-bindingresult">La notion de <em>binding</em> et le BindingResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#validation-dans-la-methode-du-controleur">Validation dans la méthode du contrôleur</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#creation-d-un-validateur">Création d’un validateur</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#validation-declarative-avec-bean-validation">Validation déclarative avec Bean Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#affichage-des-erreurs-de-validation">Affichage des erreurs de validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#post-redirect-get">POST-redirect-GET</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#la-gestion-des-exceptions">La gestion des exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#methodes-de-modele">Méthodes de modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#methodes-de-binder">Méthodes de binder</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#controlleradvice">ControllerAdvice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_apiweb.html">Les API Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#support-pour-les-formats-json-et-xml">Support pour les formats JSON et XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-annotation-restcontroller">L’annotation &#64;RestController</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#un-controleur-pour-une-api-web">Un contrôleur pour une API Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-negociation-de-contenu">La négociation de contenu</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-envoi-de-donnees">L’envoi de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-reponse">La réponse</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#restcontrolleradvice">RestControllerAdvice</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#les-annotations-jackson">Les annotations Jackson</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_apiweb.html#les-vues-json">Les vues JSON</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#implementation-d-un-client">Implémentation d’un client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="thymeleaf.html">Introduction à Thymeleaf</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#integration-de-thymeleaf">Intégration de Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-attributs-thymeleaf">Les attributs Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-evaluation">${…} : l’expression d’évaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-selection">*{…} : l’expression de sélection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-message">#{…} : l’expression de message</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-url">&#64;{…} : l’expression d’URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#prevention-de-l-injection">Prévention de l’injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-conditions-et-les-boucles">Les conditions et les boucles</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#operateur-de-coalescence-des-nuls">Opérateur de coalescence des nuls</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#le-formatage-des-donnees">Le formatage des données</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring et l'accès aux bases de données</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spring_dao.html">Spring DAO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#l-annotation-repository">L’annotation &#64;Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#integration-de-jpa">Intégration de JPA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#acces-aux-donnees-avec-jdbc">Accès aux données avec JDBC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id1">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id2">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#uniformite-de-la-hierarchie-des-exceptions">Uniformité de la hiérarchie des exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_data_jpa.html">Spring Data avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#notion-de-repository">Notion de repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#spring-data-jpa">Spring Data JPA</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#integration-des-repositories">Intégration des repositories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#injection-des-repositories">Injection des <em>repositories</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#ajout-de-methodes-dans-une-interface-de-repository">Ajout de méthodes dans une interface de repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#requetes-nommees-jpa">Requêtes nommées JPA</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#utilisation-de-query">Utilisation de &#64;Query</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#declaration-de-requetes-de-modification">Déclaration de requêtes de modification</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#implementation-des-methodes-de-repository">Implémentation des méthodes de <em>repository</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_tx.html">Spring Transaction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#la-transaction">La transaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#transaction-et-couche-de-service">Transaction et couche de service</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#l-annotation-transactional">L’annotation &#64;Transactional</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#gestion-declarative-du-rollback">Gestion déclarative du <em>rollback</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-avancee-pour-les-transactions">Configuration avancée pour les transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#la-propagation">La propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#l-isolation">L’isolation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-des-transactions-sans-spring-boot">Configuration des transactions sans Spring Boot</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spring Framework / Spring Boot</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="banner">D'autres formations sont sur <a href="https://gayerie.dev">https://gayerie.dev</a></div>

        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Déclaration par annotations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="application_context_conf.html" class="btn btn-neutral float-right" title="Configuration d’une application" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="application_context.html" class="btn btn-neutral float-left" title="Le contexte d’application" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="declaration-par-annotations">
<h1>Déclaration par annotations<a class="headerlink" href="#declaration-par-annotations" title="Lien permanent vers ce titre">¶</a></h1>
<p>L’utilisation des méthodes de fabrique avec l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a> permet d’ajouter
des objets dans un contexte d’application sans être intrusif dans le code des
classes concernées. Cela est surtout utile si nous voulons intégrer dans notre
contexte d’application des <em>beans</em> à partir de classes dont nous ne pouvons pas
ou ne voulons pas modifier le code source (par exemple des classes fournies par
une bibliothèque tierce).</p>
<p>Pour les classes que nous développons spécifiquement pour notre application, il
est plus simple d’utiliser des annotations supplémentaires. Nous allons voir
un premier jeu d’annotations :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">&#64;Autowired</a></p></li>
<li><p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Primary.html">&#64;Primary</a></p></li>
<li><p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Qualifier.html">&#64;Qualifier</a></p></li>
<li><p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Value.html">&#64;Value</a></p></li>
<li><p>les annotations JSR-250</p></li>
</ul>
<p>L’utilisation de ces annotations est plus intrusive puisqu’il faut les ajouter
dans le code source des classes de nos <em>beans</em>. Heureusement, le Spring Framework
autorise à mêler cette approche avec l’utilisation de méthodes de fabrique. Cela
laisse donc une liberté complète aux développeurs pour définir leur contexte d’application.</p>
<div class="section" id="l-annotation-autowired">
<h2>L’annotation &#64;Autowired<a class="headerlink" href="#l-annotation-autowired" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">&#64;Autowired</a> permet d’activer l’injection automatique de dépendance.
Cette annotation peut être placée sur un <strong>constructeur</strong>, une <strong>méthode setter</strong>
ou directement sur un <strong>attribut</strong> (même privé). Le Spring Framework va chercher
le <em>bean</em> du contexte d’application dont le type est applicable à chaque paramètre
du constructeur, aux paramètres de la méthode ou à l’attribut.</p>
<p>Si nous reprenons, notre exemple du chapitre précédent, nous pouvons simplifier
l’implémentation de la classe <code class="docutils literal notranslate"><span class="pre">WriterService</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Déclaration d’un attribut &#64;Autowired</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WriterService</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

<span class="hll">  <span class="nd">@Autowired</span>
</span><span class="hll">  <span class="kd">private</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span><span class="p">;</span>
</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">supplier</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Nous n’avons plus besoin du constructeur. Spring est capable d’injecter un <em>bean</em>
de type <code class="docutils literal notranslate"><span class="pre">Supplier&lt;String&gt;</span></code> (à condition qu’il n’en existe qu’un seul) dans
l’attribut privé <code class="docutils literal notranslate"><span class="pre">supplier</span></code>. La dépendance n’est marquée que par la présence
de cet attribut.</p>
<p>Notre programme principal devient maintenant :</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Le programme principal</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskApplication</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">dataSupplier</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HardcodedSupplier</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">Runnable</span> <span class="nf">task</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">WriterService</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span> <span class="o">=</span>
                  <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TaskApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">Runnable</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il peut arriver que la dépendance soit optionnelle, c’est-à-dire qu’un <em>bean</em>
puisse ne pas être disponible dans le contexte d’application. Dans ce cas,
nous pouvons positionner l’attribut <code class="docutils literal notranslate"><span class="pre">required</span></code> de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">&#64;Autowired</a> à <code class="docutils literal notranslate"><span class="pre">false</span></code>.
La valeur ne sera pas positionnée mais la création du contexte d’application
n’échouera pas. Il faut bien sûr adapter le code pour que le programme puisse
s’exécuter malgré l’absence de cette dépendance</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WriterService</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="nd">@Autowired</span><span class="p">(</span><span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span><span class="p">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">supplier</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Aucun fournisseur de données disponible.&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">supplier</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="desambiguisation-avec-primary-et-qualifier">
<h2>Désambiguïsation avec &#64;Primary et &#64;Qualifier<a class="headerlink" href="#desambiguisation-avec-primary-et-qualifier" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour gérer automatiquement l’injection de dépendance, le Spring Framework se
base sur le type du <em>bean</em>. Dans l’exemple ci-dessous :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.apptask</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nf">TaskManager</span><span class="p">()</span> <span class="p">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">Runnable</span> <span class="n">tache</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Spring va chercher un <em>bean</em> de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a>, c’est-à-dire un <em>bean</em> qui implémente
l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a> dans le contexte d’application. Il est possible qu’il y ait
plusieurs <em>beans</em> satisfaisant à ce critère. Dans ce cas, Spring va sélectionner
le <em>bean</em> qui porte le même nom que l’attribut : <code class="docutils literal notranslate"><span class="pre">tache</span></code> dans notre exemple.
Pour une méthode de fabrique, le nom du <em>bean</em> correspond au nom de la méthode
ou à une des valeurs précisées dans l’attribut <code class="docutils literal notranslate"><span class="pre">name</span></code> de l’annotation
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a> :</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Nom du <em>bean</em> équivalent au nom de la méthode</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">Runnable</span> <span class="nf">tache</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Nom du <em>bean</em> donné par l’annotation &#64;Bean</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;tache&quot;</span><span class="p">,</span> <span class="s">&quot;task&quot;</span><span class="p">})</span>
<span class="kd">public</span> <span class="n">Runnable</span> <span class="nf">getTask</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notez que le type de retour de la méthode de fabrique n’a pas vraiment
d’importance pour Spring. Ce qui compte, c’est le type réel de l’objet qui
est retourné.</p>
</div>
<p>S’il existe plusieurs <em>beans</em> compatibles avec le type attendu et qu’aucun d’eux
ne porte le bon nom, alors la création du contexte d’application échoue avec
l’exception <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/UnsatisfiedDependencyException.html">UnsatisfiedDependencyException</a>.</p>
<p>Dans une application, ces situations restent exceptionnelles. Cependant, lorsqu’elles
surviennent, nous pouvons aider Spring à lever l’ambiguïté dans le choix du
<em>bean</em> à injecter. Pour cela, nous disposons des annotations <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Primary.html">&#64;Primary</a> et
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Qualifier.html">&#64;Qualifier</a>.</p>
<div class="section" id="l-annotation-primary">
<h3>L’annotation &#64;Primary<a class="headerlink" href="#l-annotation-primary" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Primary.html">&#64;Primary</a> permet d’indiquer le <em>bean</em> qui devra être sélectionné
en priorité en cas d’ambiguïté.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Utilisation de &#64;Primary sur une méthode de fabrique</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span>
<span class="hll"><span class="nd">@Primary</span>
</span><span class="kd">public</span> <span class="n">Runnable</span> <span class="nf">oneTask</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">Runnable</span> <span class="nf">anotherTash</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="l-annotation-qualifier">
<h3>L’annotation &#64;Qualifier<a class="headerlink" href="#l-annotation-qualifier" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Qualifier.html">&#64;Qualifier</a> permet de qualifier, c’est-à-dire de préciser
le nom du <em>bean</em> à injecter. Dans la classe Java, on ajoute l’annotation sur
un attribut ou sur un paramètre d’une méthode ou d’un constructeur.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Utilisation de &#64;Qualifier sur un attribut</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.apptask</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskManager</span> <span class="p">{</span>

  <span class="nd">@Autowired</span>
<span class="hll">  <span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;tache&quot;</span><span class="p">)</span>
</span>  <span class="kd">private</span> <span class="n">Runnable</span> <span class="n">runnable</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">executer</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runnable</span><span class="p">.</span><span class="na">run</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple ci-dessus, si plusieurs <em>beans</em> compatibles avec l’interface
<a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a> sont trouvés dans le contexte d’application, alors c’est celui
portant le nom de <code class="docutils literal notranslate"><span class="pre">tache</span></code> qui sera choisi.</p>
</div>
</div>
<div class="section" id="l-annotation-value">
<span id="spring-annotation-value"></span><h2>L’annotation &#64;Value<a class="headerlink" href="#l-annotation-value" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Value.html">&#64;Value</a> est utilisable sur un attribut ou un paramètre pour un
type primitif ou une chaîne de caractères. Elle donne la valeur par défaut
à injecter.</p>
<p>Si nous reprenons notre exemple du chapitre précédent, nous pouvons créer
un nouveau type de fournisseur de données :</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Utilisation de &#64;Value sur un attribut</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValueSupplier</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>

<span class="hll">  <span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">)</span>
</span><span class="hll">  <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="p">;</span>
</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Le code précédent ne semble pas avoir beaucoup d’intérêt puisque nous aurions
pu directement affecter la chaîne de caractères à l’attribut <code class="docutils literal notranslate"><span class="pre">value</span></code>.
Nous verrons dans les chapitres <a class="reference internal" href="application_context_conf.html"><span class="doc">Configuration d’une application</span></a> et
<a class="reference internal" href="spel.html"><span class="doc">Le langage d’expression SpEL</span></a> que cette annotation devient très utile pour
charger des données depuis un fichier de configuration ou pour résoudre
des dépendances de manière plus souple.</p>
</div>
</div>
<div class="section" id="les-annotations-jsr-250">
<h2>Les annotations JSR-250<a class="headerlink" href="#les-annotations-jsr-250" title="Lien permanent vers ce titre">¶</a></h2>
<p>Indépendamment du Spring Framework, la communauté Java a défini un ensemble
d’annotations dans la spécification <a class="reference external" href="https://en.wikipedia.org/wiki/JSR_250">JSR-250</a>. Certaines d’entre-elles sont reconnues
par le Spring Framework :</p>
<dl class="simple">
<dt><a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/annotation/Resource.html">&#64;Resource</a></dt><dd><p>Cette Annotation peut se substituer à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">&#64;Autowired</a> sur les attributs
et les méthodes <em>setter</em>. Le Spring Framework réalise une injection de dépendance
basée sur le type attendu. Si l’annotation spécifie un nom grâce à son
attribut <code class="docutils literal notranslate"><span class="pre">name</span></code> alors l’injection de dépendance se fait en cherchant un
<em>bean</em> du même nom.</p>
</dd>
</dl>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Utilisation de &#64;Resource sur un attribut</span><a class="headerlink" href="#id9" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.apptask</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.Resource</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskManager</span> <span class="p">{</span>

<span class="hll">  <span class="nd">@Resource</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;tache&quot;</span><span class="p">)</span>
</span>  <span class="kd">private</span> <span class="n">Runnable</span> <span class="n">runnable</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">executer</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runnable</span><span class="p">.</span><span class="na">run</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<dl class="simple">
<dt><a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/annotation/PostConstruct.html">&#64;PostConstruct</a></dt><dd><p>Cette annotation s’utilise sur une méthode publique sans paramètre afin de
signaler que cette méthode doit être appelée par le conteneur IoC après
l’initialisation du <em>bean</em>. Il s’agit d’une alternative à la déclaration de la
<a class="reference internal" href="application_context.html#init-destroy-methods"><span class="std std-ref">méthode d’initialisation</span></a>.</p>
</dd>
<dt><a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/annotation/PreDestroy.html">&#64;PreDestroy</a></dt><dd><p>Cette annotation s’utilise sur une méthode publique sans paramètre afin de
signaler que cette méthode doit être appelée juste avant la fermeture du
contexte d’application. Il s’agit d’une alternative à la déclaration de la
<a class="reference internal" href="application_context.html#init-destroy-methods"><span class="std std-ref">méthode de destruction</span></a>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il est possible de déclarer plusieurs méthodes avec les annotations
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/annotation/PostConstruct.html">&#64;PostConstruct</a> ou <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/annotation/PreDestroy.html">&#64;PreDestroy</a>. Elles seront bien appelées par le
<em>framework</em>. Par contre, s’il existe plusieurs méthodes d’initialisation
(ou plusieurs méthodes de suppression), l’ordre de leur appel est indéterminé
au moment de l’initialisation (ou de la destruction).</p>
</div>
<p>Nous pouvons facilement écrire une classe qui se comporte comme un fournisseur
de connexion à une base de données en utilisant l’API JDBC. Le conteneur IoC
sera responsable d’ouvrir la connexion et de fermer la connexion en appelant
les méthodes d’initialisation et de destruction.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Implémentation simple d’un fournisseur de connexion à une base de données</span><a class="headerlink" href="#id10" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.db</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.PostConstruct</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.annotation.PreDestroy</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleConnectionProvider</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Connection</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">databaseUri</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">login</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Connection</span> <span class="n">connection</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">SimpleConnectionProvider</span><span class="p">(</span><span class="n">String</span> <span class="n">databaseUri</span><span class="p">,</span> <span class="n">String</span> <span class="n">login</span><span class="p">,</span> <span class="n">String</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">databaseUri</span> <span class="o">=</span> <span class="n">databaseUri</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">login</span> <span class="o">=</span> <span class="n">login</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@PostConstruct</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">openConnection</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">databaseUri</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@PreDestroy</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">closeConnection</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">connection</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Connection</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">connection</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="detection-automatique-des-composants-component-scan">
<h2>Détection automatique des composants (<em>component scan</em>)<a class="headerlink" href="#detection-automatique-des-composants-component-scan" title="Lien permanent vers ce titre">¶</a></h2>
<p>Plutôt que de créer les <em>beans</em> avec des méthodes de fabrique, il est possible
de demander au Spring Framework de rechercher dans des packages les classes qui
doivent être instanciées pour ajouter des <em>beans</em> dans le contexte d’application.
On appelle cette opération le <em>component scan</em>.</p>
<p>Pour activer cette fonctionnalité, il suffit de rajouter l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/ComponentScan.html">&#64;ComponentScan</a>
sur la classe qui est passée en paramètre de création du contexte d’application.
Par défaut, le Spring Framework va chercher les classes dans le package de cette
classe et tous les sous packages. Vous pouvez modifier ce comportement à l’aide
de l’attribut <code class="docutils literal notranslate"><span class="pre">basePackages</span></code> qui vous permet de donner la liste des packages
(incluant automatiquement leurs sous-packages) à scruter. Vous pouvez également
utiliser l’attribut <code class="docutils literal notranslate"><span class="pre">basePackageClasses</span></code> pour fournir une liste de classes.
Dans ce cas, ce sont les packages auxquelles appartiennent ces classes (en
incluant automatiquement les sous-packages) qui seront scrutés.</p>
<p>Le <em>framework</em> va scruter toutes les classes et créer un <em>bean</em> dans le conteneur
IoC pour celles qui sont identifiées comme des <strong>composants</strong>. Une classe désigne
un composant si elle possède l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a> ou une annotation de
stéréotype de composant (Cf. ci-dessous).</p>
<p>Nous pouvons reprendre notre exemple du chapitre précédent en réduisant considérablement
le code en remplaçant les méthodes de fabrique par une détection automatique
des composants :</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Déclaration du fournisseur de données comme un composant</span><a class="headerlink" href="#id11" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="hll"><span class="nd">@Component</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HardcodedSupplier</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello world&quot;</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Déclaration du service comme un composant</span><a class="headerlink" href="#id12" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="hll"><span class="nd">@Component</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WriterService</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span><span class="p">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">supplier</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Activation de la détection automatique de composants</span><a class="headerlink" href="#id13" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>

<span class="hll"><span class="nd">@ComponentScan</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskApplication</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span> <span class="o">=</span>
                  <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TaskApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">Runnable</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="notion-de-composant">
<h2>Notion de composant<a class="headerlink" href="#notion-de-composant" title="Lien permanent vers ce titre">¶</a></h2>
<p>Nous l’avons vu à la section précédente, une classe de composant est une classe
annotée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a>. Si nécessaire, on peut spécifier le nom du <em>bean</em>
comme valeur de l’annotation :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span><span class="p">(</span><span class="s">&quot;servicePrincipal&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WriterService</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si on ne fournit pas de nom pour le <em>bean</em>, le Spring Framework le déduit du
nom de la classe en mettant la première lettre en minuscule. Par exemple le
composant de la classe <code class="docutils literal notranslate"><span class="pre">WriterService</span></code> s’appellera par défaut <code class="docutils literal notranslate"><span class="pre">writerService</span></code>.</p>
<p>Comme les méthodes de fabrique, une classe de composant peut également être annotée
avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Primary.html">&#64;Primary</a>. De plus, elle peut elle-même déclarer des méthodes de fabrique,
c’est-à-dire des méthodes portant l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a>. Dans ce cas, ces méthodes
de fabrique seront appelées après la création du <em>bean</em>.</p>
<p>Si la classe du composant déclare un constructeur avec des paramètres, alors
Spring essaiera de résoudre les dépendances pour chaque paramètre. Les paramètres
du constructeur peuvent recevoir les annotations <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Value.html">&#64;Value</a> ou <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Qualifier.html">&#64;Qualifier</a> pour
guider le <em>framework</em> dans le processus d’injection. Si la classe du composant
déclare plusieurs constructeurs alors vous devez ajouter l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">&#64;Autowired</a>
sur le constructeur qui doit être utilisé par le Spring Framework.</p>
</div>
<div class="section" id="stereotype-de-composant">
<h2>Stéréotype de composant<a class="headerlink" href="#stereotype-de-composant" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est possible de donner un stéréotype au composant, c’est-à-dire
de placer une annotation qui permet de comprendre plus précisément le rôle du
composant dans notre application. Certains stéréotypes sont purement descriptifs
et ne servent qu’à fournir une information aux développeurs. D’autres bénéficient
d’un traitement particulier dans certains contextes d’exécution.</p>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a> est un stéréotype générique puisqu’il indique simplement que cette
classe doit être utilisée pour instancier un <em>bean</em>. Les autres stéréotypes fournis
par le Spring Framework sont :</p>
<dl class="simple">
<dt><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Service.html">&#64;Service</a></dt><dd><p>Un service est un composant qui remplit une fonctionnalité centrale dans l’architecture
d’une application. Il renvoie aux classes qui ont la charge de réaliser les
fonctionnalités principales. Il s’agit normalement d’une classe qui ne maintient
pas d’état conversationnel.</p>
</dd>
<dt><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Repository.html">&#64;Repository</a></dt><dd><p>Un <em>repository</em> (référentiel) désigne un composant qui représente un mécanisme
permettant de stocker et de rechercher une collection d’objets. Par exemple, un
DAO (<em>Data Access Object</em>) est une forme de <em>repository</em> qui réalise, la plupart
du temps, une interface avec un système de gestion de base de données.</p>
</dd>
<dt><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html">&#64;Configuration</a></dt><dd><p>Un composant de configuration sert à configurer le contexte d’application.
Généralement, il déclare des méthodes de fabrique annotées avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a>
(Cf. ci-dessous).</p>
</dd>
<dt><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Controller.html">&#64;Controller</a> et <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RestController.html">&#64;RestController</a></dt><dd><p>Un composant qui joue le rôle d’un contrôleur dans une architecture MVC pour
une application Web ou une API Web. Ces stéréotypes seront détaillés dans les
chapitres <a class="reference internal" href="spring_mvc.html"><span class="doc">Les applications Web avec Spring Web MVC</span></a> et <a class="reference internal" href="spring_mvc_apiweb.html"><span class="doc">Les API Web avec Spring Web MVC</span></a>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Les stéréotypes <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Service.html">&#64;Service</a> et <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Repository.html">&#64;Repository</a> sont purement descriptifs.
Ils permettent d’offrir une information supplémentaire aux développeurs.
Ils renvoient directement à des notions décrites dans l’ouvrage de Eric
Evans: <em>Domain-Driven Design</em> (<em>Addison-Wesley</em> 2003).</p>
<p>Si nous poursuivons notre exemple du chapitre précédent, alors le fournisseur
de données se comporte comme un <em>repository</em> et le service comme un service
(évidemment). Nous pouvons ainsi préciser les stéréotypes de chacun.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Déclaration du fournisseur comme <em>repository</em></span><a class="headerlink" href="#id14" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>

<span class="hll"><span class="nd">@Repository</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HardcodedSupplier</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello world&quot;</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">Déclaration du service</span><a class="headerlink" href="#id15" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring4</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="hll"><span class="nd">@Service</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WriterService</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span><span class="p">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">supplier</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="le-stereotype-configuration">
<h2>Le stéréotype &#64;Configuration<a class="headerlink" href="#le-stereotype-configuration" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html">&#64;Configuration</a> permet de déclarer pour Spring un composant qui
ne sert qu’à configurer le contexte de l’application. Normalement ce composant
n’est pas destiné à être injecté comme dépendance mais à déclarer des méthodes
de fabrique annotées avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a>.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Exemple d’un bean de configuration</span><a class="headerlink" href="#id16" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.configuration</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalTime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimeConfiguration</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">startTime</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">endTime</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">return</span> <span class="n">startTime</span><span class="p">().</span><span class="na">plusMinutes</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Dans l’exemple ci-dessus, le <em>bean</em> de configuration ajoute deux <em>beans</em> dans
le contexte d’application, tous deux de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/LocalTime.html">LocalTime</a> : <code class="docutils literal notranslate"><span class="pre">startTime</span></code> et
<code class="docutils literal notranslate"><span class="pre">endTime</span></code> qui pourront être injectés dans les composants où ces valeurs
sont nécessaires.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Dans notre exemple précédent, notez bien la ligne 17. La méthode <code class="docutils literal notranslate"><span class="pre">endTime</span></code>
appelle la méthode <code class="docutils literal notranslate"><span class="pre">startTime</span></code> pour connaître l’heure de début et ainsi,
calculer l’heure de fin. Cela peut sembler trivial et pourtant… <code class="docutils literal notranslate"><span class="pre">startTime</span></code>
désigne un <em>bean</em>, donc la méthode <code class="docutils literal notranslate"><span class="pre">startTime</span></code> sera appelée une fois par
Spring pour calculer l’heure de début à l’initialisation du contexte. Si
la méthode <code class="docutils literal notranslate"><span class="pre">endTime</span></code> appelle également <code class="docutils literal notranslate"><span class="pre">startTime</span></code>, cela peut conduire
à une date de début légèrement différente. Dit autrement, le <em>bean</em> <code class="docutils literal notranslate"><span class="pre">startTime</span></code>
semble être créé deux fois : une fois par Spring et une fois par l’appel
dans la méthode <code class="docutils literal notranslate"><span class="pre">endTime</span></code>. En fait l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html">&#64;Configuration</a> nous
prémunit de ce problème. Une classe annotée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html">&#64;Configuration</a> est
instrumentée par le Spring Framework de manière à se comporter comme attendu.
Donc Spring nous garantit que le <em>bean</em> startTime utilisé par la méthode
<code class="docutils literal notranslate"><span class="pre">endTime</span></code> est bien le même que celui ajouté dans le contexte de l’application.</p>
<p>Dans la documentation officielle de Spring, une différence est faite entre
le <em>lite &#64;Bean mode</em> et le <em>full &#64;Configuration mode</em>. Si nous n’utilisons
pas l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html">&#64;Configuration</a> alors nous devons faire très attention
à n’obtenir un <em>bean</em> de contexte d’application que par injection. Pour
notre exemple précédent, nous serions obligé d’écrire :</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">Exemple d’un bean de configuration</span><a class="headerlink" href="#id17" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.configuration</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalTime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimeConfiguration</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">startTime</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">endTime</span><span class="p">(</span><span class="n">LocalTime</span> <span class="n">startTime</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="n">startTime</span><span class="p">.</span><span class="na">plusMinutes</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Cela peut sembler plus maladroit mais il faut se rappeler que lorsqu’on utilise
un conteneur IoC, c’est lui qui a la responsabilité de créer et d’injecter
les <em>beans</em>. On voit que l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html">&#64;Configuration</a> n’est pas qu’un simple
stéréotype et qu’elle introduit une facilité de programmation en nous masquant
cette subtilité de comportement.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>En considérant la section précédente, il devient évident que la classe passée
en paramètre de la création d’un contexte d’application devrait porter
l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html">&#64;Configuration</a> car elle agit comme le premier <em>bean</em> de
configuration.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.demo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="hll"><span class="nd">@Configuration</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span> <span class="o">=</span>
<span class="hll">                  <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">MyApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
</span>      <span class="c1">// ...</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Un <em>bean</em> de configuration doit être scanné par le Spring Framework pour pouvoir
être instancié et participer à la création du contexte d’application. Si vous développez
des bibliothèques destinées à être réutilisées dans plusieurs applications ou si
vous voulez introduire de la modularité dans l’architecture de votre application,
vous pouvez fournir des <em>beans</em> de configuration pour chaque module et importer
ces <em>beans</em> grâce à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Import.html">&#64;Import</a>.</p>
<p>Imaginons que nous ayons isolé dans notre code un package et tous ses sous packages
pour les classes gérant la sécurité dans notre application et un autre package et
tous ses sous packages pour les classes gérant l’accès aux services nécessaires
à notre application.</p>
<p>Dans le premier package, nous pouvons ajouter la classe <code class="docutils literal notranslate"><span class="pre">SecurityConfiguration</span></code>
qui peut contenir des méthodes de fabrique et indiquer à Spring qu’il doit réaliser
une détection automatique à partir de ce package :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.module.security</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfiguration</span> <span class="p">{</span>

  <span class="c1">//..</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Dans le second package, nous pouvons ajouter la classe <code class="docutils literal notranslate"><span class="pre">ServiceAccessConfiguration</span></code>
qui peut contenir des méthodes de fabrique et indiquer à Spring qu’il doit réaliser
une détection automatique à partir de ce package :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.module.service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceAccessConfiguration</span> <span class="p">{</span>

  <span class="c1">//..</span>

<span class="p">}</span>
</pre></div>
</div>
<p>La classe représentant l’application principale avec la méthode <code class="docutils literal notranslate"><span class="pre">main</span></code> peut
importer ces deux classes de configuration avec l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Import.html">&#64;Import</a> :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.module.app</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">dev.gayerie.module.security.SecurityConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">dev.gayerie.module.service.ServiceAccessConfiguration</span><span class="p">;</span>

<span class="nd">@Import</span><span class="p">({</span><span class="n">SecurityConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">ServiceAccessConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span> <span class="o">=</span>
                  <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">MyApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="creation-de-stereotype-de-composant">
<h2>Création de stéréotype de composant<a class="headerlink" href="#creation-de-stereotype-de-composant" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est extrêmement simple de créer ses propres stéréotypes avec le Spring Framework.
Il suffit de créer sa propre annotation et de lui ajouter elle-même l’annotation
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a>. Il ne faut pas oublier de préciser que notre annotation doit avoir
une rétention de type <code class="docutils literal notranslate"><span class="pre">RUNTIME</span></code> pour être visible par le Spring Framework au
lancement de l’application. Il est même possible de réaliser assez facilement
des traitements spécifiques sur nos propres stéréotypes.</p>
<p>Imaginons que nous voulions créer un stéréotype <code class="docutils literal notranslate"><span class="pre">&#64;ConcurrentTask</span></code> pour identifier
des classes implémentant l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a>. Le conteneur IoC doit créer un
<em>bean</em> pour chacune de ces classes et l’exécuter automatiquement au lancement de
l’application en appelant sa méthode <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html#run()">run</a>. Nous commençons par créer l’annotation
<code class="docutils literal notranslate"><span class="pre">&#64;ConcurrentTaks</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">L’annotation &#64;ConcurrentTask</span><a class="headerlink" href="#id18" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.concurrent</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">java.lang.annotation.ElementType.TYPE</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">java.lang.annotation.RetentionPolicy.RUNTIME</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Documented</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.annotation.AliasFor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Target</span><span class="p">(</span><span class="n">TYPE</span><span class="p">)</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="n">RUNTIME</span><span class="p">)</span>
<span class="nd">@Documented</span>
<span class="hll"><span class="nd">@Component</span>
</span><span class="kd">public</span> <span class="nd">@interface</span> <span class="n">ConcurrentTask</span> <span class="p">{</span>

  <span class="nd">@AliasFor</span><span class="p">(</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">Component</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
  <span class="n">String</span> <span class="nf">value</span><span class="p">()</span> <span class="k">default</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cette annotation est elle-même annotée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a>. Cela suffit au
Spring Framework pour traiter toutes les classes portant cette annotation
comme un composant.</p>
</div>
<p>Nous pouvons créer notre composant de configuration :</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">Le composant de configuration</span><a class="headerlink" href="#id19" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.concurrent</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.Executor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcurrentTaskConfiguration</span> <span class="p">{</span>

  <span class="nd">@Bean</span><span class="p">(</span><span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">&quot;shutdown&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">Executor</span> <span class="nf">executor</span><span class="p">(</span><span class="n">ApplicationContext</span> <span class="n">appCtx</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Executor</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">name</span> <span class="p">:</span> <span class="n">appCtx</span><span class="p">.</span><span class="na">getBeanNamesForAnnotation</span><span class="p">(</span><span class="n">ConcurrentTask</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">executor</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Runnable</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">executor</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Ce composant de configuration déclare une méthode de fabrique pour un exécuteur.
Cette méthode crée un <em>fixed thread pool</em> à la ligne 15. Puis elle récupère et
parcourt le nom de tous les <em>beans</em> du contexte d’application qui possèdent
l’annotation <code class="docutils literal notranslate"><span class="pre">&#64;ConcurrentTask</span></code> que nous avons créée. Ce traitement est rendu
simple grâce à la méthode <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/ListableBeanFactory.html#getBeanNamesForAnnotation-java.lang.Class-">getBeanNamesForAnnotation</a> qui est fournie par le contexte
d’application. Il ne reste plus qu’à récupérer les <em>beans</em> par leur nom et à les
ajouter à l’exécuteur. Notez que la méthode de fabrique attend directement une
instance de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html">ApplicationContext</a> en paramètre. Cela permet d’avoir accès
aux méthodes du contexte d’application.</p>
<p>En ajoutant ce composant de configuration dans notre application Spring finale,
nous pouvons maintenant déclarer des classes implémentant l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a>
et stéréotypées comme <code class="docutils literal notranslate"><span class="pre">&#64;ConcurrentTask</span></code>. Elles seront automatiquement exécutées
par notre application.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">Un exemple de tâche concurrente</span><a class="headerlink" href="#id20" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.concurrent</span><span class="p">;</span>

<span class="nd">@ConcurrentTask</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldTask</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="notions-avancees-pour-la-gestion-des-dependances">
<h2>Notions avancées pour la gestion des dépendances<a class="headerlink" href="#notions-avancees-pour-la-gestion-des-dependances" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans cette section, nous allons voir deux annotations permettant de résoudre
des cas particuliers lors de l’initialisation d’un contexte d’application :
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/annotation/Order.html">&#64;Order</a> et <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/DependsOn.html">&#64;DependsOn</a>.</p>
<div class="section" id="l-annotation-order">
<h3>L’annotation &#64;Order<a class="headerlink" href="#l-annotation-order" title="Lien permanent vers ce titre">¶</a></h3>
<p>Parfois, nous désirons déclarer plusieurs <em>beans</em> qui héritent
de la même classe ou qui implémentent la même interface. Mais l’ordre
d’instanciation de ces <em>beans</em> a une importance. Pour reprendre l’exemple d’un
gestionnaire de tâches, nous pouvons vouloir déclarer plusieurs <em>beans</em> représentant
une tâche et dont les classes implémentent l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a>. Nous pourrions
vouloir introduire un ordre dans ces tâches. Pour cela, nous allons utiliser
l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/annotation/Order.html">&#64;Order</a> :</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">La première tâche</span><a class="headerlink" href="#id21" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.ordered_tasks</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.core.annotation.Order</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Component</span>
<span class="hll"><span class="nd">@Order</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TacheDebut</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;je suis la tâche de début&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">La seconde tâche</span><a class="headerlink" href="#id22" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.ordered_tasks</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.core.annotation.Order</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Component</span>
<span class="hll"><span class="nd">@Order</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TacheIntermediaire</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;je suis la tâche intermédiaire&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">La dernière tâche</span><a class="headerlink" href="#id23" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.ordered_tasks</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.core.annotation.Order</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Component</span>
<span class="hll"><span class="nd">@Order</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TacheFin</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;je suis la tâche de fin&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Le programme principal se présente sous la forme d’un composant dans lequel
on injecte la liste des instances de <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a> disponibles dans le contexte
d’application :</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">L’application</span><a class="headerlink" href="#id24" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.ordered_tasks</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.annotation.PostConstruct</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="hll"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
</span><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@ComponentScan</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="p">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">taches</span><span class="p">;</span>

  <span class="nd">@PostConstruct</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">executer</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Runnable</span> <span class="n">runnable</span> <span class="p">:</span> <span class="n">taches</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">runnable</span><span class="p">.</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span> <span class="o">=</span>
                  <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">MyApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>

    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>L’utilisation de l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/annotation/Order.html">&#64;Order</a> nous garantit l’ordre des <em>beans</em> dans
la liste injectée et la sortie du programme sera donc :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>je suis la tâche de début
je suis la tâche intermédiaire
je suis la tâche de fin
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il est rare que nous ayons besoin de représenter un ordre dans un ensemble
de <em>beans</em>. Mais cela peut arriver lorsque nous voulons déclarer des filtres
de traitement pour une requête HTTP. Spring MVC accepte des composants implémentant
l’interface <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/HandlerInterceptor.html">HandlerInterceptor</a> et il utilise automatiquement ces <em>beans</em>
pour réaliser des traitements avant et après la prise en charge de la requête
HTTP par un contrôleur. Selon le type de traitements que nous voulons mettre
en place, l’ordre peut être déterminant et il est alors pratique de
pouvoir ajouter une annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/core/annotation/Order.html">&#64;Order</a> sur chaque classe implémentant
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/HandlerInterceptor.html">HandlerInterceptor</a>.</p>
</div>
</div>
<div class="section" id="l-annotation-dependson">
<h3>L’annotation &#64;DependsOn<a class="headerlink" href="#l-annotation-dependson" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une dépendance est marquée par la présence d’un attribut dans une classe dont
la valeur doit être injectée. Cela permet à Spring de déterminer l’ordre dans
lequel les <em>beans</em> doivent être créés. Mais il arrive parfois que la dépendance
ne soit pas toujours aussi évidente. C’est notamment le cas quand un <em>bean</em>
dépend d’un effet de bord créé par un autre <em>bean</em>.</p>
</div>
</div>
<div class="section" id="support-des-annotations-standard-jsr-330">
<h2>Support des annotations standard JSR-330<a class="headerlink" href="#support-des-annotations-standard-jsr-330" title="Lien permanent vers ce titre">¶</a></h2>
<p>La communauté Java a proposé des annotations pour déclarer des injections de
dépendance. Elles sont décrites le standard JSR-330. Le Spring Framework supporte
également ces annotations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>La JSR-330 ne fait pas partie de l’API du langage Java, pour pouvoir l’utiliser
vous devez ajouter une dépendance. Pour un projet Maven :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>javax.inject<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>javax.inject<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<p>Les annotations fournies par cette dépendance qui peuvent être utilisées dans
une application Spring :</p>
<dl class="simple">
<dt><a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/Inject.html">&#64;Inject</a></dt><dd><p>Vous pouvez utiliser l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/Inject.html">&#64;Inject</a> à la place de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">&#64;Autowired</a>.</p>
</dd>
<dt><a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/Named.html">&#64;Named</a></dt><dd><p>Vous pouvez utiliser l’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/Named.html">&#64;Named</a> à la place de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a>.
L’annotation <a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/Named.html">&#64;Named</a> peut également être utilisée conjointement avec
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/inject/Inject.html">&#64;Inject</a> pour préciser le nom du <em>bean</em> à injecter.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pour une comparaison plus poussée entre JSR-330 et le Spring Framework,
reportez-vous à la
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-standard-annotations-limitations">documentation de ce dernier</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="application_context_conf.html" class="btn btn-neutral float-right" title="Configuration d’une application" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="application_context.html" class="btn btn-neutral float-left" title="Le contexte d’application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  <div  role="contentinfo">
    <p>
    Par David Gayerie
    - <script>!function(){function e(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})}!function(e){document.write("<a href='mailto:"+e+"'>"+e+"</a>")}(e("qnivq@tnlrevr.qri"))}();</script>
    - <a class="reference external" href="https://gayerie.dev">https://gayerie.dev</a>
    </p>
    <p class="copyright">
      <a class="reference external image-reference" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" src="https://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a>
      Cette œuvre est mise à disposition selon les termes de la <a class="reference external" href="https://creativecommons.org/licenses/by-sa/3.0/fr/">Licence Creative Commons Attribution</a> -  Partage dans les Mêmes Conditions 3.0 France
    </p>
  </div>


</footer>

        </div>

      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99071053-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>