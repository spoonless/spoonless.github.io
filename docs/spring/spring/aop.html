

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  <meta content="David Gayerie" name="author" />
<meta content="Spring Framework - La programmation orientée aspect" name="description" />
<meta content="Java, Spring Framework, framework, Jakarta EE, Java EE, IoC, injection de dépendances" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  

  <title>Spring AOP : programmation orientée aspect &mdash; Spring Framework / Spring Boot</title>



  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://gayerie.dev/docs/spring/spring/aop.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Introduction à Spring Web MVC" href="spring_mvc_intro.html" />
    <link rel="prev" title="Le langage d’expression SpEL" href="spel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Spring Framework / Spring Boot
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Spring Framework et Spring Boot</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#le-spring-framework-vs-j2ee">Le Spring Framework vs. J2EE</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-modules-spring-framework">Les modules Spring Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-projets-spring">Les projets Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="principe_ioc.html">L’inversion de contrôle</a><ul>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#l-injection-de-dependance">L’injection de dépendance</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#id2">L’inversion de contrôle</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#notion-de-conteneur-ioc">Notion de conteneur IoC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_context.html">Le contexte d’application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#mise-en-place-du-projet">Mise en place du projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#une-premiere-application-avec-spring">Une première application avec Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#notion-de-portee-scope">Notion de portée (scope)</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#l-injection-de-bean">L’injection de bean</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#les-methodes-d-initialisation-et-de-destruction">Les méthodes d’initialisation et de destruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="annotations.html">Déclaration par annotations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#l-annotation-autowired">L’annotation &#64;Autowired</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#desambiguisation-avec-primary-et-qualifier">Désambiguïsation avec &#64;Primary et &#64;Qualifier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-primary">L’annotation &#64;Primary</a></li>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-qualifier">L’annotation &#64;Qualifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#l-annotation-value">L’annotation &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#les-annotations-jsr-250">Les annotations JSR-250</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#detection-automatique-des-composants-component-scan">Détection automatique des composants (<em>component scan</em>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#notion-de-composant">Notion de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#stereotype-de-composant">Stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#le-stereotype-configuration">Le stéréotype &#64;Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#creation-de-stereotype-de-composant">Création de stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#notions-avancees-pour-la-gestion-des-dependances">Notions avancées pour la gestion des dépendances</a><ul>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-order">L’annotation &#64;Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-dependson">L’annotation &#64;DependsOn</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#support-des-annotations-standard-jsr-330">Support des annotations standard JSR-330</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_context_conf.html">Configuration d’une application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#lancer-une-application-spring-boot">Lancer une application Spring Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#spring-boot-et-le-fichier-application-properties">Spring Boot et le fichier application.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#injection-des-proprietes-avec-value">Injection des propriétés avec &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#ajout-de-fichiers-de-proprietes-avec-propertysource">Ajout de fichiers de propriétés avec &#64;PropertySource</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#les-variables-d-environnement">Les variables d’environnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#la-classe-environment">La classe Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#beans-de-proprietes-avec-configurationproperties-spring-boot">Beans de propriétés avec &#64;ConfigurationProperties (Spring Boot)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="application_context_conf.html#introduction-a-bean-validation">Introduction à Bean Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#pour-en-savoir-plus">Pour en savoir plus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spel.html">Le langage d’expression SpEL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spel.html#un-exemple-d-utilisation-de-spel">Un exemple d’utilisation de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#principe-de-spel">Principe de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-ternaire">L’opérateur ternaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-elvis">L’opérateur Elvis</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-de-surete">L’opérateur de sûreté</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#la-projection">La projection</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Spring AOP : programmation orientée aspect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#principe-de-la-programmation-orientee-aspect">Principe de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terminologie-de-la-programmation-orientee-aspect">Terminologie de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integration-du-module-spring-aop">Intégration du module Spring AOP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exemple-de-programmation-orientee-aspect-avec-spring-aop">Exemple de programmation orientée aspect avec Spring AOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-programmation-orientee-aspect-pour-gerer-les-annotations">La programmation orientée Aspect pour gérer les annotations</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring Web MVC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_intro.html">Introduction à Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#le-modele-mvc">Le modèle MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#integration-de-spring-web-mvc">Intégration de Spring Web MVC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-avec-spring-boot">Intégration dans une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#l-encodage-des-parametres-de-requetes">L’encodage des paramètres de requêtes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc.html">Les applications Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-controleurs">Les contrôleurs</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-vues-jsp">Les vues JSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-vues-jsp">Utilisation des vues JSP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-vues-thymeleaf">Les vues Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id1">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id2">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-vues-thymeleaf">Utilisation des vues Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#le-modele">Le modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#une-application-multi-couches-n-tiers">Une application multi-couches (N-Tiers)</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#la-signature-des-methodes-de-controleur">La signature des méthodes de contrôleur</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#les-parametres">Les paramètres</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#la-valeur-de-retour">La valeur de retour</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#taglib-jsp-et-gestion-des-formulaires">Taglib JSP et gestion des formulaires</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#spring-s-jsp-taglib">Spring’s JSP taglib</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#form-taglib">Form taglib</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#gestion-des-formulaires-avec-thymeleaf">Gestion des formulaires avec Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#externalisation-des-messages">Externalisation des messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id4">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id5">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-messages-dans-une-jsp">Utilisation des messages dans une JSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-messages-avec-thymeleaf">Utilisation des messages avec Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#validation-des-parametres-d-une-requete">Validation des paramètres d’une requête</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#la-notion-de-binding-et-le-bindingresult">La notion de <em>binding</em> et le BindingResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#validation-dans-la-methode-du-controleur">Validation dans la méthode du contrôleur</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#creation-d-un-validateur">Création d’un validateur</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#validation-declarative-avec-bean-validation">Validation déclarative avec Bean Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#affichage-des-erreurs-de-validation">Affichage des erreurs de validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#post-redirect-get">POST-redirect-GET</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#la-gestion-des-exceptions">La gestion des exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#methodes-de-modele">Méthodes de modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#methodes-de-binder">Méthodes de binder</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#controlleradvice">ControllerAdvice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_apiweb.html">Les API Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#support-pour-les-formats-json-et-xml">Support pour les formats JSON et XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-annotation-restcontroller">L’annotation &#64;RestController</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#un-controleur-pour-une-api-web">Un contrôleur pour une API Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-negociation-de-contenu">La négociation de contenu</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-envoi-de-donnees">L’envoi de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-reponse">La réponse</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#restcontrolleradvice">RestControllerAdvice</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#les-annotations-jackson">Les annotations Jackson</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_apiweb.html#les-vues-json">Les vues JSON</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#implementation-d-un-client">Implémentation d’un client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="thymeleaf.html">Introduction à Thymeleaf</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#integration-de-thymeleaf">Intégration de Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-attributs-thymeleaf">Les attributs Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-evaluation">${…} : l’expression d’évaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-selection">*{…} : l’expression de sélection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-message">#{…} : l’expression de message</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-url">&#64;{…} : l’expression d’URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#prevention-de-l-injection">Prévention de l’injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-conditions-et-les-boucles">Les conditions et les boucles</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#operateur-de-coalescence-des-nuls">Opérateur de coalescence des nuls</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#le-formatage-des-donnees">Le formatage des données</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring et l'accès aux bases de données</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spring_dao.html">Spring DAO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#l-annotation-repository">L’annotation &#64;Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#integration-de-jpa">Intégration de JPA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#acces-aux-donnees-avec-jdbc">Accès aux données avec JDBC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id1">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id2">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#uniformite-de-la-hierarchie-des-exceptions">Uniformité de la hiérarchie des exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_data_jpa.html">Spring Data avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#notion-de-repository">Notion de repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#spring-data-jpa">Spring Data JPA</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#integration-des-repositories">Intégration des repositories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#injection-des-repositories">Injection des <em>repositories</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#ajout-de-methodes-dans-une-interface-de-repository">Ajout de méthodes dans une interface de repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#requetes-nommees-jpa">Requêtes nommées JPA</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#utilisation-de-query">Utilisation de &#64;Query</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#declaration-de-requetes-de-modification">Déclaration de requêtes de modification</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#implementation-des-methodes-de-repository">Implémentation des méthodes de <em>repository</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_tx.html">Spring Transaction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#la-transaction">La transaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#transaction-et-couche-de-service">Transaction et couche de service</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#l-annotation-transactional">L’annotation &#64;Transactional</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#gestion-declarative-du-rollback">Gestion déclarative du <em>rollback</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-avancee-pour-les-transactions">Configuration avancée pour les transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#la-propagation">La propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#l-isolation">L’isolation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-des-transactions-sans-spring-boot">Configuration des transactions sans Spring Boot</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spring Framework / Spring Boot</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="banner">D'autres formations sont sur <a href="https://gayerie.dev">https://gayerie.dev</a></div>

        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Spring AOP : programmation orientée aspect</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="spring_mvc_intro.html" class="btn btn-neutral float-right" title="Introduction à Spring Web MVC" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spel.html" class="btn btn-neutral float-left" title="Le langage d’expression SpEL" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spring-aop-programmation-orientee-aspect">
<h1>Spring AOP : programmation orientée aspect<a class="headerlink" href="#spring-aop-programmation-orientee-aspect" title="Lien permanent vers ce titre">¶</a></h1>
<p>En programmation orientée objet, il arrive souvent que l’on trouve des portions
de code qui se répètent à travers différentes méthodes. Par exemple, pour une
application qui accède à une base de données, chaque interaction avec la base
de données doit s’inscrire dans une transaction. Même si nous concevons une
architecture objet avec une classe spécialisée pour gérer une transaction, nous
allons devoir faire appel à une instance de cette classe dans chaque méthode qui
interagit avec la base de données. Nous allons devoir répéter les actions dans
notre code.</p>
<p>Dans des applications pour les entreprises, ce type de problématiques est souvent
lié à des services techniques : gestion des connexions à un service tiers, gestion
des transactions, écriture de fichiers de log ou encore sécurisation des accès.</p>
<p>La programmation orientée objet ne fournit pas de solution élégante à ces
problématiques. C’est pour résoudre spécifiquement ces cas de figure que la
<strong>Programmation Orientée Aspect</strong> (POA ou AOP pour <em>Aspect Oriented Programming</em>)
a été introduite.</p>
<p>La POA n’est pas une notion propre au Spring Framework. Dans la communauté Java,
le projet <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html">AspectJ</a> est le projet le plus avancé pour intégrer la programmation
orientée aspect au langage. <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Spring AOP</a> est le module Spring chargé d’ajouter
le support de la programmation aspect en se basant en grande partie sur <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html">AspectJ</a>.</p>
<div class="section" id="principe-de-la-programmation-orientee-aspect">
<h2>Principe de la programmation orientée aspect<a class="headerlink" href="#principe-de-la-programmation-orientee-aspect" title="Lien permanent vers ce titre">¶</a></h2>
<p>La programmation orientée aspect (POA) est utilisée pour implémenter des
fonctionnalités transverses (<em>cross-cutting concerns</em>). Elle permet de rendre
l’architecture plus modulaire. Un <strong>aspect</strong> représente une catégorie d’actions
à réaliser dans certaines conditions. Par exemple, gérer les transactions,
produire des informations de log, mettre en cache des informations…
Plutôt que de répéter (ou d’appeler) ce code dans les différentes classes de
l’application, nous allons définir des points à partir desquels l’aspect devra
s’exécuter. Puis à l’aide d’un tisseur d’aspects (<em>weaver</em>), le flot normal
d’exécution de l’application va être modifié afin d’exécuter les actions de cet
aspect aux points voulus.</p>
<p>Dans la POA, on distingue l’approche statique et l’approche dynamique. L’approche
statique modifie le code au moment de la compilation afin d’introduire aux points
voulus l’exécution des aspects. Cette approche est complexe à prendre en charge
car elle nécessite une étape supplémentaire à la compilation. L’approche dynamique
est réalisée au moment de l’exécution de l’application. Elle ne nécessite donc
pas de compilation particulière. Elle peut néanmoins nécessiter une instrumentation
du code au moment du chargement des classes dans la JVM mais ce processus est
transparent pour le développeur. L’approche dynamique introduit un coût supplémentaire
à l’exécution puisqu’une bibliothèque tierce doit prendre en charge l’exécution
des aspects. En pratique, ce surcoût est négligeable.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Comme toujours avec le Spring Framework, nous avons le choix dans l’intégration
des technologies. Ainsi le Spring Framework supporte à la fois l’approche
statique et l’approche dynamique. Pour cette dernière, il supporte même
plusieurs techniques. Pour simplifier notre présentation, nous nous limiterons
à une approche dynamique basée sur la création de classes <em>proxy</em> grâce à la
bibliothèque CGLIB et sur l’utilisation des annotations <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html">AspectJ</a> qui sont,
de fait, devenues le standard en Java.</p>
</div>
<p>Notez cependant que le support de la programmation aspect par Spring est limité.
Il ne permet d’appliquer les principes de la programmation qu’à l’appel de méthodes.
Nous allons pouvoir exécuter du code supplémentaire avant, après l’appel d’une
méthode. Nous avons même la possibilité de remplacer totalement l’exécution
d’une méthode.</p>
<p>La création d’aspect est très certainement réservé à un usage avancé du Spring
Framework. Néanmoins, comprendre les bases de la programmation orientée aspect
vous permettra de mieux comprendre la manière donc le Spring Framework (et
d’autres <em>frameworks</em>) peuvent instrumenter le code d’une application. Un exemple
courant est la gestion des transactions que nous aborderons dans le chapitre
<a class="reference internal" href="spring_tx.html"><span class="doc">Spring Transaction</span></a>.</p>
</div>
<div class="section" id="terminologie-de-la-programmation-orientee-aspect">
<h2>Terminologie de la programmation orientée aspect<a class="headerlink" href="#terminologie-de-la-programmation-orientee-aspect" title="Lien permanent vers ce titre">¶</a></h2>
<p>La POA introduit un vocabulaire spécifique pour décrire le mécanisme de
traitement de problématiques transverses (<em>cross-cutting concerns</em>) :</p>
<dl>
<dt>Aspect</dt><dd><p>La problématique spécifique que l’on veut ajouter transversalement à notre
architecture : par exemple la gestion des transactions avec la base de données.</p>
</dd>
<dt>Point de jonction (<em>JoinPoint</em>)</dt><dd><p>Le point dans le flot d’exécution d’un programme à partir duquel on souhaite
ajouter la logique d’exécution de l’aspect.</p>
</dd>
<dt>Greffon (<em>Advice</em>)</dt><dd><p>L’action particulière de l’aspect à exécuter quand le programme atteint le point
de jonction. Avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Spring AOP</a>, le point de jonction correspond toujours à
l’appel d’une méthode. Le greffon peut spécifier si le code doit s’exécuter
avant l’appel à la méthode, après l’appel à la méthode ou s’il doit encapsuler
l’appel à la méthode ou ne s’exécuter que si une exception survient.</p>
</dd>
<dt>Coupe (<em>Pointcut</em>)</dt><dd><p>Une expression qui définit l’ensemble des points de jonctions éligibles pour
le greffon. Par exemple :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="p">(</span><span class="n">User</span> <span class="n">dev.gayerie</span><span class="p">.</span><span class="na">Service</span><span class="p">.</span><span class="o">*</span><span class="p">(...))</span>
</pre></div>
</div>
<p>La coupe ci-dessus désigne l’appel à n’importe quelle méthode qui retourne un
objet de type <code class="docutils literal notranslate"><span class="pre">User</span></code> de la classe <code class="docutils literal notranslate"><span class="pre">Service</span></code> qui appartient au package
dev.gayerie.</p>
</dd>
<dt>Objet cible (<em>Target object</em>)</dt><dd><p>L’objet sur lequel est appliqué l’aspect.</p>
</dd>
<dt>Tissage (<em>Weaving</em>)</dt><dd><p>Le processus qui permet de réaliser l’insertion de l’aspect soit au moment
de la compilation (POA statique) soit au moment de l’exécution (POA dynamique).
Dans le cas de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Spring AOP</a>, le tissage se fait au moment de la création
du contexte d’application. Ce processus est donc transparent pour le développeur
de l’application.</p>
</dd>
<dt>Introduction</dt><dd><p>Le processus qui permet à un aspect d’ajouter une méthode ou un attribut à un
objet lors du tissage. Ce processus n’est pas supporté par <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Spring AOP</a>
pour un tissage dynamique. Nous n’aborderons donc pas ce point de ce chapitre.</p>
</dd>
</dl>
</div>
<div class="section" id="integration-du-module-spring-aop">
<h2>Intégration du module Spring AOP<a class="headerlink" href="#integration-du-module-spring-aop" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’intégration du module Spring AOP est légèrement différente suivant que vous
développiez une application avec ou sans Spring Boot.</p>
<div class="section" id="integration-dans-une-application-spring-boot">
<h3>Intégration dans une application Spring Boot<a class="headerlink" href="#integration-dans-une-application-spring-boot" title="Lien permanent vers ce titre">¶</a></h3>
<p>Spring Boot est conçu pour simplifier la configuration d’une application Spring.
Donc, pour intégrer Spring AOP, il suffit d’ajouter dans votre projet une
dépendance à <code class="docutils literal notranslate"><span class="pre">spring-boot-starter-aop</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Déclaration de la dépendance dans le fichier pom.xml pour Maven</span><a class="headerlink" href="#id1" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-aop<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="integration-dans-une-application-sans-spring-boot">
<h3>Intégration dans une application sans Spring Boot<a class="headerlink" href="#integration-dans-une-application-sans-spring-boot" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans une application Spring, vous devez déclarer les dépendances au module
<code class="docutils literal notranslate"><span class="pre">spring-aop</span></code> et également aux modules de <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html">AspectJ</a> nécessaires.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Déclaration des dépendances dans le fichier pom.xml pour Maven</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-aop<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>5.3.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.9.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>aspectjweaver<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.9.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<p>Puis, sur une classe de configuration de votre contexte d’application, vous
devez ajouter l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/EnableAspectJAutoProxy.html">&#64;EnableAspectJAutoProxy</a> :</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Un exemple d’activation de Spring AOP</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.EnableAspectJAutoProxy</span><span class="p">;</span>

<span class="hll"><span class="nd">@EnableAspectJAutoProxy</span>
</span><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span> <span class="o">=</span>
                  <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exemple-de-programmation-orientee-aspect-avec-spring-aop">
<h2>Exemple de programmation orientée aspect avec Spring AOP<a class="headerlink" href="#exemple-de-programmation-orientee-aspect-avec-spring-aop" title="Lien permanent vers ce titre">¶</a></h2>
<p>Imaginons que notre application contienne une classe <code class="docutils literal notranslate"><span class="pre">BusinessService</span></code> qui
réalise un traitement important pour notre application :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BusinessService</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;réalise un traitement important pour l&#39;application&quot;</span><span class="p">);</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Imaginons que nous souhaitions introduire un aspect de <em>logging</em>. Nous voulons
tracer les appels aux méthodes de toutes les classes dont le nom se termine
par <code class="docutils literal notranslate"><span class="pre">Service</span></code>. Sans la programmation orientée aspect, nous pouvons bien
sûr ajouter du code supplémentaire dans chacune des méthodes de ces classes…
au risque d’en oublier et de dupliquer du code. Avec la programmation orientée
aspect et <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Spring AOP</a> nous allons pouvoir centraliser ces traitements
transversaux dans une seule classe qui servira à définir notre aspect et qui
aura l’annotation <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Aspect.html">&#64;Aspect</a>.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Un aspect pour écrire des logs sur la sortie standard</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.aspectj.lang.JoinPoint</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Aspect</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Before</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogAspect</span> <span class="p">{</span>

  <span class="nd">@Before</span><span class="p">(</span><span class="s">&quot;execution(public * dev.gayerie.*Service.*(..))&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="p">(</span><span class="n">JoinPoint</span> <span class="n">joinPoint</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;Appel de %s avec %d paramètres%n&quot;</span><span class="p">,</span>
                      <span class="n">joinPoint</span><span class="p">.</span><span class="na">toShortString</span><span class="p">(),</span>
                      <span class="n">joinPoint</span><span class="p">.</span><span class="na">getArgs</span><span class="p">().</span><span class="na">length</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La classe <code class="docutils literal notranslate"><span class="pre">LogAspect</span></code> ci-dessus est annotée avec <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Aspect.html">&#64;Aspect</a> mais également
avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a> pour être prise en charge par Spring. Elle déclare une méthode
qui représente le greffon (<em>advice</em>), c’est-à-dire l’action à réaliser. Ce
greffon est annoté avec <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Before.html">&#64;Before</a>. Cette annotation indique que ce greffon doit
s’appliquer avant l’appel à une méthode. L’attribut de l’annotation <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Before.html">&#64;Before</a>
correspond à la coupe (<em>pointcut</em>) indiquant les méthodes qui sont impactées par
ce greffon.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;execution(public * dev.gayerie.*Service.*(..))&quot;</span>
</pre></div>
</div>
<p>Une coupe commence par un <em>designator</em> qui précise la cible définit. Dans l’exemple
ci-dessus, on utilise <code class="docutils literal notranslate"><span class="pre">execution()</span></code> qui indique que la coupe décrit l’appel
à une méthode. Entre les parenthèses, on fournit la description des méthodes
concernées. Dans notre exemple, il s’agit des méthodes publiques qui retournent
n’importe quoi (y compris <code class="docutils literal notranslate"><span class="pre">void</span></code>), qui appartiennent à une classe du package
dev.gayerie dont le nom se termine par <code class="docutils literal notranslate"><span class="pre">Service</span></code> et quels que soient les
paramètres déclarés.</p>
<p>Ci-dessous, le tableau des <em>designators</em> supportés par <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">Spring AOP</a> :</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Designator</p></th>
<th class="head"><p>Cible</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>execution()</p></td>
<td><p>L’appel à une méthode décrite par la coupe</p></td>
</tr>
<tr class="row-odd"><td><p>within()</p></td>
<td><p>L’appel à une méthode d’un type décrit par la coupe</p></td>
</tr>
<tr class="row-even"><td><p>target()</p></td>
<td><p>L’appel à une méthode d’un type donné par la coupe</p></td>
</tr>
<tr class="row-odd"><td><p>args()</p></td>
<td><p>L’appel à une méthode dont les types des paramètres correspondent à ceux donnés par la coupe</p></td>
</tr>
<tr class="row-even"><td><p>&#64;target()</p></td>
<td><p>L’appel à une méthode d’un type portant l’annotation donnée par la coupe</p></td>
</tr>
<tr class="row-odd"><td><p>&#64;args()</p></td>
<td><p>L’appel à une méthode dont les arguments portent les annotations données par la coupe</p></td>
</tr>
<tr class="row-even"><td><p>&#64;within()</p></td>
<td><p>L’appel à une méthode d’un type portant l’annotation décrite par la coupe</p></td>
</tr>
<tr class="row-odd"><td><p>&#64;annotation()</p></td>
<td><p>L’appel à une méthode portant elle-même l’annotation décrite par la coupe</p></td>
</tr>
</tbody>
</table>
<p>La méthode de greffon <code class="docutils literal notranslate"><span class="pre">log</span></code> attend un paramètre de type <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/runtime-api/org/aspectj/lang/JoinPoint.html">JoinPoint</a>. Ce paramètre
représente le point de jonction et permet d’accéder à des informations en
utilisant notamment l’API de réflexivité de Java.</p>
<p>Si nous exécutons notre application et que la méthode <code class="docutils literal notranslate"><span class="pre">BusinessService.doSomething</span></code>
est appelée à une moment, nous verrons sur la sortie standard :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Appel de execution(BusinessService.doSomething()) avec 0 paramètres
réalise un traitement important pour l&#39;application
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>L’exemple précédent est très simple. Mais remarquez qu’un aspect est un
<em>bean</em> Spring. Cela veut dire que nous pouvons injecter n’importe quelle
dépendance dans ce <em>bean</em>. Nous pouvons donc réaliser facilement des
traitements beaucoup plus complexes.</p>
</div>
<p>Nous pouvons compléter notre aspect et le complexifier un peut :</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Un aspect pour écrire des logs sur la sortie standard</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.aspectj.lang.JoinPoint</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.AfterThrowing</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Aspect</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Before</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Pointcut</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogAspect</span> <span class="p">{</span>

  <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&quot;execution (public * dev.gayerie.*Service.*(..))&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">methodCall</span><span class="p">()</span> <span class="p">{}</span>

  <span class="nd">@Before</span><span class="p">(</span><span class="s">&quot;methodCall()&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="p">(</span><span class="n">JoinPoint</span> <span class="n">joinPoint</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;Appel de %s avec %d paramètres%n&quot;</span><span class="p">,</span>
                      <span class="n">joinPoint</span><span class="p">.</span><span class="na">toShortString</span><span class="p">(),</span>
                      <span class="n">joinPoint</span><span class="p">.</span><span class="na">getArgs</span><span class="p">().</span><span class="na">length</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@AfterThrowing</span><span class="p">(</span><span class="n">pointcut</span> <span class="o">=</span> <span class="s">&quot;methodCall()&quot;</span><span class="p">,</span> <span class="n">throwing</span> <span class="o">=</span> <span class="s">&quot;e&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="p">(</span><span class="n">JoinPoint</span> <span class="n">joinPoint</span><span class="p">,</span> <span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;Retour de %s avec une exception %s%n&quot;</span><span class="p">,</span>
                      <span class="n">joinPoint</span><span class="p">.</span><span class="na">toShortString</span><span class="p">(),</span>
                      <span class="n">e</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Dans l’exemple ci-dessus, nous avons ajouté un nouveau greffon (lignes 24 à 29)
avec l’annotation <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/AfterThrowing.html">&#64;AfterThrowing</a> pour signaler qu’il doit être exécuté
uniquement si la méthode se termine par une exception. Comme nous voulons utiliser
la même coupe pour les deux greffons, nous avons ajouté une méthode annotée avec
<a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Pointcut.html">&#64;Pointcut</a>. Cette méthode ne contient pas de code car elle ne sera jamais appelée.
C’est une convention pour déclarer une coupe et lui donner le même nom que la
méthode. Ainsi nous déclarons une coupe que nous appelons <code class="docutils literal notranslate"><span class="pre">methodCall</span></code> (lignes
14 et 15). Nous pouvons ainsi nous servir de ce nom dans la déclaration des
coupes pour les annotation <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Before.html">&#64;Before</a> et <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/AfterThrowing.html">&#64;AfterThrowing</a> aux lignes 17 et 24.</p>
<p>Concernant le greffon devant tracer la levée d’une exception, nous souhaitons
capturer l’exception pour tracer son type. Dans l’annotation <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/AfterThrowing.html">&#64;AfterThrowing</a>,
nous utilisons l’attribut <code class="docutils literal notranslate"><span class="pre">throwing</span></code> pour nommer le paramètre du greffon
qui correspond à l’exception. Dans notre exemple, c’est le paramètre que nous
appelons <code class="docutils literal notranslate"><span class="pre">e</span></code>. Ainsi, nous pouvons ajouter un paramètre à notre greffon et
recevoir en paramètre l’exception qui a été levée.</p>
</div>
<div class="section" id="la-programmation-orientee-aspect-pour-gerer-les-annotations">
<h2>La programmation orientée Aspect pour gérer les annotations<a class="headerlink" href="#la-programmation-orientee-aspect-pour-gerer-les-annotations" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une utilisation intéressante des aspects est d’introduire des coupes en se basant
sur la présence d’annotations sur les méthodes et/ou les classes.
Une annotation en Java est un type qui peut contenir des attributs. Il s’agit
d’une méta-information mais qui n’a pas d’influence sur l’exécution du programme.
Il faut qu’il existe du code capable de réagir à la présence d’une annotation.
L’idée même des annotations est en fait très proche des principes de la programmation
orientée aspect. On ajoute souvent une annotation sur une méthode ou une classe
pour changer de manière transversale la façon dont cette classe ou cette méthode
va se comporter.</p>
<p>Dans ce cas là, la programmation orientée aspect est très utile. Elle peut nous
permettre de déclencher un greffon (<em>advice</em>) lorsqu’on appel une méthode
portant une annotation (ou appartenant à une classe portant une annotation ou
ayant des paramètres portant des annotations).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ce type d’usage est exactement celui proposé par Spring Transaction avec
l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">&#64;Transactional</a>. Nous verrons comment utiliser cette
annotation dans le chapitre <a class="reference internal" href="spring_tx.html"><span class="doc">Spring Transaction</span></a>.</p>
</div>
<p>Nous souhaitons mettre en place un système de supervision des performances
de notre application. Pour cela, nous souhaitons tracer des alertes lorsque
l’exécution de certaines méthodes dure trop longtemps. Nous allons définir
l’annotation <code class="docutils literal notranslate"><span class="pre">&#64;Supervision</span></code> avec l’attribut <code class="docutils literal notranslate"><span class="pre">dureeMillis</span></code> qui permet de
préciser la durée maximale d’exécution en millisecondes :</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">L’annotation &#64;Supervision</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="p">;</span>

<span class="nd">@Retention</span><span class="p">(</span><span class="n">RetentionPolicy</span><span class="p">.</span><span class="na">RUNTIME</span><span class="p">)</span>
<span class="nd">@Target</span><span class="p">(</span><span class="n">ElementType</span><span class="p">.</span><span class="na">METHOD</span><span class="p">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">Supervision</span> <span class="p">{</span>

  <span class="kt">int</span> <span class="nf">dureeMillis</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si vous n’avez pas l’habitude de créer vos propres annotations, vous
pouvez en apprendre plus en consultant <a class="reference external" href="https://gayerie.dev/docs/java/langage_java/les_annotations.html">cette page</a>.</p>
</div>
<p>Nous pouvons maintenant modifier l’implémentation de notre classe de service
prise en exemple :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BusinessService</span> <span class="p">{</span>

  <span class="nd">@Supervision</span><span class="p">(</span><span class="n">dureeMillis</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;réalise un traitement important pour l&#39;application&quot;</span><span class="p">);</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Nous voyons qu’ici nous devons mesurer la durée d’exécution de la méthode. Pour
cela, nous déclarer un greffon pour envelopper son appel :</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">L’aspect de gestion de la supervision</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.aop</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Around</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.aspectj.lang.annotation.Aspect</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>

<span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SupervisionAspect</span> <span class="p">{</span>

  <span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;@annotation(supervision)&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">superviser</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">joinPoint</span><span class="p">,</span> <span class="n">Supervision</span> <span class="n">supervision</span><span class="p">)</span>
                      <span class="kd">throws</span> <span class="n">Throwable</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="n">maxDuree</span> <span class="o">=</span> <span class="n">supervision</span><span class="p">.</span><span class="na">dureeMillis</span><span class="p">();</span>
    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">joinPoint</span><span class="p">.</span><span class="na">proceed</span><span class="p">(</span><span class="n">joinPoint</span><span class="p">.</span><span class="na">getArgs</span><span class="p">());</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
      <span class="kt">long</span> <span class="n">duree</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">duree</span> <span class="o">&gt;</span> <span class="n">maxDuree</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;Attention l&#39;appel à %s à durée %dms soit %dms de plus qu&#39;attendu%n&quot;</span><span class="p">,</span>
                          <span class="n">joinPoint</span><span class="p">.</span><span class="na">toShortString</span><span class="p">(),</span> <span class="n">duree</span><span class="p">,</span> <span class="n">duree</span> <span class="o">-</span> <span class="n">maxDuree</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>L’annotation <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Around.html">&#64;Around</a> permet de définir un greffon qui doit envelopper l’appel
à une méthode. La coupe est définie par :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;@annotation(supervision)&quot;</span>
</pre></div>
</div>
<p>Cette déclaration se lit : lors de l’appel à une méthode qui porte l’annotation
donnée par <code class="docutils literal notranslate"><span class="pre">supervision</span></code>. Ce dernier correspond au paramètre du même nom de
la méthode et qui est du type <code class="docutils literal notranslate"><span class="pre">Supervision</span></code>. Donc ce greffon concerne l’appel
à toutes les méthodes annotées avec <code class="docutils literal notranslate"><span class="pre">&#64;Supervision</span></code>. Pour un greffon annoté
avec <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Around.html">&#64;Around</a>, nous pouvons recevoir un paramètre de type <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/runtime-api/org/aspectj/lang/ProceedingJoinPoint.html">ProceedingJoinPoint</a>.
Cette classe hérite de <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/runtime-api/org/aspectj/lang/JoinPoint.html">JoinPoint</a> et fournit des méthodes supplémentaires :
notamment la méthode <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/runtime-api/org/aspectj/lang/ProceedingJoinPoint.html#proceed(java.lang.Object[])">proceed</a> qui nous permet d’appeler la méthode désignée
par la coupe.</p>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>On se rend compte qu’avec l’annotation <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/aspectj5rt-api/org/aspectj/lang/annotation/Around.html">&#64;Around</a>, nous pouvons décider
du moment ou la méthode désignée par la coupe doit être appelée. Nous
pouvons même ne pas l’appeler ou remplacer ses paramètres au moment de l’appel.
Ce type de greffon peut permettre de réaliser des aspects très complexes.</p>
</div>
<p>Pour notre exemple, le greffon récupère la durée attendue directement de l’annotation
reçue en paramètre. Il mémorise le temps avant le lancement de la méthode.
Il appelle ensuite la méthode (ligne 18) grâce à la méthode <a class="reference external" href="https://www.eclipse.org/aspectj/doc/released/runtime-api/org/aspectj/lang/ProceedingJoinPoint.html#proceed(java.lang.Object[])">proceed</a>. Enfin,
il ne reste plus qu’a récupérer le temps après le retour de la méthode, à calculer
la durée d’exécution et à éventuellement afficher un message si le temps
d’exécution a été trop long.</p>
<p>Si nous exécutons notre programme et que la durée d’exécution à la méthode
<code class="docutils literal notranslate"><span class="pre">BusinessService.doSomething()</span></code> est trop longue, nous verrons sur la sortie
standard :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>réalise un traitement important pour l&#39;application
Attention l&#39;appel à execution(BusinessService.doSomething()) à durée 16ms soit 11ms de plus qu&#39;attendu
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="spring_mvc_intro.html" class="btn btn-neutral float-right" title="Introduction à Spring Web MVC" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spel.html" class="btn btn-neutral float-left" title="Le langage d’expression SpEL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  <div  role="contentinfo">
    <p>
    Par David Gayerie
    - <script>!function(){function e(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})}!function(e){document.write("<a href='mailto:"+e+"'>"+e+"</a>")}(e("qnivq@tnlrevr.qri"))}();</script>
    - <a class="reference external" href="https://gayerie.dev">https://gayerie.dev</a>
    </p>
    <p class="copyright">
      <a class="reference external image-reference" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" src="https://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a>
      Cette œuvre est mise à disposition selon les termes de la <a class="reference external" href="https://creativecommons.org/licenses/by-sa/3.0/fr/">Licence Creative Commons Attribution</a> -  Partage dans les Mêmes Conditions 3.0 France
    </p>
  </div>


</footer>

        </div>

      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99071053-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>