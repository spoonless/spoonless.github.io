

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  <meta content="David Gayerie" name="author" />
<meta content="Spring Framework - Le contexte d'application" name="description" />
<meta content="Java, Spring Framework, framework, Jakarta EE, Java EE, IoC, injection de dépendances" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  

  <title>Le contexte d’application &mdash; Spring Framework / Spring Boot</title>



  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://gayerie.dev/docs/spring/spring/application_context.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Déclaration par annotations" href="annotations.html" />
    <link rel="prev" title="L’inversion de contrôle" href="principe_ioc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Spring Framework / Spring Boot
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Spring Framework et Spring Boot</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#le-spring-framework-vs-j2ee">Le Spring Framework vs. J2EE</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-modules-spring-framework">Les modules Spring Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-projets-spring">Les projets Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="principe_ioc.html">L’inversion de contrôle</a><ul>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#l-injection-de-dependance">L’injection de dépendance</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#id2">L’inversion de contrôle</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#notion-de-conteneur-ioc">Notion de conteneur IoC</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Le contexte d’application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mise-en-place-du-projet">Mise en place du projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#une-premiere-application-avec-spring">Une première application avec Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notion-de-portee-scope">Notion de portée (scope)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#l-injection-de-bean">L’injection de bean</a></li>
<li class="toctree-l2"><a class="reference internal" href="#les-methodes-d-initialisation-et-de-destruction">Les méthodes d’initialisation et de destruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="annotations.html">Déclaration par annotations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#l-annotation-autowired">L’annotation &#64;Autowired</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#desambiguisation-avec-primary-et-qualifier">Désambiguïsation avec &#64;Primary et &#64;Qualifier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-primary">L’annotation &#64;Primary</a></li>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-qualifier">L’annotation &#64;Qualifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#l-annotation-value">L’annotation &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#les-annotations-jsr-250">Les annotations JSR-250</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#detection-automatique-des-composants-component-scan">Détection automatique des composants (<em>component scan</em>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#notion-de-composant">Notion de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#stereotype-de-composant">Stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#le-stereotype-configuration">Le stéréotype &#64;Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#creation-de-stereotype-de-composant">Création de stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#notions-avancees-pour-la-gestion-des-dependances">Notions avancées pour la gestion des dépendances</a><ul>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-order">L’annotation &#64;Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-dependson">L’annotation &#64;DependsOn</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#support-des-annotations-standard-jsr-330">Support des annotations standard JSR-330</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_context_conf.html">Configuration d’une application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#lancer-une-application-spring-boot">Lancer une application Spring Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#spring-boot-et-le-fichier-application-properties">Spring Boot et le fichier application.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#injection-des-proprietes-avec-value">Injection des propriétés avec &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#ajout-de-fichiers-de-proprietes-avec-propertysource">Ajout de fichiers de propriétés avec &#64;PropertySource</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#les-variables-d-environnement">Les variables d’environnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#la-classe-environment">La classe Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#beans-de-proprietes-avec-configurationproperties-spring-boot">Beans de propriétés avec &#64;ConfigurationProperties (Spring Boot)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="application_context_conf.html#introduction-a-bean-validation">Introduction à Bean Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#pour-en-savoir-plus">Pour en savoir plus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spel.html">Le langage d’expression SpEL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spel.html#un-exemple-d-utilisation-de-spel">Un exemple d’utilisation de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#principe-de-spel">Principe de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-ternaire">L’opérateur ternaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-elvis">L’opérateur Elvis</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-de-surete">L’opérateur de sûreté</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#la-projection">La projection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aop.html">Spring AOP : programmation orientée aspect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aop.html#principe-de-la-programmation-orientee-aspect">Principe de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#terminologie-de-la-programmation-orientee-aspect">Terminologie de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#integration-du-module-spring-aop">Intégration du module Spring AOP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aop.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="aop.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#exemple-de-programmation-orientee-aspect-avec-spring-aop">Exemple de programmation orientée aspect avec Spring AOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#la-programmation-orientee-aspect-pour-gerer-les-annotations">La programmation orientée Aspect pour gérer les annotations</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring Web MVC</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_intro.html">Introduction à Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#le-modele-mvc">Le modèle MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#integration-de-spring-web-mvc">Intégration de Spring Web MVC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-avec-spring-boot">Intégration dans une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#l-encodage-des-parametres-de-requetes">L’encodage des paramètres de requêtes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc.html">Les applications Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-controleurs">Les contrôleurs</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-vues-jsp">Les vues JSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-vues-jsp">Utilisation des vues JSP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#les-vues-thymeleaf">Les vues Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id1">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id2">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-vues-thymeleaf">Utilisation des vues Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#le-modele">Le modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#une-application-multi-couches-n-tiers">Une application multi-couches (N-Tiers)</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#la-signature-des-methodes-de-controleur">La signature des méthodes de contrôleur</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#les-parametres">Les paramètres</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#la-valeur-de-retour">La valeur de retour</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#taglib-jsp-et-gestion-des-formulaires">Taglib JSP et gestion des formulaires</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#spring-s-jsp-taglib">Spring’s JSP taglib</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#form-taglib">Form taglib</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#gestion-des-formulaires-avec-thymeleaf">Gestion des formulaires avec Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#externalisation-des-messages">Externalisation des messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id4">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#id5">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-messages-dans-une-jsp">Utilisation des messages dans une JSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#utilisation-des-messages-avec-thymeleaf">Utilisation des messages avec Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#validation-des-parametres-d-une-requete">Validation des paramètres d’une requête</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#la-notion-de-binding-et-le-bindingresult">La notion de <em>binding</em> et le BindingResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#validation-dans-la-methode-du-controleur">Validation dans la méthode du contrôleur</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#creation-d-un-validateur">Création d’un validateur</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#validation-declarative-avec-bean-validation">Validation déclarative avec Bean Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc.html#affichage-des-erreurs-de-validation">Affichage des erreurs de validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#post-redirect-get">POST-redirect-GET</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#la-gestion-des-exceptions">La gestion des exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#methodes-de-modele">Méthodes de modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#methodes-de-binder">Méthodes de binder</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc.html#controlleradvice">ControllerAdvice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_apiweb.html">Les API Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#support-pour-les-formats-json-et-xml">Support pour les formats JSON et XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-annotation-restcontroller">L’annotation &#64;RestController</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#un-controleur-pour-une-api-web">Un contrôleur pour une API Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-negociation-de-contenu">La négociation de contenu</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-envoi-de-donnees">L’envoi de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-reponse">La réponse</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#restcontrolleradvice">RestControllerAdvice</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#les-annotations-jackson">Les annotations Jackson</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_apiweb.html#les-vues-json">Les vues JSON</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#implementation-d-un-client">Implémentation d’un client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="thymeleaf.html">Introduction à Thymeleaf</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#integration-de-thymeleaf">Intégration de Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-attributs-thymeleaf">Les attributs Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-evaluation">${…} : l’expression d’évaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-selection">*{…} : l’expression de sélection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-message">#{…} : l’expression de message</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-url">&#64;{…} : l’expression d’URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#prevention-de-l-injection">Prévention de l’injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-conditions-et-les-boucles">Les conditions et les boucles</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#operateur-de-surete">Opérateur de sûreté</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#le-formatage-des-donnees">Le formatage des données</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring et l'accès aux bases de données</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spring_dao.html">Spring DAO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#l-annotation-repository">L’annotation &#64;Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#integration-de-jpa">Intégration de JPA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#acces-aux-donnees-avec-jdbc">Accès aux données avec JDBC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id1">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id2">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#uniformite-de-la-hierarchie-des-exceptions">Uniformité de la hiérarchie des exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_data_jpa.html">Spring Data avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#notion-de-repository">Notion de repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#spring-data-jpa">Spring Data JPA</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#integration-des-repositories">Intégration des repositories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#injection-des-repositories">Injection des <em>repositories</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#ajout-de-methodes-dans-une-interface-de-repository">Ajout de méthodes dans une interface de repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#requetes-nommees-jpa">Requêtes nommées JPA</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#utilisation-de-query">Utilisation de &#64;Query</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#declaration-de-requetes-de-modification">Déclaration de requêtes de modification</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#implementation-des-methodes-de-repository">Implémentation des méthodes de <em>repository</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_tx.html">Spring Transaction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#la-transaction">La transaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#transaction-et-couche-de-service">Transaction et couche de service</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#l-annotation-transactional">L’annotation &#64;Transactional</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#gestion-declarative-du-rollback">Gestion déclarative du <em>rollback</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-avancee-pour-les-transactions">Configuration avancée pour les transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#la-propagation">La propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#l-isolation">L’isolation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-des-transactions-sans-spring-boot">Configuration des transactions sans Spring Boot</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spring Framework / Spring Boot</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="banner">D'autres formations sont sur <a href="https://gayerie.dev">https://gayerie.dev</a></div>

        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Le contexte d’application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="annotations.html" class="btn btn-neutral float-right" title="Déclaration par annotations" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="principe_ioc.html" class="btn btn-neutral float-left" title="L’inversion de contrôle" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="le-contexte-d-application">
<h1>Le contexte d’application<a class="headerlink" href="#le-contexte-d-application" title="Lien permanent vers ce titre">¶</a></h1>
<p>Nous avons vu au chapitre précédent que le Spring framework fournit un conteneur
IoC. Ce conteneur est formé à partir de un ou plusieurs contextes d’application.
Un contexte d’application contient la définition des objets que le conteneur doit
créer ainsi que leurs interdépendances.</p>
<p>L’API du Spring Framework définit l’interface <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html">ApplicationContext</a>. Il existe
plusieurs implémentations de cette interface et donc plusieurs façons de définir
un contexte d’application. À l’origine, un contexte d’application devait être
décrit à l’aide d’un fichier XML. Avec l’évolution des technologies, le Spring
Framework s’est enrichi de nouvelles classes implémentant l’interface
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html">ApplicationContext</a> afin d’offrir des méthodes alternatives à la création d’un
contexte d’application. La méthode la plus souvent recommandée consiste à ajouter
des annotations sur les classes de notre application pour indiquer au Spring
Framework comment le conteneur IoC doit être initialisé. Pour cela, nous devons
utiliser une instance de la classe <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html">AnnotationConfigApplicationContext</a>.</p>
<div class="section" id="mise-en-place-du-projet">
<h2>Mise en place du projet<a class="headerlink" href="#mise-en-place-du-projet" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour ce chapitre, vous pouvez générer votre projet à partir du site
<a class="reference external" href="https://start.spring.io/">https://start.spring.io/</a> sans ajouter de dépendance particulière.</p>
<p>Vous pouvez également télécharger le modèle de projet Maven
<a class="reference download internal" download="" href="../_downloads/3ebf0715783a8d88f16aed0fe67ed66f/firstapp.zip"><code class="xref download docutils literal notranslate"><span class="pre">firstapp.zip</span></code></a>.</p>
<p>Après avoir décompresser l’archive sur votre disque, vous pouvez importer votre
projet sous Eclipse en choisissant dans le menu <span class="guilabel">File &gt; Import…</span>.
Puis choisissez comme type d’import : <span class="guilabel">Maven &gt; Existing Maven Projects</span>.</p>
<div class="figure align-default" id="id1">
<img alt="../_images/eclipse_import_maven_project.png" src="../_images/eclipse_import_maven_project.png" />
<p class="caption"><span class="caption-text">Fenêtre d’import de projet dans Eclipse</span><a class="headerlink" href="#id1" title="Lien permanent vers cette image">¶</a></p>
</div>
<p>Une nouvelle fenêtre s’ouvre pour vous demander d’indiquer le répertoire dans
lequel se trouve le fichier <code class="file docutils literal notranslate"><span class="pre">pom.xml</span></code> de votre projet. Cliquez sur le bouton
<span class="guilabel">Browse…</span> pour sélectionner ce répertoire. Eclipse doit remplir le
reste de la fenêtre avec les informations sur votre projet. Il ne vous reste
plus qu’à cliquer sur le bouton <span class="guilabel">Finish</span>.</p>
<div class="figure align-default" id="id2">
<img alt="../_images/eclipse_import_maven_project2.png" src="../_images/eclipse_import_maven_project2.png" />
<p class="caption"><span class="caption-text">Fenêtre d’import du projet Maven dans Eclipse</span><a class="headerlink" href="#id2" title="Lien permanent vers cette image">¶</a></p>
</div>
</div>
<div class="section" id="une-premiere-application-avec-spring">
<h2>Une première application avec Spring<a class="headerlink" href="#une-premiere-application-avec-spring" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour illustrer la création d’un contexte d’application, nous allons commencer
par un exemple très simple. Imaginons que nous souhaitions afficher
l’heure courante sur la sortie standard. Bien évidemment, une application Java
aussi simple n’a pas besoin d’un quelconque <em>framework</em>. Mais imaginons que
nous souhaitions tout de même utiliser le Spring Framework. Il nous faut créer
un contexte d’application et demander à Spring d’ajouter une objet de type
<a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/LocalTime.html">LocalTime</a> dans ce contexte. Puis nous pourrons extraire cet objet du conteneur
pour l’afficher à l’écran.</p>
<p>Voici à quoi ressemble le programme correspondant :</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.firstapp</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalTime</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimeApplication</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">maintenant</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span><span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span>
                 <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TimeApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">LocalTime</span> <span class="n">time</span> <span class="o">=</span> <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;maintenant&quot;</span><span class="p">,</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>On crée une méthode <code class="docutils literal notranslate"><span class="pre">main</span></code> à la ligne 15 comme point d’entrée de notre application.
Aux lignes 16-17, on crée une instance de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/AnnotationConfigApplicationContext.html">AnnotationConfigApplicationContext</a> qui
est le contexte Spring de notre application. Notez que la création attend en
paramètre la classe à utiliser pour définir le contexte. Dans notre exemple,
il s’agit directement de la classe <code class="docutils literal notranslate"><span class="pre">TimeApplication</span></code>. Notez également que l’on
crée l’instance du contexte d’application dans un structure de type
<em>try-with-resources</em>. Cela nous garantit que la méthode <code class="docutils literal notranslate"><span class="pre">close()</span></code> du contexte
d’application sera appelée à la fin du bloc et donc avant la fin de l’application.
Nous reviendrons sur le fait qu’un contexte d’application doit être correctement
fermé afin de lui laisser la possibilité de gérer correctement le cycle de vie
des objets qu’il contient.</p>
<p>La création du contexte d’application implique que Spring va créer une instance
de la classe <code class="docutils literal notranslate"><span class="pre">TimeApplication</span></code> passée en paramètre du constructeur. Il va
ensuite chercher des annotations particulières sur cet objet. Par exemple, il va
chercher toutes les méthodes déclarées avec l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a>. Ces méthodes
sont traitées comme des méthodes de fabrique (<em>factory methods</em>). Pour Spring,
elles servent à créer des objets qui doivent être gérés par le contexte
d’application. Le <em>framework</em> va donc appeler ces méthodes une à une et récupérer
les objets qu’elles retournent en leur donnant un nom correspondant au nom de la
méthode.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>La terme de <em>bean</em> renvoie aux JavaBeans qui désignent les composants
élémentaires en Java. <em>Bean</em> est à la fois une métaphore et un trait d’humour.
En effet, le langage Java tient son nom de la référence au café (en provenance
de l’île de Java) que les concepteurs du langage ont bu en grande quantité
durant sa création. Pour faire du bon café, il faut du bon grain. Donc, les
composants principaux des programmes Java doivent naturellement être des
grains (<em>beans</em> en anglais) de café.</p>
<p>Si le standard JavaBeans imposait de respecter certaines convention de codage,
le terme de <em>bean</em> s’est peu à peu généralisé pour devenir synonyme d’objet.
C’est dans ce sens très général qu’il est utilisé avec le Spring Framework :
un <em>bean</em> est un objet.</p>
<p>Dans ce chapitre et les suivants, nous utiliserons le terme <em>bean</em> pour
désigner un objet Java qui est ajouté dans le contexte d’application et
qui est donc géré par le conteneur IoC du Spring Framework.</p>
</div>
<p>Dans notre exemple, la méthode <code class="docutils literal notranslate"><span class="pre">maintenant()</span></code> possède l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a>
(lignes 10 à 13). Elle sera donc appelée par Spring et l’objet de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/LocalTime.html">LocalTime</a>
qu’elle retourne sera placé dans le contexte d’application avec le nom <code class="docutils literal notranslate"><span class="pre">maintenant</span></code>.</p>
<p>À la ligne 18, nous utilisons la méthode <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/BeanFactory.html#getBean-java.lang.String-java.lang.Class-">getBean</a> du contexte d’application pour
récupérer un objet de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/LocalTime.html">LocalTime</a> et qui s’appelle <code class="docutils literal notranslate"><span class="pre">maintenant</span></code> pour
pouvoir l’afficher.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>S’il n’existe qu’un seul objet dans le contexte d’application qui est
compatible avec le type demandé, alors il n’est pas nécessaire de spécifier
le nom de l’objet :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">LocalTime</span> <span class="n">time</span> <span class="o">=</span> <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">LocalTime</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
</pre></div>
</div>
<p>Si vous ne souhaitez pas utiliser le nom de la méthode comme nom pour l’objet,
vous pouvez déclarer le nom de l’objet avec l’attribut <code class="docutils literal notranslate"><span class="pre">name</span></code> de l’annotation
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a> :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;maintenant&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">getLocalTime</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous pouvez même donner plusieurs noms à un objet en passant un tableau de
valeurs à l’attribut <code class="docutils literal notranslate"><span class="pre">name</span></code> :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;maintenant&quot;</span><span class="p">,</span> <span class="s">&quot;now&quot;</span><span class="p">,</span> <span class="s">&quot;ahora&quot;</span><span class="p">,</span> <span class="s">&quot;jetzt&quot;</span><span class="p">})</span>
<span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">getLocalTime</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="notion-de-portee-scope">
<h2>Notion de portée (scope)<a class="headerlink" href="#notion-de-portee-scope" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les <em>beans</em> ajoutés dans un contexte d’application ont une portée (<em>scope</em>).
Par défaut, Spring définit deux portées :</p>
<dl class="simple">
<dt><em>singleton</em></dt><dd><p>Cette portée évoque le modèle de conception <a class="reference external" href="https://fr.wikipedia.org/wiki/Singleton_(patron_de_conception)">singleton</a>. Cela signifie qu’une seule
instance de ce <em>bean</em> existe dans le conteneur IoC. Autrement dit, si un programme
appelle une méthode <code class="docutils literal notranslate"><span class="pre">getBean</span></code> pour récupérer ce <em>bean</em>, chaque appel retourne
le <strong>même</strong> objet.</p>
</dd>
<dt><em>prototype</em></dt><dd><p>Cette portée est l’inverse de la portée singleton. À chaque fois qu’un programme
appelle une méthode <code class="docutils literal notranslate"><span class="pre">getBean</span></code> pour récupérer ce <em>bean</em>, chaque appel retourne
une <strong>nouvelle instance</strong> du <em>bean</em>.</p>
</dd>
</dl>
<p>Le type de la portée peut être indiquée grâce à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Scope.html">&#64;Scope</a>. La portée
par défaut dans le Spring Framework est <strong>singleton</strong>.</p>
<p>Si nous reprenons notre programme précédent, nous pourrions le faire évoluer pour
afficher le temps toutes les secondes.</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.firstapp</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalTime</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimeApplication</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">maintenant</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span><span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span>
                 <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TimeApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="n">LocalTime</span> <span class="n">time</span> <span class="o">=</span> <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;maintenant&quot;</span><span class="p">,</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Le programme précédent ne s’arrête jamais de lui-même puisqu’il contient une
boucle infinie. À chaque itération, on attend 1000 millisecondes pour ensuite
demander le <em>bean</em> au contexte d’application pour l’afficher. Si vous lancez
ce programme, vous constaterez qu’il affiche à l’infini la même heure correspondant
au lancement du programme. En effet, la portée d’un <em>bean</em> par défaut est
<code class="docutils literal notranslate"><span class="pre">singleton</span></code>. Cela signifie que l’objet est instancié à la création du contexte
d’application et qu’il n’existera qu’une fois.</p>
<p>Nous pouvons utiliser l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Scope.html">&#64;Scope</a> pour modifier ce comportement
et spécifier une portée <code class="docutils literal notranslate"><span class="pre">prototype</span></code> :</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.firstapp</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalTime</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Scope</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimeApplication</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="nd">@Scope</span><span class="p">(</span><span class="s">&quot;prototype&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">LocalTime</span> <span class="nf">maintenant</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span><span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span>
                 <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TimeApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="n">LocalTime</span> <span class="n">time</span> <span class="o">=</span> <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;maintenant&quot;</span><span class="p">,</span> <span class="n">LocalTime</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Le programme se comporte bien comme attendu et le temps s’écoule lorsqu’on
affiche l’heure sur la console. Prototype signifie que l’objet créé n’est pas
l’objet définitif et qu’il doit être recréé à chaque fois qu’il est demandé
au contexte d’application. Dans notre exemple, Spring rappelle continuellement
notre méthode <code class="docutils literal notranslate"><span class="pre">maintenant()</span></code> à chaque fois que le programme récupère une
instance de l’objet en appelant <code class="docutils literal notranslate"><span class="pre">getBean()</span></code>.</p>
<p>Il peut sembler étonnant que la portée par défaut soit <code class="docutils literal notranslate"><span class="pre">singleton</span></code>. En fait,
nous verrons que le Spring Framework est quasi exclusivement utilisé pour
construire l’ossature d’une application. Il s’agit alors de créer des objets qui
n’ont besoin d’être présents qu’une seule fois en mémoire.</p>
<div class="admonition caution">
<p class="admonition-title">Prudence</p>
<p>Il faut garder à l’esprit que, par défaut, la portée des objets créés par
le Spring Framework est <code class="docutils literal notranslate"><span class="pre">singleton</span></code>. Donc l’implémentation de ces objets
doit être <em>thread safe</em>. En effet, si notre application s’exécute dans un
environnement concurrent (comme une application Web), le même objet est
susceptible d’être appelé simultanément par plusieurs flux de traitement
(<em>threads</em>).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dans certains contextes d’exécution, il existe d’autres portées disponibles.
Par exemple, pour une application Web, vous pouvez définir des <em>beans</em> avec
une portée <code class="docutils literal notranslate"><span class="pre">request</span></code> pour indiquer que la durée de vie de ces objets ne
doit pas aller au delà du traitement de la requête courante. Dans le même
contexte, vous pouvez définir des <em>beans</em> avec une portée <code class="docutils literal notranslate"><span class="pre">session</span></code> pour
indiquer qu’ils devront être uniques par session utilisateur sur le serveur.</p>
</div>
</div>
<div class="section" id="l-injection-de-bean">
<h2>L’injection de bean<a class="headerlink" href="#l-injection-de-bean" title="Lien permanent vers ce titre">¶</a></h2>
<p>En plus de pouvoir enregistrer les <em>beans</em> que nous créons dans un contexte
d’application, nous pouvons utiliser le Spring Framework pour nous aider à
initialiser les dépendances entre les objets.</p>
<p>Pour illustrer ce fonctionnement, nous allons prendre un exemple d’application
un peu plus proche de ce que nous pourrions trouver dans la réalité tout en
gardant volontairement un code simple.</p>
<p>Imaginons que nous souhaitions créer une application pour réaliser des traitements
sur des chaînes de caractères. Notre application sera constituée de deux catégories
d’objets : d’une part un service qui doit réaliser le traitement demandé et
d’autres part un fournisseur de données chargé de produire la chaîne de caractères
utilisée par le service. Afin de garantir un découplage maximum, nous allons
matérialiser les rôles par des interfaces. Nous pourrions créer nos propres
interfaces mais l’API standard Java nous fournit déjà celles dont nous avons
besoin. Le service de traitement implémentera l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a> et le
fournisseur de données implémentera l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/function/Supplier.html">Supplier&lt;String&gt;</a>.</p>
<p>Comme exemple de service de traitement, nous utiliserons une classe qui se contente
d’afficher la donnée produite par le fournisseur :</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Une implémentation de service de traitement</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WriterService</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">WriterService</span><span class="p">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">supplier</span> <span class="o">=</span> <span class="n">supplier</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">supplier</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Comme exemple de fournisseur de données, nous utiliserons une classe qui produit
une chaîne de caractères en dur :</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Une implémentation de fournisseur de données</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HardcodedSupplier</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello world&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Pour réaliser notre application avec le Spring Framework, il faut ajouter une instance
de ces objets dans le contexte d’application. Mais pour créer une instance de
<code class="docutils literal notranslate"><span class="pre">WriterService</span></code>, nous avons besoin d’un objet de type <code class="docutils literal notranslate"><span class="pre">Supplier&lt;String&gt;</span></code>.
Nous pouvons demander au Spring Framework de nous en fournir un disponible dans
le contexte d’application en l’ajoutant comme paramètre de la méthode de fabrique :</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">L’application construite avec Spring</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskApplication</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">dataSupplier</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HardcodedSupplier</span><span class="p">();</span>
  <span class="p">}</span>

<span class="hll">  <span class="nd">@Bean</span>
</span><span class="hll">  <span class="kd">public</span> <span class="n">Runnable</span> <span class="nf">task</span><span class="p">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dataSupplier</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">new</span> <span class="n">WriterService</span><span class="p">(</span><span class="n">dataSupplier</span><span class="p">);</span>
</span><span class="hll">  <span class="p">}</span>
</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span>
                  <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TaskApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">Runnable</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">main</span></code> de l’application crée un contexte d’application à partir de
la classe courante et recherche le <em>bean</em> du contexte qui est compatible avec
l’interface <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Runnable.html">Runnable</a> pour pouvoir lancer sa méthode <code class="docutils literal notranslate"><span class="pre">run</span></code>.</p>
<p>La partie la plus importante de notre exemple est l’implémentation de la méthode
<code class="docutils literal notranslate"><span class="pre">task</span></code>. Elle est annotée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a> pour indiquer à Spring qu’il s’agit
d’une méthode qui fabrique un <em>bean</em>. Mais surtout, elle attend en paramètre
un objet de type <code class="docutils literal notranslate"><span class="pre">Supplier&lt;String&gt;</span></code>. Pour réaliser cet appel, le Spring Framework
va devoir trouver dans le contexte d’application un (et un seul) <em>bean</em> qui est
compatible avec ce type. Il va trouver celui fournit par la méthode <code class="docutils literal notranslate"><span class="pre">dataSupplier</span></code>
et le passer en paramètre.</p>
<p>Même si notre exemple reste trivial, nous pouvons utiliser un mécanisme d’injection
de dépendance tout en garantissant un niveau d’abstraction important entre les
différents objets de notre application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Le Spring Framework est capable de déduire l’ordre d’appel des différentes
méthodes de fabrique selon les dépendances requises. Dans notre exemple,
Spring doit nécessairement appeler la méthode <code class="docutils literal notranslate"><span class="pre">dataSupplier</span></code> avant la
méthode <code class="docutils literal notranslate"><span class="pre">task</span></code> pour disposer d’une instance de <code class="docutils literal notranslate"><span class="pre">Supplier&lt;String&gt;</span></code>.
L’ordre de déclaration des méthodes dans la classe n’a aucune importance.
Spring est capable de déterminer l’ordre correct des appels en analysant le
graphe des dépendances. Attention cependant à ne pas créer une dépendance
cyclique (a dépend de b et b dépend de a). On comprend bien que ce type de
situation ne peut pas être résolu par le Spring Framework et aboutira à une
erreur à la création du conteneur IoC.</p>
</div>
<p>L’exécution du programme précédent affiche (entre quelques lignes de log du Spring
Framework) :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Hello world
</pre></div>
</div>
</div>
<div class="section" id="les-methodes-d-initialisation-et-de-destruction">
<span id="init-destroy-methods"></span><h2>Les méthodes d’initialisation et de destruction<a class="headerlink" href="#les-methodes-d-initialisation-et-de-destruction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le conteneur IoC du Spring Framework permet de gérer le cycle de vie des
<em>beans</em>. Il permet notamment d’invoquer des méthodes d’initialisation et de
destruction de ces <em>beans</em>. Par exemple, un objet peut initialiser une connexion
à une base de données au lancement de l’application et libérer cette connexion
à la fin de l’application. La gestion des ressources est un cas courant pour
lequel nous pouvons avoir besoin de réaliser une phase d’initialisation et/ou
de destruction.</p>
<p>Il est possible de préciser sur l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a> le nom de la méthode
d’initialisation avec l’attribut <code class="docutils literal notranslate"><span class="pre">initMethod</span></code> et le nom de la méthode de
destruction avec l’attribut <code class="docutils literal notranslate"><span class="pre">destroyMethod</span></code>.</p>
<p>Nous pouvons compléter notre exemple avec une nouvelle implémentation d’un
fournisseur de données :</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Fournisseur de données à partir d’un fichier</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Files</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Path</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileDataSupplier</span> <span class="kd">implements</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">data</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">readData</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Files</span><span class="p">.</span><span class="na">readString</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Cette implémentation nécessite l’appel à la méthode <code class="docutils literal notranslate"><span class="pre">readData</span></code> pour lire la
chaîne de caractères à partir du fichier <code class="file docutils literal notranslate"><span class="pre">data.txt</span></code>.</p>
<p>Dans notre classe représentant notre application, nous pouvons remplacer la
méthode de fabrique :</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">L’application construite avec Spring</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskApplication</span> <span class="p">{</span>

<span class="hll">  <span class="nd">@Bean</span><span class="p">(</span><span class="n">initMethod</span> <span class="o">=</span> <span class="s">&quot;readData&quot;</span><span class="p">)</span>
</span><span class="hll">  <span class="kd">public</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">dataSupplier</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">new</span> <span class="n">FileDataSupplier</span><span class="p">();</span>
</span><span class="hll">  <span class="p">}</span>
</span>
  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">Runnable</span> <span class="nf">task</span><span class="p">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dataSupplier</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">WriterService</span><span class="p">(</span><span class="n">dataSupplier</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span>
                  <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TaskApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">appCtx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">Runnable</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">run</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>À la ligne 10, nous indiquons que le <em>bean</em> possède une méthode d’initialisation
qui sera automatiquement appelée par le <em>framework</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pourquoi ne pas appeler directement la méthode <code class="docutils literal notranslate"><span class="pre">readData</span></code> dans la méthode
de fabrique ?</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">dataSupplier</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">FileDataSupplier</span> <span class="n">supplier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileDataSupplier</span><span class="p">();</span>
  <span class="n">supplier</span><span class="p">.</span><span class="na">readData</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">supplier</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pour notre exemple, cette implémentation est équivalente. Cependant, nous
verrons au chapitre suivant qu’il est possible de réaliser automatiquement
des injections de dépendances sur le <em>bean</em> retourné par la méthode de fabrique.
Dans ce cas, l’appel à la méthode d’initialisation est effectué <strong>après</strong>
la phase d’injection afin de permettre à l’objet de s’initialiser avec toutes
ses dépendances disponibles.</p>
</div>
<p>Pour illustrer l’utilisation d’une méthode de destruction, nous allons complexifier
un peu notre application. L’API Java permet l’exécution de tâches concurrentes
en utilisant un <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/Executor.html">Executor</a>. La classe <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/Executors.html">Executors</a> est une classe outil qui nous
permet de créer un exécuteur <em>multi-thread</em>. Cependant, il est nécessaire d’appeler
la méthode <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ExecutorService.html#shutdown()">shutdown</a> de cet exécuteur pour attendre la fin des traitements
concurrents et libérer correctement les ressources. La méthode <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ExecutorService.html#shutdown()">shutdown</a>
correspond bien à une méthode de destruction à appeler sur l’exécuteur.</p>
<p>Voici la nouvelle implémentation :</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">L’application construite avec Spring</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.appstring</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Supplier</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TaskApplication</span> <span class="p">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">dataSupplier</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HardcodedSupplier</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nd">@Bean</span><span class="p">(</span><span class="n">initMethod</span> <span class="o">=</span> <span class="s">&quot;readData&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">fileDataSupplier</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">FileDataSupplier</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="nf">tasks</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">dataSuppliers</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span> <span class="p">:</span> <span class="n">dataSuppliers</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">tasks</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">WriterService</span><span class="p">(</span><span class="n">supplier</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">tasks</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Bean</span><span class="p">(</span><span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">&quot;shutdown&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">Executor</span> <span class="nf">executor</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">tasks</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Executor</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="p">.</span><span class="na">newCachedThreadPool</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Runnable</span> <span class="n">task</span> <span class="p">:</span> <span class="n">tasks</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">executor</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">task</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">executor</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">AnnotationConfigApplicationContext</span> <span class="n">appCtx</span> <span class="o">=</span>
                  <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">TaskApplication</span><span class="p">.</span><span class="na">class</span><span class="p">))</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Aux lignes 33 à 40, nous déclarons une méthode de fabrique qui retourne un <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/Executor.html">Executor</a>.
On déclare grâce à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">&#64;Bean</a> qu’il existe une méthode de destruction
appelée <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ExecutorService.html#shutdown()">shutdown</a>. La méthode de fabrique crée l’exécuteur et ajoute la liste
des tâches reçues en paramètre. Cette liste de tâches est maintenant produite
par la méthode <code class="docutils literal notranslate"><span class="pre">tasks</span></code>. Notez que cette méthode accepte en paramètre une liste
de <code class="docutils literal notranslate"><span class="pre">Supplier&lt;String&gt;</span></code>. Spring comprend qu’il s’agit de la liste de tous les objets
compatibles avec l’interface <code class="docutils literal notranslate"><span class="pre">Supplier&lt;String&gt;</span></code> présents dans le contexte
d’application, c’est-à-dire l’objet retourné par l’appel à <code class="docutils literal notranslate"><span class="pre">dataSupplier</span></code> et
l’objet retourné par l’appel à <code class="docutils literal notranslate"><span class="pre">fileDataSupplier</span></code>.</p>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">main</span></code> se contente de créer un contexte d’application puis de le
fermer à la fin du bloc <code class="docutils literal notranslate"><span class="pre">try</span></code>. La fermeture du contexte d’application déclenche
l’appel à la méthode <code class="docutils literal notranslate"><span class="pre">shutdown</span></code> sur l’exécuteur. Ainsi la fermeture du contexte
d’application est suspendue le temps que toutes les tâches concurrentes s’achèvent.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pour plus d’information, reportez-vous à la <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java">documentation officielle</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="annotations.html" class="btn btn-neutral float-right" title="Déclaration par annotations" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="principe_ioc.html" class="btn btn-neutral float-left" title="L’inversion de contrôle" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  <div  role="contentinfo">
    <p>
    Par David Gayerie
    - <script>!function(){function e(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})}!function(e){document.write("<a href='mailto:"+e+"'>"+e+"</a>")}(e("qnivq@tnlrevr.qri"))}();</script>
    - <a class="reference external" href="https://gayerie.dev">https://gayerie.dev</a>
    </p>
    <p class="copyright">
      <a class="reference external image-reference" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" src="https://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a>
      Cette œuvre est mise à disposition selon les termes de la <a class="reference external" href="https://creativecommons.org/licenses/by-sa/3.0/fr/">Licence Creative Commons Attribution</a> -  Partage dans les Mêmes Conditions 3.0 France
    </p>
  </div>


</footer>

        </div>

      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99071053-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>