

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  <meta content="David Gayerie" name="author" />
<meta content="Spring Framework - Développement d'applications Web avec Spring Web MVC" name="description" />
<meta content="Java, Spring Framework, Spring MVC, Spring Web MVC, MVC, Web, HTML, Thymeleaf" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  

  <title>Les applications Web avec Spring Web MVC &mdash; Spring Framework / Spring Boot</title>



  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://gayerie.dev/docs/spring/spring/spring_mvc.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Les API Web avec Spring Web MVC" href="spring_mvc_apiweb.html" />
    <link rel="prev" title="Introduction à Spring Web MVC" href="spring_mvc_intro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Spring Framework / Spring Boot
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Spring Framework et Spring Boot</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#le-spring-framework-vs-j2ee">Le Spring Framework vs. J2EE</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-modules-spring-framework">Les modules Spring Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#les-projets-spring">Les projets Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="principe_ioc.html">L’inversion de contrôle</a><ul>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#l-injection-de-dependance">L’injection de dépendance</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#id2">L’inversion de contrôle</a></li>
<li class="toctree-l2"><a class="reference internal" href="principe_ioc.html#notion-de-conteneur-ioc">Notion de conteneur IoC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_context.html">Le contexte d’application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#mise-en-place-du-projet">Mise en place du projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#une-premiere-application-avec-spring">Une première application avec Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#notion-de-portee-scope">Notion de portée (scope)</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#l-injection-de-bean">L’injection de bean</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context.html#les-methodes-d-initialisation-et-de-destruction">Les méthodes d’initialisation et de destruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="annotations.html">Déclaration par annotations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#l-annotation-autowired">L’annotation &#64;Autowired</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#desambiguisation-avec-primary-et-qualifier">Désambiguïsation avec &#64;Primary et &#64;Qualifier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-primary">L’annotation &#64;Primary</a></li>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-qualifier">L’annotation &#64;Qualifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#l-annotation-value">L’annotation &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#les-annotations-jsr-250">Les annotations JSR-250</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#detection-automatique-des-composants-component-scan">Détection automatique des composants (<em>component scan</em>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#notion-de-composant">Notion de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#stereotype-de-composant">Stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#le-stereotype-configuration">Le stéréotype &#64;Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#creation-de-stereotype-de-composant">Création de stéréotype de composant</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#notions-avancees-pour-la-gestion-des-dependances">Notions avancées pour la gestion des dépendances</a><ul>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-order">L’annotation &#64;Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="annotations.html#l-annotation-dependson">L’annotation &#64;DependsOn</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html#support-des-annotations-standard-jsr-330">Support des annotations standard JSR-330</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_context_conf.html">Configuration d’une application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#lancer-une-application-spring-boot">Lancer une application Spring Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#spring-boot-et-le-fichier-application-properties">Spring Boot et le fichier application.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#injection-des-proprietes-avec-value">Injection des propriétés avec &#64;Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#ajout-de-fichiers-de-proprietes-avec-propertysource">Ajout de fichiers de propriétés avec &#64;PropertySource</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#les-variables-d-environnement">Les variables d’environnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#la-classe-environment">La classe Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#beans-de-proprietes-avec-configurationproperties-spring-boot">Beans de propriétés avec &#64;ConfigurationProperties (Spring Boot)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="application_context_conf.html#introduction-a-bean-validation">Introduction à Bean Validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="application_context_conf.html#pour-en-savoir-plus">Pour en savoir plus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spel.html">Le langage d’expression SpEL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spel.html#un-exemple-d-utilisation-de-spel">Un exemple d’utilisation de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#principe-de-spel">Principe de SpEL</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-ternaire">L’opérateur ternaire</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-elvis">L’opérateur Elvis</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#l-operateur-de-surete">L’opérateur de sûreté</a></li>
<li class="toctree-l2"><a class="reference internal" href="spel.html#la-projection">La projection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aop.html">Spring AOP : programmation orientée aspect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aop.html#principe-de-la-programmation-orientee-aspect">Principe de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#terminologie-de-la-programmation-orientee-aspect">Terminologie de la programmation orientée aspect</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#integration-du-module-spring-aop">Intégration du module Spring AOP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aop.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="aop.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#exemple-de-programmation-orientee-aspect-avec-spring-aop">Exemple de programmation orientée aspect avec Spring AOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="aop.html#la-programmation-orientee-aspect-pour-gerer-les-annotations">La programmation orientée Aspect pour gérer les annotations</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring Web MVC</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_intro.html">Introduction à Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#le-modele-mvc">Le modèle MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#integration-de-spring-web-mvc">Intégration de Spring Web MVC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-avec-spring-boot">Intégration dans une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_intro.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_intro.html#l-encodage-des-parametres-de-requetes">L’encodage des paramètres de requêtes</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Les applications Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#les-controleurs">Les contrôleurs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#les-vues-jsp">Les vues JSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilisation-des-vues-jsp">Utilisation des vues JSP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#les-vues-thymeleaf">Les vues Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilisation-des-vues-thymeleaf">Utilisation des vues Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#le-modele">Le modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#une-application-multi-couches-n-tiers">Une application multi-couches (N-Tiers)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-signature-des-methodes-de-controleur">La signature des méthodes de contrôleur</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#les-parametres">Les paramètres</a></li>
<li class="toctree-l3"><a class="reference internal" href="#la-valeur-de-retour">La valeur de retour</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#taglib-jsp-et-gestion-des-formulaires">Taglib JSP et gestion des formulaires</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spring-s-jsp-taglib">Spring’s JSP taglib</a></li>
<li class="toctree-l3"><a class="reference internal" href="#form-taglib">Form taglib</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gestion-des-formulaires-avec-thymeleaf">Gestion des formulaires avec Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#externalisation-des-messages">Externalisation des messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Pour une application sans Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilisation-des-messages-dans-une-jsp">Utilisation des messages dans une JSP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilisation-des-messages-avec-thymeleaf">Utilisation des messages avec Thymeleaf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#validation-des-parametres-d-une-requete">Validation des paramètres d’une requête</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#la-notion-de-binding-et-le-bindingresult">La notion de <em>binding</em> et le BindingResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validation-dans-la-methode-du-controleur">Validation dans la méthode du contrôleur</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creation-d-un-validateur">Création d’un validateur</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validation-declarative-avec-bean-validation">Validation déclarative avec Bean Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#affichage-des-erreurs-de-validation">Affichage des erreurs de validation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#post-redirect-get">POST-redirect-GET</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-gestion-des-exceptions">La gestion des exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#methodes-de-modele">Méthodes de modèle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#methodes-de-binder">Méthodes de binder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#controlleradvice">ControllerAdvice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_mvc_apiweb.html">Les API Web avec Spring Web MVC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#support-pour-les-formats-json-et-xml">Support pour les formats JSON et XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-annotation-restcontroller">L’annotation &#64;RestController</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#un-controleur-pour-une-api-web">Un contrôleur pour une API Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-negociation-de-contenu">La négociation de contenu</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#l-envoi-de-donnees">L’envoi de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#la-reponse">La réponse</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#restcontrolleradvice">RestControllerAdvice</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#les-annotations-jackson">Les annotations Jackson</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_mvc_apiweb.html#les-vues-json">Les vues JSON</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_mvc_apiweb.html#implementation-d-un-client">Implémentation d’un client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="thymeleaf.html">Introduction à Thymeleaf</a><ul>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#integration-de-thymeleaf">Intégration de Thymeleaf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-avec-spring-boot">Pour une application avec Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="thymeleaf.html#pour-une-application-sans-spring-boot">Pour une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-attributs-thymeleaf">Les attributs Thymeleaf</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-evaluation">${…} : l’expression d’évaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-selection">*{…} : l’expression de sélection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-de-message">#{…} : l’expression de message</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#l-expression-d-url">&#64;{…} : l’expression d’URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#prevention-de-l-injection">Prévention de l’injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#les-conditions-et-les-boucles">Les conditions et les boucles</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#operateur-de-coalescence-des-nuls">Opérateur de coalescence des nuls</a></li>
<li class="toctree-l2"><a class="reference internal" href="thymeleaf.html#le-formatage-des-donnees">Le formatage des données</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Spring et l'accès aux bases de données</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spring_dao.html">Spring DAO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#l-annotation-repository">L’annotation &#64;Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#integration-de-jpa">Intégration de JPA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#acces-aux-donnees-avec-jdbc">Accès aux données avec JDBC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id1">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_dao.html#id2">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_dao.html#uniformite-de-la-hierarchie-des-exceptions">Uniformité de la hiérarchie des exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_data_jpa.html">Spring Data avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#notion-de-repository">Notion de repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#spring-data-jpa">Spring Data JPA</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#integration-des-repositories">Intégration des repositories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-spring-boot">Intégration dans une application Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#integration-dans-une-application-sans-spring-boot">Intégration dans une application sans Spring Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#injection-des-repositories">Injection des <em>repositories</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#ajout-de-methodes-dans-une-interface-de-repository">Ajout de méthodes dans une interface de repository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#requetes-nommees-jpa">Requêtes nommées JPA</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_data_jpa.html#utilisation-de-query">Utilisation de &#64;Query</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#declaration-de-requetes-de-modification">Déclaration de requêtes de modification</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_data_jpa.html#implementation-des-methodes-de-repository">Implémentation des méthodes de <em>repository</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spring_tx.html">Spring Transaction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#la-transaction">La transaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#spring-boot-et-la-configuration-automatique">Spring Boot et la configuration automatique</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#transaction-et-couche-de-service">Transaction et couche de service</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#l-annotation-transactional">L’annotation &#64;Transactional</a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#gestion-declarative-du-rollback">Gestion déclarative du <em>rollback</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-avancee-pour-les-transactions">Configuration avancée pour les transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#la-propagation">La propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spring_tx.html#l-isolation">L’isolation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring_tx.html#configuration-des-transactions-sans-spring-boot">Configuration des transactions sans Spring Boot</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Spring Framework / Spring Boot</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="banner">D'autres formations sont sur <a href="https://gayerie.dev">https://gayerie.dev</a></div>

        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Les applications Web avec Spring Web MVC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="spring_mvc_apiweb.html" class="btn btn-neutral float-right" title="Les API Web avec Spring Web MVC" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spring_mvc_intro.html" class="btn btn-neutral float-left" title="Introduction à Spring Web MVC" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="les-applications-web-avec-spring-web-mvc">
<h1>Les applications Web avec Spring Web MVC<a class="headerlink" href="#les-applications-web-avec-spring-web-mvc" title="Lien permanent vers ce titre">¶</a></h1>
<p>Le développement d’une application <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> implique l’implémentation
de classes représentant les contrôleurs. Dans le modèle MVC, un contrôleur gère
les interactions entre l’utilisateur et le système. Dans le cadre d’une
application Web, les interactions avec le serveur correspondent aux requêtes
HTTP émises par le navigateur client.</p>
<p>Les contrôleurs <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> sont dont là pour nous permettre de gérer
les requêtes HTTP entrantes tout en nous apportant des facilités de développement
pour le <em>binding</em> de données, la validation, la gestion du modèle…</p>
<div class="section" id="les-controleurs">
<h2>Les contrôleurs<a class="headerlink" href="#les-controleurs" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un contrôleur est une classe Java portant l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Controller.html">&#64;Controller</a>.
Pour que le contrôleur soit appelé lors du traitement d’une requête, il suffit
d’ajouter l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestMapping.html">&#64;RequestMapping</a> sur une méthode publique de la classe
en précisant la méthode HTTP concernée (par défaut GET) et le chemin d’URI (à
partir du contexte de déploiement de l’application) pris en charge par la méthode.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Un contrôleur</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getHome</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;index&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/item&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple ci-dessus, le contrôleur déclare la méthode <code class="docutils literal notranslate"><span class="pre">getHome</span></code> qui traite
les requêtes pour le chemin <code class="docutils literal notranslate"><span class="pre">/</span></code> et la méthode <code class="docutils literal notranslate"><span class="pre">addItem</span></code> qui traite les
requêtes pour le chemin <code class="docutils literal notranslate"><span class="pre">/item</span></code>. La première n’accepte que les requêtes de type
<code class="docutils literal notranslate"><span class="pre">GET</span></code> et la seconde que les requêtes de type <code class="docutils literal notranslate"><span class="pre">POST</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il existe les annotations <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/GetMapping.html">&#64;GetMapping</a>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PutMapping.html">&#64;PutMapping</a>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PostMapping.html">&#64;PostMapping</a>,
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/DeleteMapping.html">&#64;DeleteMapping</a>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PatchMapping.html">&#64;PatchMapping</a> qui fonctionnent comme l’annotation
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestMapping.html">&#64;RequestMapping</a> sauf qu’il n’est pas nécessaire de préciser la méthode
HTTP concernée puisqu’elle est mentionnée dans le nom de l’annotation :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getHome</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;index&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>L’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestMapping.html">&#64;RequestMapping</a> peut être utilisée directement sur la déclaration
de classe pour donner des informations applicables par défaut pour l’ensemble
des méthodes de cette classe. Si on donne un chemin, alors ce dernier s’ajoute
avant celui déclaré par une méthode.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/admin&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>La méhode <code class="docutils literal notranslate"><span class="pre">addItem</span></code> ci-dessus traite les requêtes pour le chemin
<code class="docutils literal notranslate"><span class="pre">/admin/item</span></code>.</p>
</div>
<p>Notez que toutes les méthodes de contrôleur dans nos exemple retournent une chaîne
de caractères. Il s’agit de l’identifiant de la vue à afficher en réponse à
l’utilisateur, c’est-à-dire de la page HTML à retourner au navigateur du client.
La plupart du temps, la page HTML de réponse va être générée à la volée par un moteur
de rendu. <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> nous donne la possibilité d’utiliser différentes
technologies pour le rendu de la page HTML : JSP, Thymeleaf, Freemarker…
Vous allez devoir configurer votre application en fonction de la technologie que
vous souhaitez utiliser.</p>
</div>
<div class="section" id="les-vues-jsp">
<h2>Les vues JSP<a class="headerlink" href="#les-vues-jsp" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour écrire des vues sous la forme de JSP, nous devons configurer la façon
dont Spring va pouvoir trouver la page JSP en fonction de l’identifiant
retourné par un contrôleur. Il faut ensuite déployer l’application dans un
serveur Java qui embarque un moteur de rendu JSP.</p>
<div class="section" id="pour-une-application-avec-spring-boot">
<h3>Pour une application avec Spring Boot<a class="headerlink" href="#pour-une-application-avec-spring-boot" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous devez vous assurer que votre application Spring Boot utilise bien un
packaging War. Si vous utilisez Maven pour gérer votre projet, il vous suffit
de changer ou d’ajouter la balise <code class="docutils literal notranslate"><span class="pre">&lt;packaging&gt;</span></code> dans votre fichier
<code class="file docutils literal notranslate"><span class="pre">pom.xml</span></code> pour indiquer un packaging de type <code class="docutils literal notranslate"><span class="pre">war</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Configuration du projet Maven pour produire une application Web</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;groupId&gt;</span>dev.gayerie<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId&gt;</span>monapplication<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="hll"><span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
</span></pre></div>
</div>
</div>
<p>Vous devez ensuite vous assurer que vous disposez des bonnes dépendances.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Dépendances pour un projet Maven</span><a class="headerlink" href="#id9" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>3.0.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>javax.servlet.jsp<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<p>Vous devez enfin configurer le gestionnaire de vues de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>
en ajoutant les propriétés suivantes dans le fichier <code class="file docutils literal notranslate"><span class="pre">application.properties</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Configuration du support des JSP</span><a class="headerlink" href="#id10" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">spring.mvc.view.prefix</span> <span class="o">=</span> <span class="s">/WEB-INF/jsp/</span>
<span class="na">spring.mvc.view.suffix</span> <span class="o">=</span> <span class="s">.jsp</span>
</pre></div>
</div>
</div>
<p>Cela signifie que pour trouver la vue, le gestionnaire de vue doit utiliser
l’identifiant fourni par le contrôleur et ajouter <code class="docutils literal notranslate"><span class="pre">/WEB-INF/jsp/</span></code> au début
et <code class="docutils literal notranslate"><span class="pre">.jsp</span></code> à a fin pour en déduire le chemin de la JSP.</p>
<p>Ainsi, si un contrôleur retourne l’identifiant de vue <code class="docutils literal notranslate"><span class="pre">&quot;index&quot;</span></code>, cela
désigne la JSP <code class="docutils literal notranslate"><span class="pre">/WEB-INF/jsp/index.jsp</span></code>. Dans votre projet Maven, cela
implique que vous placiez vos fichiers JSP dans le répertoire
<code class="file docutils literal notranslate"><span class="pre">src/main/webapp/WEB-INF/jsp</span></code> (créez les répertoires manquants si nécessaire).</p>
</div>
<div class="section" id="pour-une-application-sans-spring-boot">
<h3>Pour une application sans Spring Boot<a class="headerlink" href="#pour-une-application-sans-spring-boot" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous devez vous assurer que votre application utilise bien un packaging War.
Si vous utilisez Maven pour gérer votre projet, il vous suffit de changer ou
d’ajouter la balise <code class="docutils literal notranslate"><span class="pre">&lt;packaging&gt;</span></code> dans votre fichier <code class="file docutils literal notranslate"><span class="pre">pom.xml</span></code> pour
indiquer un packaging de type <code class="docutils literal notranslate"><span class="pre">war</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Configuration du projet Maven pour produire une application Web</span><a class="headerlink" href="#id11" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;groupId&gt;</span>dev.gayerie<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId&gt;</span>monapplication<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="hll"><span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
</span></pre></div>
</div>
</div>
<p>Vous devez ensuite vous assurer que vous disposez des bonnes dépendances.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Dépendances pour un projet Maven</span><a class="headerlink" href="#id12" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>3.0.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>javax.servlet.jsp<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<p>Les vues sont gérées par un composant Spring de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/reactive/result/view/ViewResolver.html">ViewResolver</a> qu’il va
falloir configurer par programmation. Nous avons vu en <a class="reference internal" href="spring_mvc_intro.html"><span class="doc">introduction à
Spring MVC</span></a> que l’on ajoute une classe implémentant
l’interface <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html">WebMvcConfigurer</a>. Nous allons pouvoir implémenter la méthode
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html#configureViewResolvers-org.springframework.web.servlet.config.annotation.ViewResolverRegistry-">configureViewResolvers</a> de cette interface pour enregistrer le support pour
les JSP.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Ajout du support des vues JSP dans l’application</span><a class="headerlink" href="#id13" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewResolverRegistry</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="p">;</span>

<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebAppConfiguration</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureViewResolvers</span><span class="p">(</span><span class="n">ViewResolverRegistry</span> <span class="n">registry</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">registry</span><span class="p">.</span><span class="na">jsp</span><span class="p">().</span><span class="na">prefix</span><span class="p">(</span><span class="s">&quot;/WEB-INF/jsp/&quot;</span><span class="p">).</span><span class="na">suffix</span><span class="p">(</span><span class="s">&quot;.jsp&quot;</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="utilisation-des-vues-jsp">
<h3>Utilisation des vues JSP<a class="headerlink" href="#utilisation-des-vues-jsp" title="Lien permanent vers ce titre">¶</a></h3>
<p>Nous pouvons créer un contrôleur <code class="docutils literal notranslate"><span class="pre">AccueilController</span></code> qui possède une
méthode pour les requêtes <code class="docutils literal notranslate"><span class="pre">GET</span></code> sur la racine de l’application :</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Un contrôleur retournant un identifiant de vue</span><a class="headerlink" href="#id14" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccueilController</span> <span class="p">{</span>

  <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">accueillir</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;accueil&quot;</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">accueillir</span></code> se contente de retourner un identifiant de vue
sans réaliser d’autre traitement. Il doit donc exister un fichier JSP
<code class="file docutils literal notranslate"><span class="pre">src/main/webapp/WEB-INF/accueil.jsp</span></code> dans le projet.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">le fichier accueil.jsp</span><a class="headerlink" href="#id15" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span><span class="n">page</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    Bienvenue !
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="les-vues-thymeleaf">
<h2>Les vues Thymeleaf<a class="headerlink" href="#les-vues-thymeleaf" title="Lien permanent vers ce titre">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si vous ne connaissez pas le moteur de rendu <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a>, vous pouvez
vous reporter au <a class="reference internal" href="thymeleaf.html"><span class="doc">chapitre d’introduction à Thymeleaf</span></a>
de ce support.</p>
</div>
<p>Nous allons voir comment rendre des pages HTML en utilisant le moteur de
rendu <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a>. D’abord, nous devons configurer la façon dont <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>
va pouvoir trouver les modèles de page HTML en fonction de l’identifiant
retourné par un contrôleur.</p>
<div class="section" id="id1">
<h3>Pour une application avec Spring Boot<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour une application utilisant Spring Boot, la configuration est très simple.
Il vous suffit d’ajouter une dépendance dans votre projet au module
<code class="docutils literal notranslate"><span class="pre">spring-boot-starter-thymeleaf</span></code>. Si vous utilisez Maven, il vous faut
ajouter dans votre fichier <code class="file docutils literal notranslate"><span class="pre">pom.xml</span></code> :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>Par défaut, les modèles <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a> doivent être placés dans le répertoire
<code class="file docutils literal notranslate"><span class="pre">src/main/resources/templates</span></code> de votre projet. Les fichiers statiques
(non transformés par <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a>) doivent être placés dans le répertoire
<code class="file docutils literal notranslate"><span class="pre">src/main/resources/static</span></code> de votre projet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si vous voulez changer les répertoires par défaut, vous pouvez utiliser
les propriétés <code class="docutils literal notranslate"><span class="pre">spring.thymeleaf.prefix</span></code> et <code class="docutils literal notranslate"><span class="pre">spring.web.resources.static-locations</span></code>
dans le fichier <code class="file docutils literal notranslate"><span class="pre">application.properties</span></code>.</p>
<p>Il existe de nombreuses autres propriétés qui sont documentées dans la
section <em>Templating Properties</em> de la <a class="reference external" href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#templating-properties">documentation Spring Boot</a> pour paramétrer l’intégration
de <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a>.</p>
</div>
</div>
<div class="section" id="id2">
<h3>Pour une application sans Spring Boot<a class="headerlink" href="#id2" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’intégration de <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a> dans une application sans Spring Boot est plus
compliquée car il est nécessaire de créer la configuration du moteur du
rendu. Si vous voulez vraiment faire cette intégration, alors vous pouvez
vous reporter à la <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html#integrating-thymeleaf-with-spring">documentation officielle de Thymeleaf</a>.</p>
</div>
<div class="section" id="utilisation-des-vues-thymeleaf">
<h3>Utilisation des vues Thymeleaf<a class="headerlink" href="#utilisation-des-vues-thymeleaf" title="Lien permanent vers ce titre">¶</a></h3>
<p>Nous pouvons créer un contrôleur <code class="docutils literal notranslate"><span class="pre">AccueilController</span></code> qui possède une
méthode pour les requêtes <code class="docutils literal notranslate"><span class="pre">GET</span></code> sur la racine de l’application :</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Un contrôleur retournant un identifiant de vue</span><a class="headerlink" href="#id16" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccueilController</span> <span class="p">{</span>

  <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">accueillir</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;accueil&quot;</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">accueillir</span></code> se contente de retourner un identifiant de vue
sans réaliser d’autre traitement. Il doit donc exister un fichier HTML
<code class="file docutils literal notranslate"><span class="pre">src/main/resources/templates/accueil.html</span></code> dans le projet.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">le fichier accueil.html</span><a class="headerlink" href="#id17" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    Bienvenue !
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="le-modele">
<h2>Le modèle<a class="headerlink" href="#le-modele" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans une approche MVC, le modèle correspond à l’ensemble des données qui sont
nécessaires à la construction de la vue. Pour une application Web, il s’agit donc
des données nécessaires pour la construction de la page HTML de réponse. Le
contrôleur a la charge de mettre toutes ces données à la disposition de la vue.</p>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> représente la notion de modèle avec l’interface <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html">Model</a>. Cette
interface va permettre à un contrôleur d’ajouter des attributs au modèle,
c’est-à-dire des objets, en les associant chacun à un nom unique. Ainsi, une vue
pourra directement avoir accès à ces objets par leur nom.</p>
<p>Pour obtenir une instance d’un <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html">Model</a>, il suffit de l’ajouter comme paramètre
à une méthode de contrôleur.</p>
<p>Imaginons un exemple très simple : nous souhaitons afficher l’heure courante du
serveur dans une page HTML. Le modèle est simplement constitué d’un objet Java
de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Date.html">Date</a>.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">Le contrôleur pour ajouter la donnée au modèle</span><a class="headerlink" href="#id18" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DateController</span> <span class="p">{</span>

  <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/date&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">afficherDate</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;now&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">Date</span><span class="p">());</span>
</span>    <span class="k">return</span> <span class="s">&quot;affichageDate&quot;</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">afficherDate</span></code> du contrôleur attend en paramètre un objet de type
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html">Model</a> qui sera fourni par <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> à l’appel. À la ligne 13, on ajoute
dans le modèle une nouvelle instance de la classe <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Date.html">Date</a> sous le nom <code class="docutils literal notranslate"><span class="pre">now</span></code>.
Le contrôleur retourne ensuite l’identifiant de la vue <code class="docutils literal notranslate"><span class="pre">affichageDate</span></code>. Cette
vue va pouvoir directement faire référence à l’attribut <code class="docutils literal notranslate"><span class="pre">now</span></code> du modèle.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">La vue JSP : affichageDate.jsp</span><a class="headerlink" href="#id19" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-jsp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span><span class="n">page</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;fmt&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span> <span class="k">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
<span class="hll">    <span class="nt">&lt;p&gt;&lt;fmt:formatDate</span> <span class="na">value=</span><span class="s">&quot;${now}&quot;</span> <span class="na">pattern=</span><span class="s">&quot;dd MMMM yyyy HH:mm:ss&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
</span>  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Ou bien si vous utilisez <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a> :</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">La vue Thymeleaf : affichageDate.html</span><a class="headerlink" href="#id20" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="hll">    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">data-th-text</span><span class="o">=</span><span class="s">&quot;${#dates.format(now, &#39;dd MMMM yyyy HH:mm:ss&#39;)}&quot;</span><span class="p">&gt;</span>la date ici<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span>  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="une-application-multi-couches-n-tiers">
<h2>Une application multi-couches (N-Tiers)<a class="headerlink" href="#une-application-multi-couches-n-tiers" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le développement d’application Web, on insiste généralement sur la nécessité
de réaliser une application en couches (le modèle <em>N-Tiers</em> en anglais). La plupart
des applications utilisent un modèle en 3 couches pour distinguer :</p>
<dl class="simple">
<dt>La couche présentation</dt><dd><p>Il s’agit de l’ensemble des classes qui permettent d’assurer l’interaction
avec l’utilisateur. Pour une application Web, on l’appelle plus souvent
la <em>couche Web</em>. Tous les contrôleurs que nous implémentons et tous les
modèles de vues font partie de la couche présentation.</p>
</dd>
<dt>La couche métier (ou la couche service)</dt><dd><p>Il s’agit de l’ensemble des classes qui permettent de réaliser les fonctionnalités
de l’application.</p>
</dd>
<dt>La couche d’accès au données (ou couche de données)</dt><dd><p>Il s’agit de l’ensemble des classes qui permettent d’interagir avec le système
de données de l’entreprise. Pour des applications simples, il s’agit de la
couche responsable de l’interaction avec une base de données.</p>
</dd>
</dl>
<p>Ces trois couches permettent d’isoler plus facilement chaque partie de l’application.
Il existe une dépendance stricte des couches entre-elles. La couche présentation
dépend de la couche métier pour réaliser les traitements et la couche métier
dépend de la couche de données pour avoir accès aux données et les modifier. Afin
de conserver les responsabilités de chaque couche, il n’est pas toléré d’autres
dépendances.</p>
<p>Pour une application développée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>, les contrôleurs se situent
dans la couche présentation. Ils ne sont donc pas responsables de réaliser les
traitements de l’application.</p>
<p>En fait, nous avons vu que le Spring Framework fournit des stéréotypes <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Service.html">&#64;Service</a>
et <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Repository.html">&#64;Repository</a> précisément pour identifier les <em>beans</em> de la couche métier
(pour le premier) et de la couche d’accès aux données (pour le second). Il
est très facile de construire une application multi-couches avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>,
il suffit d’isoler les traitements de l’application dans des services que nous
pouvons injecter dans nos contrôleurs.</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">Un exemple de contrôleur utilisant un service</span><a class="headerlink" href="#id21" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie.controller</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">dev.gayerie.service.ItemService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ItemService</span> <span class="n">itemService</span><span class="p">;</span>

    <span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/items&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAllItems</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;items&quot;</span><span class="p">,</span> <span class="n">itemService</span><span class="p">.</span><span class="na">getAllItems</span><span class="p">());</span>
        <span class="k">return</span> <span class="s">&quot;listeItems&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Dans notre exemple précédent, on voit que la responsabilité du contrôleur est
limitée au minimum. Il doit fournir les données à la vue en les plaçant dans
le modèle (ligne 17). Il doit fournir l’identifiant de la vue à afficher (ligne
18). Pour récupérer les données, le contrôleur s’adresse au service qui est
injecté comme attribut du contrôleur (lignes 12 et 13).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>L’utilisation des packages est une bonne façon de marquer la séparation
des couches dans l’application. Dans l’exemple précédent, le contrôleur
est déclaré dans le package dev.gayerie.controller et le service dans le
package dev.gayerie.service. On peut faire de même pour la couche d’accès
aux données en créant un package dev.gayerie.repository.</p>
</div>
</div>
<div class="section" id="la-signature-des-methodes-de-controleur">
<h2>La signature des méthodes de contrôleur<a class="headerlink" href="#la-signature-des-methodes-de-controleur" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> autorise une très grande diversité de signatures pour les méthodes
d’un contrôleur gérant les requêtes HTTP (appelées <em>handler methods</em>).
Nous sommes libres dans le choix du nom de la méthode. Il existe également un large
choix concernant le type et le nombre des paramètres ainsi que le type de la
valeur de retour de la méthode.</p>
<div class="section" id="les-parametres">
<h3>Les paramètres<a class="headerlink" href="#les-parametres" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour la liste complète des types de paramètre supportés, reportez-vous à la
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-arguments">documentation officielle</a></p>
<p>À titre d’exemple, une méthode gérant les requêtes HTTP peut accepter en paramètres :</p>
<ul>
<li><p>La valeur d’un paramètre de la requête HTTP grâce à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestParam.html">&#64;RequestParam</a>.</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;itemName&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depuis Java 8, si le nom du paramètre de la requête est identique au nom du
paramètre de la méthode, il n’est pas utile de préciser le nom du paramètre
de la requête entre parenthèses :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">itemName</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>La valeur d’un en-tête de la requête HTTP grâce à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestHeader.html">&#64;RequestHeader</a></p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestHeader</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@RequestHeader</span><span class="p">(</span><span class="s">&quot;host&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">host</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depuis Java 8, si le nom de l’en-tête de la requête est identique au nom du
paramètre de la méthode, il n’est pas utile de préciser le nom de l’en-tête
de la requête entre parenthèses :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@RequestHeader</span> <span class="n">String</span> <span class="n">host</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Une valeur dans le chemin de la ressource grâce à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PathVariable.html">&#64;PathVariable</a>.
On utilise des accolades dans la déclaration du chemin pour indiquer la partie
dynamique dont on recevra la valeur en paramètre.</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

<span class="hll">    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;{subpath}/item&quot;</span><span class="p">)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;subpath&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">subpath</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depuis Java 8, si le nom de la variable de chemin est identique au nom du
paramètre de la méthode, il n’est pas utile de préciser le nom de la variable
entre parenthèses :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;{subpath}/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">subpath</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>La valeur d’un attribut de requête ou de session grâce aux annotations
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestAttribute.html">&#64;RequestAttribute</a> et <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/SessionAttribute.html">&#64;SessionAttribute</a> :</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.SessionAttribute</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@SessionAttribute</span><span class="p">(</span><span class="s">&quot;basket&quot;</span><span class="p">)</span> <span class="n">Basket</span> <span class="n">basket</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depuis Java 8, si le nom de l’attribut est identique au nom du
paramètre de la méthode, il n’est pas utile de préciser le nom de l’attribut
entre parenthèses :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@SessionAttribute</span> <span class="n">Basket</span> <span class="n">basket</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
</ul>
<p>Toutes les annotations ci-dessus acceptent l’attribut <code class="docutils literal notranslate"><span class="pre">required</span></code> qui permet d’indiquer
si le paramètre doit être renseigné. Si l’attribut <code class="docutils literal notranslate"><span class="pre">required</span></code> vaut <code class="docutils literal notranslate"><span class="pre">true</span></code> (la
valeur par défaut) alors l’absence de valeur entraîne une erreur de type 400
(bad request) et la méthode du contrôleur n’est pas appelée.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depuis Java 8, il est possible d’utiliser <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Optional.html">Optional</a> comme type de paramètre
afin de préciser que le paramètre est optionnel (sans avoir à se préoccuper de la
valeur de l’attribut <em>required</em>).</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@SessionAttribute</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Basket</span><span class="o">&gt;</span> <span class="n">basket</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">basket</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Il est également possible d’attendre en paramètre un objet Java présent dans le
modèle grâce à l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ModelAttribute.html">&#64;ModelAttribute</a>. Si aucune instance n’existe,
l’objet sera <strong>automatiquement instancié</strong>. De plus, les propriétés de cet
objet seront préremplies avec la valeur des paramètres de la requête portant
le même nom.</p>
<p>Par exemple, si on déclare la classe <cite>Item</cite> :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="p">;</span>

    <span class="c1">// Getters/setters omis</span>

<span class="p">}</span>
</pre></div>
</div>
<p>On peut déclarer une méthode dans un contrôleur qui prend en paramètre un objet
de type <code class="docutils literal notranslate"><span class="pre">Item</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addItem</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemDetail&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Lors du traitement de la requête POST sur <code class="file docutils literal notranslate"><span class="pre">/item</span></code>, un objet de type <code class="docutils literal notranslate"><span class="pre">Item</span></code>
sera créé avec ses propriétés renseignés avec la valeur des paramètres HTTP
<em>name</em>, <em>code</em> et <em>quantity</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>L’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ModelAttribute.html">&#64;ModelAttribute</a> peut être omise car c’est l’interprétation
par défaut d’un paramètre d’une méthode d’un contrôleur.</p>
</div>
<p>Enfin, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> reconnaît certains types particuliers pour les paramètres.
C’est notamment le cas du type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html">Model</a> que nous avons vu précédemment.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageController</span> <span class="p">{</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/message&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">display</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;Hello world&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="s">&quot;showMessage&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-valeur-de-retour">
<h3>La valeur de retour<a class="headerlink" href="#la-valeur-de-retour" title="Lien permanent vers ce titre">¶</a></h3>
<p>Nous avons vu qu’une méthode de gestion de requête d’un contrôleur peut retourner
un objet de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html">String</a>. En effet, cet objet est généralement utilisé pour
identifier la vue. Il existe cependant plusieurs types de retour autorisés par
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a></p>
<ul class="simple">
<li><p>Si la méthode retourne une chaîne de caractères alors elle est permet au <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/reactive/result/view/ViewResolver.html">ViewResolver</a>
configurer de déduire la vue qui doit être appelée. C’est ce type de valeur
retour que nous avons utilisé depuis le début de ce chapitre.</p></li>
<li><p>Si la méthode retourne <code class="docutils literal notranslate"><span class="pre">void</span></code> ou <code class="docutils literal notranslate"><span class="pre">null</span></code> alors la méthode est supposée
avoir correctement traitée la requête et aucune vue ne sera appelée.</p></li>
<li><p>Si la méthode retourne un objet de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/ModelAndView.html">ModelAndView</a> alors il est utilisé pour
déduire l’identifiant de la vue et les données du modèle.</p></li>
<li><p>Si la méthode est annotée par <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ResponseBody.html">&#64;ResponseBody</a>, cela signifie que l’objet
retourné constitue la réponse. Il est possible d’utiliser un convertisseur pour
le transformer, par exemple, en réponse JSON.</p></li>
</ul>
<p>Pour la liste complète des types de valeur de retour supportés, reportez-vous à la
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-return-types">documentation officielle</a>.</p>
</div>
</div>
<div class="section" id="taglib-jsp-et-gestion-des-formulaires">
<h2>Taglib JSP et gestion des formulaires<a class="headerlink" href="#taglib-jsp-et-gestion-des-formulaires" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> fournit ses propres bibliothèques de tag (<em>taglibs</em>).
Elles offrent des fonctionnalités supplémentaires par rapport aux JSTL et vont
notamment nous permettre de gérer plus facilement les formulaires HTML.</p>
<div class="section" id="spring-s-jsp-taglib">
<h3>Spring’s JSP taglib<a class="headerlink" href="#spring-s-jsp-taglib" title="Lien permanent vers ce titre">¶</a></h3>
<p>La première <em>taglib</em>, appelée simplement <em>Spring’s JSP taglib</em>, apporte des
fonctionnalités similaires aux JSTL tout en y ajoutant des évolutions ou des
spécificités propres à <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>. Vous pouvez vous reporter à la
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/package-summary.html">documentation officielle</a>
pour voir la liste des <em>tags</em> supportés.
Cette <em>taglib</em> doit être déclarée dans une JSP avec la directive <code class="docutils literal notranslate"><span class="pre">taglib</span></code> :</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span> <span class="k">%&gt;</span>
</pre></div>
</div>
<p>Par exemple, la balise <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/UrlTag.html">&lt;spring:url/&gt;</a> offre des fonctionnalités supplémentaires par rapport
à son équivalent dans les JSTL. Il est possible de passer des paramètres et de
demander un échappement des caractères pour une utilisation dans du code JavaScript :</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span> <span class="k">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;spring:url</span> <span class="na">value=</span><span class="s">&quot;/destination&quot;</span> <span class="na">javaScriptEscape=</span><span class="s">&quot;true&quot;</span> <span class="na">var=</span><span class="s">&quot;destinationUrl&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;spring:param</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;${name}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/spring:url&gt;</span>
    <span class="nt">&lt;script&gt;</span>
    var url = &quot;${destinationUrl}&quot;;
    alert(url);
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>S’il existe dans le modèle un attribut <em>name</em> avec la valeur <em>julie</em>, alors
la JSP ci-dessus produira le code HTML suivant :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>



    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;\/sailorapp\/destination?name=julie&quot;</span><span class="p">;</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="form-taglib">
<h3>Form taglib<a class="headerlink" href="#form-taglib" title="Lien permanent vers ce titre">¶</a></h3>
<p>La seconde <em>taglib</em>, appelée <em>form taglib</em>, permet de créer un formulaire
HTML lié à un objet présent dans le modèle. Chaque champ du formulaire sera
initialisé avec la valeur d’une propriété de cet objet. Puis, lorsque
l’utilisateur soumettra les données du formulaire au serveur, elles serviront
à remplir les propriétés d’un objet du même type qui sera reçu en paramètre
d’une méthode d’un contrôleur.</p>
<p>L’opération qui associe des données envoyées par l’utilisateur avec un objet
du modèle est appelée un <em>binding</em>. Cela permet au développeur de l’application
de traiter les données d’un formulaire sous la forme d’un objet.</p>
<p>La <em>form taglib</em> doit être déclarée dans une JSP avec la directive <code class="docutils literal notranslate"><span class="pre">taglib</span></code> :</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="k">%&gt;</span>
</pre></div>
</div>
<p>Cette <em>taglib</em> fournit le <em>tag</em> <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/FormTag.html">&lt;form:form&gt;</a> ainsi que des <em>tags</em> pour
tous les éléments d’un formulaire : <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/InputTag.html">&lt;form:input&gt;</a>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/CheckboxTag.html">&lt;form:checkbox&gt;</a>,
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/ButtonTag.html">&lt;form:button&gt;</a>…
Vous pouvez vous reporter à la <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/package-summary.html">documentation officielle</a>
pour voir la liste complète des <em>tags</em> supportés.</p>
<p>Supposons que nous ayons une classe <code class="docutils literal notranslate"><span class="pre">Item</span></code> qui représente les données
qu’un utilisateur peut saisir dans un formulaire pour créer un item.</p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">Les données à associer au formulaire</span><a class="headerlink" href="#id22" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="p">;</span>

    <span class="c1">// Getters/setters omis</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Nous pouvons créer la vue suivante pour fournir un formulaire qui permet de
saisir les informations d’un <em>item</em> :</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">Exemple de fichier itemForm.jsp</span><a class="headerlink" href="#id23" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-jsp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="k">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;form:form</span> <span class="na">servletRelativeAction=</span><span class="s">&quot;/item&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;item&quot;</span> <span class="na">acceptCharset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p&gt;&lt;label&gt;</span>Code : <span class="nt">&lt;/label&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;code&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;&lt;label&gt;</span>Nom : <span class="nt">&lt;/label&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;&lt;label&gt;</span>Quantité : <span class="nt">&lt;/label&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>Envoyer<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La vue ci-dessus utilise la <em>form taglib</em> pour créer un formulaire. La balise
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/FormTag.html">&lt;form:form&gt;</a> possède l’attribut <code class="docutils literal notranslate"><span class="pre">servletRelativeAction</span></code> pour fournir
le chemin qui sera utilisé pour définir l’action du formulaire. La balise
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/FormTag.html">&lt;form:form&gt;</a> possède également l’attribut <code class="docutils literal notranslate"><span class="pre">modelAttribute</span></code> qui nous
permet de préciser qu’il doit exister dans le modèle un objet qui s’appelle
<code class="docutils literal notranslate"><span class="pre">item</span></code> (et dans notre cas qui doit être une instance de <code class="docutils literal notranslate"><span class="pre">Item</span></code>). Cet
objet va être utilisé pour remplir les données du formulaire. La balise
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/InputTag.html">&lt;form:input&gt;</a> fournit l’attribut <code class="docutils literal notranslate"><span class="pre">path</span></code> qui déclare le chemin d’accès
dans l’objet <code class="docutils literal notranslate"><span class="pre">item</span></code> à la donnée associée à ce champ. Par exemple, à la
ligne 11, le chemin <code class="docutils literal notranslate"><span class="pre">code</span></code> signifie que le champ input doit être associé
à la propriété <code class="docutils literal notranslate"><span class="pre">code</span></code> de l’objet <code class="docutils literal notranslate"><span class="pre">item</span></code>. Ainsi <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> va
utiliser la méthode <code class="docutils literal notranslate"><span class="pre">Item.getCode()</span></code> pour connaître la valeur du champ.</p>
<p>Pour que ce formulaire fonctionne correctement, il faut lui associer deux
méthodes de contrôleur. Une première méthode correspondant à l’affichage du
formulaire qui pourra éventuellement positionner des valeurs par défaut dans
les champs. Et une seconde méthode correspondant au traitement du formulaire
quand l’utilisateur soumettra les données au serveur.</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">Le contrôleur associé au formulaire</span><a class="headerlink" href="#id24" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO initialiser le bean de formulaire si nécessaire</span>
        <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO traiter le formulaire</span>
        <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">displayForm</span></code> attend en paramètre un objet de type <code class="docutils literal notranslate"><span class="pre">Item</span></code>.
Comme ce paramètre est annoté avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ModelAttribute.html">&#64;ModelAttribute</a>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>
créera un objet de ce type pour l’ajouter comme attribut du modèle
sous le nom <code class="docutils literal notranslate"><span class="pre">item</span></code> avant de le passer en paramètre de l’appel.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si vous souhaitez garder le contrôle sur la création de l’objet du formulaire,
votre méthode de contrôleur peut ajouter elle-même cet objet au modèle à
partir d’une instance de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html">Model</a> reçue en paramètre :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">();</span>
    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;item&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans la vue, la balise <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/FormTag.html">&lt;form:form&gt;</a> utilisera cet objet du modèle pour
remplir les champs du formulaire. Le contrôleur a donc l’opportunité de préciser
la valeur par défaut des champs :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">item</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">);</span>
    <span class="n">item</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;un objet&quot;</span><span class="p">);</span>
    <span class="n">item</span><span class="p">.</span><span class="na">setQuantity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">processForm</span></code> attend une requête <code class="docutils literal notranslate"><span class="pre">POST</span></code> est permettra de traiter
les données envoyées par l’utilisateur. Elle attend également en paramètre un
objet de type <code class="docutils literal notranslate"><span class="pre">Item</span></code>. Cet objet sera automatiquement créé et ses champs
seront remplis à partir des données envoyées par le formulaire.</p>
<p>On voit qu’il est plus simple de représenter les données d’un formulaire
sous la forme d’un objet. Lorsqu’on crée spécifiquement une classe pour
représenter ces données, on appelle généralement ce type de classes un
<strong>DTO</strong> (pour <em>Data Transfer Object</em>). Comme son nom l’indique, un DTO a
pour fonction dans le système de représenter le transfert de données entre
deux composantes (dans notre exemple, entre la page Web et le contrôleur).
Nous pourrions renommer la classe <code class="docutils literal notranslate"><span class="pre">Item</span></code> en <code class="docutils literal notranslate"><span class="pre">ItemDto</span></code> pour indiquer
clairement au lecteur la responsabilité de cette classe dans le système.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Reportez-vous à la <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#mvc-view-jsp-formtaglib">documentation officielle</a>
pour des exemples plus détaillés de formulaires avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>.</p>
</div>
</div>
</div>
<div class="section" id="gestion-des-formulaires-avec-thymeleaf">
<h2>Gestion des formulaires avec Thymeleaf<a class="headerlink" href="#gestion-des-formulaires-avec-thymeleaf" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a> apporte une simplification dans la gestion des formulaires.
Il permet de créer un formulaire HTML lié à un objet présent dans le modèle.
Chaque champ du formulaire sera initialisé avec la valeur d’une propriété de
cet objet. Puis, lorsque l’utilisateur soumettra les données du formulaire
au serveur, elles serviront à remplir les propriétés d’un objet du même type
qui sera reçu par le contrôleur. L’opération qui associe des données envoyées
par l’utilisateur avec un objet du modèle est appelée un <em>binding</em>. Cela
permet au développeur de l’application de traiter les données d’un formulaire
sous la forme d’un objet.</p>
<p>Supposons que nous ayons une classe <code class="docutils literal notranslate"><span class="pre">Item</span></code> qui représente les données
qu’un utilisateur peut saisir dans un formulaire pour créer un item.</p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">Les données à associer au formulaire</span><a class="headerlink" href="#id25" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="p">;</span>

    <span class="c1">// Getters/setters omis</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Nous pouvons créer la vue suivante pour fournir un formulaire qui permet de
saisir les informations d’un <em>item</em> :</p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">Exemple de fichier itemForm.html</span><a class="headerlink" href="#id26" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">data-th-action</span><span class="o">=</span><span class="s">&quot;@{/item}&quot;</span> <span class="na">data-th-object</span><span class="o">=</span><span class="s">&quot;${item}&quot;</span> <span class="na">accept-charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Code : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">data-th-field</span><span class="o">=</span><span class="s">&quot;*{code}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Nom : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">data-th-field</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Quantité : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">data-th-field</span><span class="o">=</span><span class="s">&quot;*{quantity}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Envoyer<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La vue ci-dessus crée un formulaire et l’attribut Thymeleaf <code class="docutils literal notranslate"><span class="pre">object</span></code> permet
de sélectionner l’objet <code class="docutils literal notranslate"><span class="pre">item</span></code> du modèle. Pour chaque balise
<code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>, on utilise l’attribut Thymeleaf <code class="docutils literal notranslate"><span class="pre">field</span></code> pour lui spécifier
le chemin d’accès à la valeur du champ. La syntaxe <code class="docutils literal notranslate"><span class="pre">*{}</span></code> signale que l’expression
est relative à l’objet <code class="docutils literal notranslate"><span class="pre">item</span></code>. Ainsi, si la propriété <code class="docutils literal notranslate"><span class="pre">code</span></code> de l’objet
nommé <code class="docutils literal notranslate"><span class="pre">item</span></code> vaut <code class="docutils literal notranslate"><span class="pre">&quot;0001&quot;</span></code>, alors la balise :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">data-th-field</span><span class="o">=</span><span class="s">&quot;*{code}&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>sera transformée par le moteur <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a> pour produire :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;code&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;code&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;0001&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Pour que ce formulaire fonctionne correctement, il faut lui associer deux
méthodes de contrôleur. Une première méthode correspondant à l’affichage du
formulaire qui pourra éventuellement positionner des valeurs par défaut dans
les champs. Et une seconde méthode correspondant au traitement du formulaire
quand l’utilisateur soumettra les données au serveur.</p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">Le contrôleur associé au formulaire</span><a class="headerlink" href="#id27" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO initialiser le bean de formulaire si nécessaire</span>
        <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO traiter le formulaire</span>
        <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">displayForm</span></code> attend en paramètre un objet de type <code class="docutils literal notranslate"><span class="pre">Item</span></code>.
Comme ce paramètre est annoté avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ModelAttribute.html">&#64;ModelAttribute</a>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>
créera un objet de ce type pour l’ajouter comme attribut du modèle
sous le nom <code class="docutils literal notranslate"><span class="pre">item</span></code> avant de le passer en paramètre de l’appel.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si vous souhaitez garder le contrôle sur la création de l’objet du formulaire,
votre méthode de contrôleur peut ajouter elle-même cet objet au modèle à
partir d’une instance de <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html">Model</a> reçue en paramètre :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">();</span>
    <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;item&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans la vue, cet objet du modèle sera utilisé pour remplir les champs du
formulaire. Le contrôleur a donc l’opportunité de préciser la valeur par
défaut des champs :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">item</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">);</span>
    <span class="n">item</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;un objet&quot;</span><span class="p">);</span>
    <span class="n">item</span><span class="p">.</span><span class="na">setQuantity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">processForm</span></code> attend une requête <code class="docutils literal notranslate"><span class="pre">POST</span></code> est permettra de traiter
les données envoyées par l’utilisateur. Elle attend en paramètre un
objet de type <code class="docutils literal notranslate"><span class="pre">Item</span></code>. Cet objet sera automatiquement créé et ses propriétés
seront remplies à partir des données envoyées par le formulaire.</p>
<p>On voit qu’il est plus simple de représenter les données d’un formulaire
sous la forme d’un objet. Lorsqu’on crée spécifiquement une classe pour
représenter ces données, on appelle généralement ce type de classes un
<strong>DTO</strong> (pour <em>Data Transfer Object</em>). Comme son nom l’indique, un DTO a
pour fonction dans le système de représenter le transfert de données entre
deux composantes (dans notre exemple, entre la page Web et le contrôleur).
Nous pourrions renommer la classe <code class="docutils literal notranslate"><span class="pre">Item</span></code> en <code class="docutils literal notranslate"><span class="pre">ItemDto</span></code> pour indiquer
clairement au lecteur la responsabilité de cette classe dans le système.</p>
</div>
<div class="section" id="externalisation-des-messages">
<h2>Externalisation des messages<a class="headerlink" href="#externalisation-des-messages" title="Lien permanent vers ce titre">¶</a></h2>
<p id="spring-web-mvc-externalisation-messages">L’externalisation des messages permet de placer des chaînes de caractères dans
un fichier externe afin de les référencer par un code. Cette externalisation
a au moins deux intérêts dans une application Web :</p>
<ul class="simple">
<li><p>Cela évite d’écrire directement les messages en dur dans le code, notamment
les messages d’erreur ou d’information que l’on veut voir afficher dynamiquement
dans une vue.</p></li>
<li><p>Cela facilite l’internationalisation (I18N) d’un site Web. Tous les textes sont
remplacés par des codes dans les vues et les textes sont insérés dynamiquement
en fonction de la langue du navigateur. Pour chaque langue que l’on souhaite
gérer, il suffit de fournir un fichier associant les codes aux textes dans la
langue souhaitée. Ce processus s’appelle la localisation (L10N).</p></li>
</ul>
<p>Java fournit dans son API standard la classe <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html">ResourceBundle</a> qui est faite
pour réaliser cette externalisation. On utilise un ou plusieurs fichiers de propriétés
pour stocker les chaînes de caractères. Si on souhaite supporter plusieurs langues,
il suffit de créer un fichier par langue et d’ajouter le code de la langue
comme suffixe du nom du fichier.</p>
<p>Nous pouvons avoir un fichier par défaut nommé <code class="file docutils literal notranslate"><span class="pre">messages.properties</span></code>
correspondant à la langue par défaut. Par exemple le français :</p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">Le fichier messages.properties</span><a class="headerlink" href="#id28" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">welcome.title</span> <span class="o">=</span> <span class="s">Bienvenue dans l&#39;application</span>
<span class="na">welcome.text</span> <span class="o">=</span> <span class="s">Cette application est disponible en plusieurs langues.</span>
</pre></div>
</div>
</div>
<p>Nous pouvons aussi avoir un fichier spécifique pour l’anglais qui devra se
nommer <code class="file docutils literal notranslate"><span class="pre">messages_en.properties</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text">Le fichier messages_en.properties</span><a class="headerlink" href="#id29" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">welcome.title</span> <span class="o">=</span> <span class="s">Welcome in this application</span>
<span class="na">welcome.text</span> <span class="o">=</span> <span class="s">This application is available for different languages.</span>
</pre></div>
</div>
</div>
<p>Si nous plaçons ces fichiers dans le <em>classpath</em> (pour une projet géré par Maven,
cela signifie qu’il faut placer ces fichiers dans <code class="file docutils literal notranslate"><span class="pre">src/main/resources</span></code>),
nous pouvons écrire le code Java :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResourceBundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="n">ResourceBundle</span><span class="p">.</span><span class="na">getBundle</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">Locale</span><span class="p">.</span><span class="na">ENGLISH</span><span class="p">);</span>
<span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;welcome.title&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;welcome.text&quot;</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</pre></div>
</div>
<p>L’exécution de ce code affichera :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Welcome in this application
This application is available for different languages.
</pre></div>
</div>
<p>La création d’un <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html">ResourceBundle</a> se fait avec la méthode de fabrique <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html#getBundle(java.lang.String,java.util.Locale)">getBundle</a>
à laquelle on fournit la racine du nom des fichiers de propriétés et la locale
pour laquelle on désire obtenir les messages. Le <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html">ResourceBundle</a> va appliquer
un algorithme décrit <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html#default_behavior">ici</a>
pour déterminer quel fichier il doit prendre en compte en fonction de la langue.
Dans notre exemple, il s’agit du fichier pour la langue anglaise donc
<code class="file docutils literal notranslate"><span class="pre">messages_en.properties</span></code>. Pour toutes les autres langues, le <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html">ResourceBundle</a>
utilisera le fichier par défaut <code class="file docutils literal notranslate"><span class="pre">messages_fr.properties</span></code>, donc les message
en français :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResourceBundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="n">ResourceBundle</span><span class="p">.</span><span class="na">getBundle</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">Locale</span><span class="p">.</span><span class="na">FRENCH</span><span class="p">);</span>
<span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;welcome.title&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">bundle</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;welcome.text&quot;</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</pre></div>
</div>
<p>L’exécution de ce code affichera :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Bienvenue dans l&#39;application
Cette application est disponible en plusieurs langues.
</pre></div>
</div>
<p>Dans une application basée sur <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>, nous n’avons pas à créer
le <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html">ResourceBundle</a> nous-mêmes. Le framework va s’en charger pour nous et nous
permettre d’externaliser les messages dans les fichiers de propriétés.</p>
<div class="section" id="id4">
<h3>Pour une application avec Spring Boot<a class="headerlink" href="#id4" title="Lien permanent vers ce titre">¶</a></h3>
<p>Spring Boot active par défaut le support des messages. Il attend dans le <em>classpath</em>
des fichiers commençant par <code class="file docutils literal notranslate"><span class="pre">messages</span></code> (<code class="file docutils literal notranslate"><span class="pre">messages.properties</span></code>,
<code class="file docutils literal notranslate"><span class="pre">messages_en.properties</span></code>, <code class="file docutils literal notranslate"><span class="pre">messages_jp.properties</span></code>…). Donc, pour
un projet Maven, il suffit de placer les fichiers dans <code class="file docutils literal notranslate"><span class="pre">src/main/resources</span></code>.</p>
<p>Si vous voulez utiliser un autre préfixe pour le nom des fichiers, il suffit
de définir la propriété <code class="docutils literal notranslate"><span class="pre">spring.messages.basename</span></code> dans le fichier
<code class="file docutils literal notranslate"><span class="pre">application.properties</span></code></p>
<div class="admonition caution">
<p class="admonition-title">Prudence</p>
<p>Spring Boot considère par défaut que les fichiers de messages sont encodés
en UTF-8. C’est plutôt une bonne idée sauf que les fichiers de propriétés
Java ont un encodage par défaut en Latin-1 (ISO-8859-1). Quand vous ouvrez
les fichiers de propriétés dans un éditeur de texte, faites attention à ce
que l’encodage soit bien en UTF-8.</p>
<p>Vous pouvez revenir à l’encodage par défaut de la norme Java en ajoutant
dans le fichier <code class="file docutils literal notranslate"><span class="pre">application.properties</span></code> :</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">spring.messages.encoding</span> <span class="o">=</span> <span class="s">iso-8859-1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3>Pour une application sans Spring Boot<a class="headerlink" href="#id5" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour supporter l’externalisation des messages dans une application Spring, il
suffit d’ajouter un <em>bean</em> de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/MessageSource.html">MessageSource</a> dans le contexte d’application.
Par exemple, vous pouvez ajouter la méthode suivante dans un <em>bean</em> de
configuration :</p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text">Déclaration d’un <em>bean</em> MessageSource</span><a class="headerlink" href="#id30" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">MessageSource</span> <span class="nf">messageSource</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">ResourceBundleMessageSource</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResourceBundleMessageSource</span><span class="p">();</span>
<span class="hll">  <span class="n">source</span><span class="p">.</span><span class="na">setBasename</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">);</span>
</span>  <span class="k">return</span> <span class="n">source</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple ci-dessus, le <em>bean</em> est de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/support/ResourceBundleMessageSource.html">ResourceBundleMessageSource</a>.
Il utilise le mécanisme du <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ResourceBundle.html">ResourceBundle</a> avec <code class="docutils literal notranslate"><span class="pre">&quot;messages&quot;</span></code> comme préfixe
pour le nom des fichiers de propriétés.</p>
</div>
<div class="section" id="utilisation-des-messages-dans-une-jsp">
<h3>Utilisation des messages dans une JSP<a class="headerlink" href="#utilisation-des-messages-dans-une-jsp" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour afficher les messages externalisés dans les vues JSP, il faut utiliser la
<em>taglib</em> Spring qui fournit la balise <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/MessageTag.html">&lt;spring:message/&gt;</a> :</p>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span><span class="n">page</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;spring&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags&quot;</span> <span class="k">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;welcome.title&quot;</span><span class="nt">/&gt;&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;&lt;spring:message</span> <span class="na">code=</span><span class="s">&quot;welcome.text&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="utilisation-des-messages-avec-thymeleaf">
<h3>Utilisation des messages avec Thymeleaf<a class="headerlink" href="#utilisation-des-messages-avec-thymeleaf" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les messages externalisés sont directement accessibles dans une vue
<a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a> en utilisant une expression de message <code class="docutils literal notranslate"><span class="pre">#{</span> <span class="pre">}</span></code> :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">data-th-text</span><span class="o">=</span><span class="s">&quot;#{ welcome.title }&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">data-th-text</span><span class="o">=</span><span class="s">&quot;#{ welcome.text }&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="validation-des-parametres-d-une-requete">
<h2>Validation des paramètres d’une requête<a class="headerlink" href="#validation-des-parametres-d-une-requete" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> nous permet de valider les données envoyées au serveur et,
éventuellement, d’afficher à l’utilisateur des messages d’erreur dans les vues.
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> supporte plusieurs mécanismes pour gérer la validation : vous
pouvez faire la validation par programmation en utilisant l’API ou vous pouvez
faire une validation déclarative au moyen de <a class="reference external" href="https://beanvalidation.org/">Bean Validation</a>.</p>
<div class="section" id="la-notion-de-binding-et-le-bindingresult">
<h3>La notion de <em>binding</em> et le BindingResult<a class="headerlink" href="#la-notion-de-binding-et-le-bindingresult" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans la programmation d’interface graphique, on utilise le terme de <em>binding</em>
pour désigner le mécanisme qui permet de mettre à jour l’état d’un objet en
fonction des données saisies par l’utilisateur. Dans <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>,
la validation est un mécanisme qui se produit au moment de la phase de <em>binding</em>.
Lors de l’envoi de données par formulaire, nous déclarons dans la méthode
du contrôleur un paramètre qui représente les données du formulaire et sur
lequel va être effectué le <em>binding</em>. <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> fournit également la
classe <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a> qui, comme son nom l’indique, est responsable de stocker
le résultat de l’opération de binding et notamment les erreurs qui ont été
détectées. Pour obtenir une objet de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a>, il faut le déclarer
en paramètre de la méthode de contrôleur <strong>juste derrière</strong> le paramètre
représentant les données de formulaire.</p>
<p>Un objet de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a> possède la méthode <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/Errors.html#hasErrors--">hasErrors</a> qui permet de
vérifier si des erreurs ont été détectées au moment du <em>binding</em>. Une
implémentation classique pour la prise en charge d’un formulaire consiste à
vérifier s’il existe des erreurs de <em>binding</em> et, dans ce cas, arrêter
immédiatement le traitement en retournant l’identifiant de la vue pour afficher
à nouveau le formulaire.</p>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text">Implémentation type pour la prise en charge du BindingResult</span><a class="headerlink" href="#id31" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

  <span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">,</span>
                            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="validation-dans-la-methode-du-controleur">
<h3>Validation dans la méthode du contrôleur<a class="headerlink" href="#validation-dans-la-methode-du-controleur" title="Lien permanent vers ce titre">¶</a></h3>
<p>La manière la plus directe de faire de la validation et de placer le code de
validation directement dans la méthode du contrôleur. Nous pouvons nous aider
de la classe <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/ValidationUtils.html">ValidationUtils</a> qui fournit des méthodes statiques pour les cas
de validation les plus simples.</p>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text">Validation dans la méthode de contrôleur</span><a class="headerlink" href="#id32" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">,</span> <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">  <span class="n">ValidationUtils</span><span class="p">.</span><span class="na">rejectIfEmpty</span><span class="p">(</span><span class="n">bindingResult</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;empty&quot;</span><span class="p">);</span>
</span><span class="hll">  <span class="n">ValidationUtils</span><span class="p">.</span><span class="na">rejectIfEmpty</span><span class="p">(</span><span class="n">bindingResult</span><span class="p">,</span> <span class="s">&quot;code&quot;</span><span class="p">,</span> <span class="s">&quot;empty&quot;</span><span class="p">);</span>
</span><span class="hll">  <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="n">bindingResult</span><span class="p">.</span><span class="na">rejectValue</span><span class="p">(</span><span class="s">&quot;quantity&quot;</span><span class="p">,</span> <span class="s">&quot;invalid&quot;</span><span class="p">);</span>
</span><span class="hll">  <span class="p">}</span>
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Avant de vérifier si l’objet <code class="docutils literal notranslate"><span class="pre">bindingResult</span></code> contient des erreurs, on
appelle la méthode <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/ValidationUtils.html#rejectIfEmpty-org.springframework.validation.Errors-java.lang.String-java.lang.String-">ValidationUtils.rejectIfEmpty</a>. Cette méthode ajoute une
erreur dans l’objet de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a> si le champ indiqué par le second
paramètre est vide. Si c’est le cas, une erreur est ajoutée avec un code.
Pour la ligne 3 par exemple, on vérifie le contenu de la propriété <code class="docutils literal notranslate"><span class="pre">name</span></code> de
l’item. Si elle est vide alors une erreur avec le code <code class="docutils literal notranslate"><span class="pre">&quot;empty.item.code&quot;</span></code>
est ajoutée dans le <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a>. Le code est construit à partir de la
valeur du dernier paramètre suivi du nom de l’objet dans le modèle et suivi
par le chemin du champ à valider.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Le <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a> est lié à l’objet de type <code class="docutils literal notranslate"><span class="pre">Item</span></code>, il n’est donc
pas nécessaire de préciser que le <em>binding</em> porte sur <em>item</em>.</p>
</div>
<p>Pour des validations plus complexes (lignes 5 à 7), on peut utiliser la méthode
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/Errors.html#rejectValue-java.lang.String-java.lang.String-java.lang.String-">rejectValue</a> pour ajouter une erreur de <em>binding</em> en précisant le champs concerné
et le code erreur. À la ligne 6, on ajoute une erreur pour la propriété <code class="docutils literal notranslate"><span class="pre">quantity</span></code>
avec le code erreur <code class="docutils literal notranslate"><span class="pre">&quot;invalid.item.quantity&quot;</span></code>. Le code est construit à partir
de la valeur du dernier paramètre suivi du nom de l’objet dans le modèle et suivi
par le chemin du champ à valider.</p>
</div>
<div class="section" id="creation-d-un-validateur">
<h3>Création d’un validateur<a class="headerlink" href="#creation-d-un-validateur" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le code précédent mélange la validation avec le traitement de la requête proprement
dite. Pour des raisons de lisibilité et de ré-utilisabilité, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>
incite à créer des classes implémentant l’interface <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/Validator.html">Validator</a>. Si nous reprenons
l’exemple précédent, nous pouvons créer une classe <code class="docutils literal notranslate"><span class="pre">ItemValidator</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text">La classe de validation pour Item</span><a class="headerlink" href="#id33" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.Errors</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.ValidationUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.Validator</span><span class="p">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemValidator</span> <span class="kd">implements</span> <span class="n">Validator</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supports</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Item</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">clazz</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">validate</span><span class="p">(</span><span class="n">Object</span> <span class="n">target</span><span class="p">,</span> <span class="n">Errors</span> <span class="n">errors</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="n">Item</span><span class="p">)</span> <span class="n">target</span><span class="p">;</span>
    <span class="n">ValidationUtils</span><span class="p">.</span><span class="na">rejectIfEmpty</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;empty&quot;</span><span class="p">);</span>
    <span class="n">ValidationUtils</span><span class="p">.</span><span class="na">rejectIfEmpty</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="s">&quot;code&quot;</span><span class="p">,</span> <span class="s">&quot;empty&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">errors</span><span class="p">.</span><span class="na">rejectValue</span><span class="p">(</span><span class="s">&quot;quantity&quot;</span><span class="p">,</span> <span class="s">&quot;invalid&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Une classe implémentant l’interface <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/Validator.html">Validator</a> doit fournir l’implémentation
de deux méthodes :</p>
<dl class="simple">
<dt>supports</dt><dd><p>Retourne <code class="docutils literal notranslate"><span class="pre">true</span></code> si la classe passée en paramètre peut être validée par
ce validateur. Cela permet à <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> de découvrir dynamiquement
à quelles classes un validateur s’applique.</p>
</dd>
<dt>validate</dt><dd><p>Réalise la validation proprement dite. Le paramètre <code class="docutils literal notranslate"><span class="pre">errors</span></code> permet
d’enregistrer toutes les erreurs de validation détectées. Nous avons déplacé
et adapté notre code de la section précédente dans l’implémentation de
cette méthode.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remarquer que la classe <code class="docutils literal notranslate"><span class="pre">ItemValidator</span></code> possède le stéréotype <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Component.html">&#64;Component</a>
pour qu’un <em>bean</em> soit ajouté dans le contexte d’application.</p>
</div>
<p>Adaptons le code de notre contrôleur. Nous n’avons plus besoin de conserver
le code de validation qui est maintenant pris en charge par le validateur. Nous
devons tout de même indiquer au <em>framework</em> lors de l’appel à quelles méthodes
nous souhaitons valider le contenu de l’objet <code class="docutils literal notranslate"><span class="pre">Item</span></code>. Pour cela, il suffit
d’ajouter l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/annotation/Validated.html">&#64;Validated</a> sur le paramètre en question (ligne 19
ci-dessous) :</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

  <span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="hll">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">,</span>
</span>                            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>À l’opposé, nous n’utilisons pas l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/annotation/Validated.html">&#64;Validated</a> sur le paramètre de
la méthode <code class="docutils literal notranslate"><span class="pre">displayForm</span></code>. En effet, cette méthode utilise un objet <code class="docutils literal notranslate"><span class="pre">Item</span></code>
non valide puisqu’il sert juste à initialiser l’affichage du formulaire.</p>
</div>
<div class="section" id="validation-declarative-avec-bean-validation">
<h3>Validation déclarative avec Bean Validation<a class="headerlink" href="#validation-declarative-avec-bean-validation" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il existe une API standard en Java pour réaliser une validation déclarative :
c’est l’API <a class="reference external" href="https://beanvalidation.org/">Bean Validation</a> (JSR-303). Le Spring Framework est capable d’intégrer
automatiquement ce standard s’il trouve une implémentation de cette API au
lancement de l’application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pour une application basée sur Spring Boot 2.4 et suivant, vous devez activer
le support de <a class="reference external" href="https://beanvalidation.org/">Bean Validation</a> en déclarant une dépendance. Pour un projet
Maven, il suffit d’ajouter dans le fichier <code class="file docutils literal notranslate"><span class="pre">pom.xml</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text">Dépendance Spring Boot pour Spring Validation</span><a class="headerlink" href="#id34" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-validation<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<p>Pour une application non Spring Boot, vous devez ajouter une dépendance
à une implémentation de <a class="reference external" href="https://beanvalidation.org/">Bean Validation</a>. L’implémentation de référence
est <em>Hibernate Validator</em>. Pour un projet Maven, il suffit d’ajouter dans
le fichier <code class="file docutils literal notranslate"><span class="pre">pom.xml</span></code> :</p>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text">Dépendance à Bean Validation pour un projet sans Spring Boot</span><a class="headerlink" href="#id35" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>hibernate-validator<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>5.4.2.Final<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
</div>
<p><em>Bean Validation</em> repose sur une famille d’annotations qui sont positionnées sur
les attributs d’un <em>bean</em> pour indiquer les contraintes à respecter.</p>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text">Exemple d’utilisation des annotations de validation</span><a class="headerlink" href="#id36" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.Min</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotBlank</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="p">{</span>

  <span class="nd">@NotBlank</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Le nom ne peut pas être vide !&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

  <span class="nd">@NotBlank</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Le code ne peut pas être vide !&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="p">;</span>

  <span class="nd">@Min</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;La quantité doit être positive !&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="p">;</span>

  <span class="c1">// Getters/setters omis</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>La liste des annotations de Bean Validation est disponible dans la
<a class="reference external" href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/constraints/package-summary.html">documentation de Java EE</a>.</p>
</div>
<p>Nous n’avons pas besoin d’une classe de validation et si nous adaptons le code
de notre contrôleur, nous n’avons pas non plus besoin de conserver le code
pour valider les données. Nous devons tout de même indiquer au <em>framework</em> pour
quelles méthodes nous souhaitons valider le contenu de l’objet <code class="docutils literal notranslate"><span class="pre">Item</span></code>. Pour cela,
il suffit d’ajouter l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/annotation/Validated.html">&#64;Validated</a> sur le paramètre en question
(ligne 19 ci-dessous) :</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

  <span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
<span class="hll">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">,</span>
</span>                            <span class="n">BindingResult</span> <span class="n">bindingResult</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bindingResult</span><span class="p">.</span><span class="na">hasErrors</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>À l’opposé, nous n’utilisons pas l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/annotation/Validated.html">&#64;Validated</a> sur le paramètre de
la méthode <code class="docutils literal notranslate"><span class="pre">displayForm</span></code>. En effet, cette méthode utilise un objet <code class="docutils literal notranslate"><span class="pre">Item</span></code>
non valide puisqu’il sert juste à initialiser l’affichage du formulaire.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si vous ne voulez pas écrire les messages d’erreur de validation en dur
dans les annotations <a class="reference external" href="https://beanvalidation.org/">Bean Validation</a>, vous pouvez utiliser des accolades
pour signaler qu’il s’agit d’un code de message :</p>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text">Utilisation de codes pour représenter les erreurs</span><a class="headerlink" href="#id37" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.Min</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotBlank</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="p">{</span>

  <span class="nd">@NotBlank</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">&quot;{empty.item.name}&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

  <span class="nd">@NotBlank</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">&quot;{empty.item.code}&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="p">;</span>

  <span class="nd">@Min</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;{invalid.item.quantity}&quot;</span><span class="p">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">quantity</span><span class="p">;</span>

  <span class="c1">// Getters/setters omis</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Nous verrons à la section suivante que ces codes vont permettre d’extraire
des fichiers de propriétés les message à afficher dans les vues.
Malheureusement, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> n’active pas la conversion automatique
des messages de <a class="reference external" href="https://beanvalidation.org/">Bean Validation</a> pour obtenir le message à partir du code.
Pour que cela fonctionne, il faut ajouter un <em>bean</em> spécifique dans le
contexte d’application qui va réaliser cette opération. Ajoutez la méthode
suivante dans n’importe quel <em>bean</em> de configuration de votre application :</p>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text">Activation de la conversion des codes pour Bean Validation</span><a class="headerlink" href="#id38" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">LocalValidatorFactoryBean</span> <span class="nf">validator</span><span class="p">(</span><span class="n">MessageSource</span> <span class="n">messageSource</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">LocalValidatorFactoryBean</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalValidatorFactoryBean</span><span class="p">();</span>
  <span class="n">bean</span><span class="p">.</span><span class="na">setValidationMessageSource</span><span class="p">(</span><span class="n">messageSource</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bean</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="affichage-des-erreurs-de-validation">
<h3>Affichage des erreurs de validation<a class="headerlink" href="#affichage-des-erreurs-de-validation" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’objet <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a> est mis à disposition automatiquement dans le modèle.
Cela signifie qu’il est possible d’afficher des messages d’erreur dans une vue
à partir des codes fournis. Pour cela, il faut d’abord créer un message pour
chaque code.</p>
<p>Si nous reprenons notre exemple, nous pouvons ajouter dans le fichier
<code class="file docutils literal notranslate"><span class="pre">messages.properties</span></code> (Cf. <a class="reference internal" href="#spring-web-mvc-externalisation-messages"><span class="std std-ref">Externalisation des messages</span></a>)
les messages associés aux codes :</p>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text">Extrait du fichier messages.properties</span><a class="headerlink" href="#id39" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">empty.item.name</span> <span class="o">=</span> <span class="s">Le nom doit être renseigné</span>
<span class="na">empty.item.code</span> <span class="o">=</span>  <span class="s">Le code doit être renseigné</span>
<span class="na">invalid.item.quantity</span> <span class="o">=</span> <span class="s">La quantité doit être un nombre positif</span>
</pre></div>
</div>
</div>
<p>Ensuite il faut préciser dans la vue affichant le formulaire à quels endroits
les différents messages devront être affichés (s’il y en a).</p>
<p>Dans la JSP, nous pouvons utiliser la balise <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/tags/form/ErrorsTag.html">&lt;form:errors/&gt;</a> et indiquer
avec l’attribut <code class="docutils literal notranslate"><span class="pre">path</span></code> le chemin du champ pour lequel nous voulons afficher
les erreurs.</p>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-text">Modification de la JSP pour intégrer l’affichage des erreurs</span><a class="headerlink" href="#id40" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-jsp notranslate"><div class="highlight"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="k">%&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;form:form</span> <span class="na">servletRelativeAction=</span><span class="s">&quot;/item&quot;</span> <span class="na">modelAttribute=</span><span class="s">&quot;item&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p&gt;&lt;label&gt;</span>Code : <span class="nt">&lt;/label&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;code&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;code&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;&lt;label&gt;</span>Nom : <span class="nt">&lt;/label&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;&lt;label&gt;</span>Quantité : <span class="nt">&lt;/label&gt;&lt;form:input</span> <span class="na">path=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;form:errors</span> <span class="na">path=</span><span class="s">&quot;quantity&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>Envoyer<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form:form&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<p>Dans le modèle <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a>, nous pouvons utiliser l’objet utilitaire <code class="docutils literal notranslate"><span class="pre">#errors</span></code>
qui correspond au dictionnaire des erreurs pour vérifier si des erreurs
existent et l’attribut <a class="reference external" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">Thymeleaf</a> <code class="docutils literal notranslate"><span class="pre">errors</span></code> pour extraire les messages d’erreur.</p>
<div class="literal-block-wrapper docutils container" id="id41">
<div class="code-block-caption"><span class="caption-text">Modification du modèle pour intégrer l’affichage des erreurs</span><a class="headerlink" href="#id41" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">data-th-action</span><span class="o">=</span><span class="s">&quot;@{/item}&quot;</span> <span class="na">data-th-object</span><span class="o">=</span><span class="s">&quot;${item}&quot;</span> <span class="na">accept-charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Code : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">data-th-field</span><span class="o">=</span><span class="s">&quot;*{code}&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">span</span> <span class="na">data-th-if</span><span class="o">=</span><span class="s">&quot;${#fields.hasErrors(&#39;code&#39;)}&quot;</span> <span class="na">data-th-errors</span><span class="o">=</span><span class="s">&quot;*{code}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Nom : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">data-th-field</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">span</span> <span class="na">data-th-if</span><span class="o">=</span><span class="s">&quot;${#fields.hasErrors(&#39;name&#39;)}&quot;</span> <span class="na">data-th-errors</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">label</span><span class="p">&gt;</span>Quantité : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;number&quot;</span> <span class="na">data-th-field</span><span class="o">=</span><span class="s">&quot;*{quantity}&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">span</span> <span class="na">data-th-if</span><span class="o">=</span><span class="s">&quot;${#fields.hasErrors(&#39;quantity&#39;)}&quot;</span> <span class="na">data-th-errors</span><span class="o">=</span><span class="s">&quot;*{quantity}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Envoyer<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<p>Dans la vue, le code erreur est remplacé par le message venant du fichier
<code class="file docutils literal notranslate"><span class="pre">messages.properties</span></code>.</p>
</div>
</div>
<div class="section" id="post-redirect-get">
<h2>POST-redirect-GET<a class="headerlink" href="#post-redirect-get" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’emploi de la méthode <code class="docutils literal notranslate"><span class="pre">POST</span></code> signale que l’utilisateur souhaite modifier des
informations sur le serveur. Cependant, ce type de requêtes est géré de manière
particulière par les navigateurs Web. Si un utilisateur désire rafraîchir une
page obtenue à partir d’une requête <code class="docutils literal notranslate"><span class="pre">POST</span></code> (ou sélectionne une page dans son
historique obtenue à partir d’une requête <code class="docutils literal notranslate"><span class="pre">POST</span></code>), il verra s’afficher un
message d’avertissement car le navigateur ne peut pas garantir que la réémission
de la requête n’aura pas des effets de bord sur le serveur.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ce comportement est parfaitement normal et découle du fait que la méthode
<code class="docutils literal notranslate"><span class="pre">POST</span></code> est définie comme <strong>non-idempotente</strong> par la spécification HTTP.
Cela signifie que, si on envoie plusieurs fois la même requête <code class="docutils literal notranslate"><span class="pre">POST</span></code> au
serveur, HTTP ne peut pas garantir que le résultat sera identique.
Typiquement, si on émet une requête <code class="docutils literal notranslate"><span class="pre">POST</span></code> pour créer un compte utilisateur
sur le serveur, rien ne peut garantir le comportement de la même requête
émise une seconde fois. La seconde requête peut ne produire aucun effet
car le compte existe déjà, créer un deuxième compte, produire une erreur…</p>
</div>
<p>Pour éviter que le navigateur Web n’émette à nouveau une requête <code class="docutils literal notranslate"><span class="pre">POST</span></code>, il est
recommandé d’utiliser le principe du <a class="reference external" href="https://fr.wikipedia.org/wiki/Post-Redirect-Get">POST/Redirect/GET</a>.
En réponse à une requête <code class="docutils literal notranslate"><span class="pre">POST</span></code>, le serveur doit produire une réponse HTTP de
redirection (c’est-à-dire une réponse avec un code statut <strong>302</strong> ou <strong>303</strong>)
pour rediriger le navigateur vers une nouvelle adresse. Ainsi, le navigateur
effectue immédiatement une requête <code class="docutils literal notranslate"><span class="pre">GET</span></code> à cette nouvelle adresse et affiche
le résultat à l’utilisateur en <em>oubliant</em> la requête précédente. Ainsi,
le navigateur ne garde plus trace de la requête <code class="docutils literal notranslate"><span class="pre">POST</span></code> originale évitant ainsi
à l’utilisateur la possibilité de la réémettre.</p>
<p>Un contrôleur <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> peut déclencher automatiquement une réponse de
redirection en préfixant la chaîne de caractères retournée par <code class="docutils literal notranslate"><span class="pre">redirect:</span></code>.
Le contenu est alors identifié comme une adresse relative à la racine de
l’application Web (et non comme un identifiant de vue).</p>
<p>De plus, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> introduit la notion <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-flash-attributes">d’attributs Flash</a>.
Ces attributs sont stockés en session jusqu’à la prochaine requête de l’utilisateur.
Ils sont donc faits pour mémoriser très temporairement un contexte d’exécution
le temps d’une redirection. Pour utiliser les attributs flash, il suffit d’attendre
en paramètre de la méthode d’un contrôleur un argument de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/mvc/support/RedirectAttributes.html">RedirectAttributes</a>.
Grâce à ce paramètre, on peut mémoriser un attribut flash avant d’effectuer la
redirection. L’attribut flash sera automatiquement ajouté dans le modèle pour
le traitement du contrôleur après la redirection.</p>
<p>Ci-dessous un exemple simple utilisant une redirection avec un attribut flash :</p>
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-text">Redirection et utilisation des attributs flash</span><a class="headerlink" href="#id42" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.support.RedirectAttributes</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span> <span class="p">{</span>

    <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="p">(</span><span class="n">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">();</span>
        <span class="n">item</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="s">&quot;BV-34&quot;</span><span class="p">);</span>
        <span class="n">item</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;Mon item&quot;</span><span class="p">);</span>
        <span class="n">redirectAttributes</span><span class="p">.</span><span class="na">addFlashAttribute</span><span class="p">(</span><span class="s">&quot;item&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">);</span>
        <span class="k">return</span> <span class="s">&quot;redirect:/autre-page&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/autre-page&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">redirectHome</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Le paramètre item correspond à l&#39;instance ajoutée comme attribut flash</span>
        <span class="k">return</span> <span class="s">&quot;view&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="la-gestion-des-exceptions">
<h2>La gestion des exceptions<a class="headerlink" href="#la-gestion-des-exceptions" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> nous permet de transformer des exceptions en erreur HTTP pour
le client (voire même créer une réponse complète avec une vue dédiée).</p>
<p>Certaines exceptions fournies par <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> sont directement comprises
et transformées en erreur par le <em>framework</em>. Par exemple, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/HttpRequestMethodNotSupportedException.html">HttpRequestMethodNotSupportedException</a>
permet de signaler une erreur HTTP 405. Ce comportement est géré par la classe
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/mvc/support/DefaultHandlerExceptionResolver.html">DefaultHandlerExceptionResolver</a>. Reportez-vous à la documentation de cette classe
pour la liste complète des exceptions supportées.</p>
<p>Mais un contrôleur peut également fournir des méthodes de gestion des exceptions.
Ces méthodes permettent de prendre en charge n’importe quel type d’exception. Elles
doivent être annotées avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ExceptionHandler.html">&#64;ExceptionHandler</a>. L’annotation permet de préciser
la classe de l’exception que la méthode peut gérer. Une méthode de gestion
d’exception accepte des types de paramètres et une valeur de retour similaires
aux méthodes de gestion de requête. Une méthode de gestion d’exception attend
également en paramètre l’exception à traiter.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseStatus</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">ItemException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
    <span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleItemException</span><span class="p">(</span><span class="n">ItemException</span> <span class="n">e</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
        <span class="k">return</span> <span class="s">&quot;itemError&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ItemException</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getQuantity</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ItemException</span><span class="p">(</span><span class="s">&quot;Item not available&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Dans l’exemple précédent, on déclare un contrôleur dont la méthode <code class="docutils literal notranslate"><span class="pre">processForm</span></code>
peut jeter une <code class="docutils literal notranslate"><span class="pre">ItemException</span></code> qui est une exception de l’application. Le contrôleur
déclare également une méthode pour gérer les exceptions du même type. Ainsi, si
cette exception est effectivement lancée lors de l’exécution de la méthode
<code class="docutils literal notranslate"><span class="pre">processForm</span></code>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> appellera la méthode <code class="docutils literal notranslate"><span class="pre">handleItemException</span></code>
et utilisera sa valeur de retour pour en déduire la vue. Notez que la méthode
<code class="docutils literal notranslate"><span class="pre">handleItemException</span></code> est annotée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ResponseStatus.html">&#64;ResponseStatus</a> qui permet de modifier
le statut HTTP de la réponse. Dans cet exemple, une exception <code class="docutils literal notranslate"><span class="pre">ItemException</span></code>
produira une réponse avec le code HTTP 400 (<em>Bad Request</em>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Normalement le code statut d’une réponse produite par un contrôleur est
200 (OK). Produire un autre code avec l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ResponseStatus.html">&#64;ResponseStatus</a> a
des effets intéressants. Par exemple, les réponses avec un code statut
d’erreur client (code commençant par un 4 comme 404) ou avec un code statut
d’erreur serveur (code commençant par un 5) ne sont pas mises en cache par
le navigateur.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>Nous avons vu que pour traiter la validation de formulaire, il fallait déclarer
un paramètre de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/BindingResult.html">BindingResult</a> à la méthode du contrôleur. En l’absence
de ce paramètre, si un autre paramètre possède l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/annotation/Validated.html">&#64;Validated</a> et
que la validation échoue, alors le <em>framework</em> jette une exception de type
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/MethodArgumentNotValidException.html">MethodArgumentNotValidException</a> avant même d’appeler la méthode du contrôleur.</p>
<p>Vous pouvez écrire une méthode de gestion des exceptions pour traiter cette
situation. Il s’agit d’une façon alternative de traiter l’échec de la
validation. Les messages d’erreur seront tout de même disponibles dans la
vue.</p>
<div class="literal-block-wrapper docutils container" id="id43">
<div class="code-block-caption"><span class="caption-text">Méthode de gestion des exceptions pour la validation</span><a class="headerlink" href="#id43" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.MethodArgumentNotValidException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseStatus</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemController</span> <span class="p">{</span>

    <span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">MethodArgumentNotValidException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
    <span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleValidationException</span><span class="p">(</span><span class="n">MethodArgumentNotValidException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// En cas d&#39;échec de validation, on retourne sur la vue</span>
        <span class="c1">// du formulaire.</span>
        <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">displayForm</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;itemForm&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/item&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">processForm</span><span class="p">(</span><span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="s">&quot;successProcessItem&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="methodes-de-modele">
<h2>Méthodes de modèle<a class="headerlink" href="#methodes-de-modele" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est parfois utile d’ajouter des éléments dans un modèle quelle que soit la requête
émise vers un contrôleur. De cette façon, ces éléments seront disponibles dans
la vue. Une méthode avec l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ModelAttribute.html">&#64;ModelAttribute</a> est automatiquement
appelée avant l’appel à la méthode de traitement de la requête et l’objet
qu’elle retourne est ajouté au modèle.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s">&quot;/item/{code}&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemEditController</span> <span class="p">{</span>

        <span class="nd">@ModelAttribute</span>
        <span class="kd">public</span> <span class="n">Item</span> <span class="nf">getItem</span><span class="p">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">code</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="p">();</span>
                <span class="n">item</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="n">code</span><span class="p">);</span>

                <span class="c1">// ...</span>

                <span class="k">return</span> <span class="n">item</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nd">@GetMapping</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">viewItem</span><span class="p">(</span><span class="nd">@ModelAttribute</span> <span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// ...</span>

                <span class="k">return</span> <span class="s">&quot;showItem&quot;</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans l’exemple ci-dessus, la méthode <code class="docutils literal notranslate"><span class="pre">getItem</span></code> est systématiquement appelée
avant la méthode de traitement de la requête. Elle récupère le code dans le
chemin de la ressource et elle retourne une instance de la classe <code class="docutils literal notranslate"><span class="pre">Item</span></code>.
Cette instance est automatiquement ajoutée dans le modèle (avec le nom <code class="docutils literal notranslate"><span class="pre">item</span></code>).
Elle sera donc accessible depuis une vue. Cette instance de la classe <code class="docutils literal notranslate"><span class="pre">Item</span></code>
peut également être passée directement en paramètre de la méthode de traitement
de la requête comme c’est le cas pour la méthode <code class="docutils literal notranslate"><span class="pre">viewItem</span></code> de l’exemple ci-dessus.</p>
</div>
<div class="section" id="methodes-de-binder">
<h2>Méthodes de binder<a class="headerlink" href="#methodes-de-binder" title="Lien permanent vers ce titre">¶</a></h2>
<p>Nous avons vu que le <em>binding</em> est l’étape qui permet de remplir les propriétés
d’un objet du modèle à partir des paramètres de la requête. <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a>
fournit des <em>bindings</em>. Par exemple, il existe un <em>binding</em> par défaut pour
transformer une chaîne de caractères en nombre. Cela permet de transformer
un paramètre de la requête si le type Java attendu est un <code class="docutils literal notranslate"><span class="pre">int</span></code>.
Il est possible d’ajouter ces propres définitions de <em>binders</em>. Pour cela, il
suffit d’ajouter dans un contrôleur une méthode annotée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/InitBinder.html">&#64;InitBinder</a> et
ayant au moins un paramètre de type <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/WebDataBinder.html">WebDataBinder</a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.propertyeditors.CustomDateEditor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.WebDataBinder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.InitBinder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DateController</span> <span class="p">{</span>

    <span class="nd">@InitBinder</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initBinder</span><span class="p">(</span><span class="n">WebDataBinder</span> <span class="n">binder</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SimpleDateFormat</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;dd-MM-yyyy&quot;</span><span class="p">);</span>
        <span class="n">binder</span><span class="p">.</span><span class="na">registerCustomEditor</span><span class="p">(</span><span class="n">Date</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="k">new</span> <span class="n">CustomDateEditor</span><span class="p">(</span><span class="n">dateFormat</span><span class="p">,</span> <span class="kc">false</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/date&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateDate</span><span class="p">(</span><span class="nd">@RequestParam</span> <span class="n">Date</span> <span class="n">date</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// ...</span>

        <span class="k">return</span> <span class="s">&quot;success&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Dans l’exemple ci-dessus, le contrôleur contient une méthode annotée avec
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/InitBinder.html">&#64;InitBinder</a>. Cette méthode est automatiquement appelée avant l’appel de la
méthode de traitement de la requête. Elle enregistre un <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/text/SimpleDateFormat.html">SimpleDateFormat</a> pour
permettre de convertir une chaîne de caractères en <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Date.html">Date</a> suivant le format
<code class="docutils literal notranslate"><span class="pre">dd-MM-yyyy</span></code>. Dans la même classe, la méthode de traitement de requête
<code class="docutils literal notranslate"><span class="pre">updateDate</span></code> attend en paramètre un objet de type <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Date.html">Date</a> correspondant au
paramètre <code class="docutils literal notranslate"><span class="pre">date</span></code> de la requête HTTP. <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc">Spring Web MVC</a> utilisera le <em>binding</em>
défini pour réaliser cette transformation.</p>
</div>
<div class="section" id="controlleradvice">
<h2>ControllerAdvice<a class="headerlink" href="#controlleradvice" title="Lien permanent vers ce titre">¶</a></h2>
<p>Nous avons vu qu’il est possible de déclarer des méthodes annotées avec
<a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ExceptionHandler.html">&#64;ExceptionHandler</a>, <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ModelAttribute.html">&#64;ModelAttribute</a> et <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/InitBinder.html">&#64;InitBinder</a> dans un contrôleur.
Si nous voulons utiliser les mêmes méthodes pour plusieurs contrôleurs, il
est possible de créer une classe annotée avec <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html">&#64;ControllerAdvice</a>. Cette classe
regroupe toutes les méthodes communes et indique les contrôleurs, le package ou
même l’annotation pour lesquels elles s’appliquent.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">dev.gayerie</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.propertyeditors.CustomDateEditor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.WebDataBinder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.InitBinder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseStatus</span><span class="p">;</span>

<span class="nd">@ControllerAdvice</span><span class="p">(</span><span class="s">&quot;dev.gayerie&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemControllerAdvice</span> <span class="p">{</span>

    <span class="nd">@InitBinder</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initBinder</span><span class="p">(</span><span class="n">WebDataBinder</span> <span class="n">binder</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SimpleDateFormat</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;dd-MM-yyyy&quot;</span><span class="p">);</span>
        <span class="n">binder</span><span class="p">.</span><span class="na">registerCustomEditor</span><span class="p">(</span><span class="n">Date</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="k">new</span> <span class="n">CustomDateEditor</span><span class="p">(</span><span class="n">dateFormat</span><span class="p">,</span> <span class="kc">false</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">@ExceptionHandler</span><span class="p">(</span><span class="n">ItemException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
    <span class="nd">@ResponseStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">BAD_REQUEST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleItemException</span><span class="p">(</span><span class="n">ItemException</span> <span class="n">e</span><span class="p">,</span> <span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
        <span class="k">return</span> <span class="s">&quot;itemError&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans l’exemple ci-dessus, tous les contrôleurs déclarés dans le package dev.gayerie
spécifié par l’annotation <a class="reference external" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html">&#64;ControllerAdvice</a> bénéficieront automatiquement
de la méthode de <em>binding</em> et de la méthode de gestion d’exception comme si
ces méthodes avaient directement été déclarées dans les classes des contrôleurs.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="spring_mvc_apiweb.html" class="btn btn-neutral float-right" title="Les API Web avec Spring Web MVC" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spring_mvc_intro.html" class="btn btn-neutral float-left" title="Introduction à Spring Web MVC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  <div  role="contentinfo">
    <p>
    Par David Gayerie
    - <script>!function(){function e(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})}!function(e){document.write("<a href='mailto:"+e+"'>"+e+"</a>")}(e("qnivq@tnlrevr.qri"))}();</script>
    - <a class="reference external" href="https://gayerie.dev">https://gayerie.dev</a>
    </p>
    <p class="copyright">
      <a class="reference external image-reference" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" src="https://i.creativecommons.org/l/by-sa/3.0/fr/88x31.png" /></a>
      Cette œuvre est mise à disposition selon les termes de la <a class="reference external" href="https://creativecommons.org/licenses/by-sa/3.0/fr/">Licence Creative Commons Attribution</a> -  Partage dans les Mêmes Conditions 3.0 France
    </p>
  </div>


</footer>

        </div>

      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99071053-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>